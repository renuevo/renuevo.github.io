{"componentChunkName":"component---src-templates-blog-post-js","path":"/spring/batch/spring-batch-chapter-3/","webpackCompilationHash":"9bc18b594d2407556304","result":{"data":{"site":{"siteMetadata":{"title":"renuevo blog","author":"deokhwa kim","siteUrl":"https://renuevo.github.io","comment":{"disqusShortName":"https-renuevo-github-io","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"da04b29b-4aff-579c-8938-6af39e5edfe2","excerpt":"Spring Batch Guide 시리즈 Spring Batch의 기본 개념 Spring Batch의 ItemReader - File Item Reader Spring Batch의 ItemReader - DB Item Reader Chapter 3에서는 Spring Batch의 DB ItemReader에 대한 이야기를 다룹니다   Spring의 JDBC ItemReader Spring은 사용자 편의를 위하여 해서 로 제공합니다 사용자는 이렇게 제공된 JDBC ItemReader…","html":"<h3 id=\"spring-batch-guide-시리즈\"><a href=\"#spring-batch-guide-%EC%8B%9C%EB%A6%AC%EC%A6%88\" aria-label=\"spring batch guide 시리즈 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Batch Guide 시리즈</h3>\n<ol>\n<li><a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-1/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch의 기본 개념</a></li>\n<li><a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-2/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch의 ItemReader - File Item Reader</a></li>\n<li><a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-3/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch의 ItemReader - DB Item Reader</a></li>\n</ol>\n<br/>\n<hr>\n<br/>\n<p><em>Chapter 3에서는 Spring Batch의 DB ItemReader에 대한 이야기를 다룹니다</em>  </p>\n<br/>\n<h2 id=\"spring의-jdbc-itemreader\"><a href=\"#spring%EC%9D%98-jdbc-itemreader\" aria-label=\"spring의 jdbc itemreader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring의 JDBC ItemReader</h2>\n<p>Spring은 사용자 편의를 위하여 <code class=\"language-text\">JDBC의 기능을 확장</code>해서 <code class=\"language-text\">추상화 서비스</code>로 제공합니다<br>\n사용자는 이렇게 제공된 JDBC ItemReader 구현체로 간편하게 Item을 읽어올 수 있어 보다 서비스에 집중 할 수 있습니다  </p>\n<p>그럼 Item의 읽어오는 방식을 먼저 생각해 보겠습니다<br>\n앞서 <a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-1/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chapter 1</a>에서 마지막에서 설명했듯 프로세스를 Spring Batch는 <code class=\"language-text\">Chuck 지향 처리</code>를 합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"textbox\"><pre class=\"language-textbox\"><code class=\"language-textbox\">Spring Batch의 가장 큰 장점 중 하나는 `Chunk` 지향 처리입니다  \n`Chunk`지향처리란 한 번에 하나씩의 데이터를 읽어 Chunk라는 덩어리를 만든 뒤, Chunk 단위로 트랜잭션을 다루는 것을 의미합니다  \n그래서 트랜잭션을 수행시 `Chunk`단위로 수행하기 때문에 Chunk 만큼만 롤백 됩니다  </code></pre></div>\n<p>이러한 구조상 순차적으로 Item을 일정 사이즈 만큼 받아와서 처리해야 할 것입니다<br>\n하지만 <span class='red_font'> Spring의 JdbcTemplate은 자체적으로 분할처리를 지원하지 않습니다</span><br>\n때문에 <code class=\"language-text\">limit</code>와 <code class=\"language-text\">offset</code>을 사용자가 직접지정하여 사용하는 작업이 필요합니다  </p>\n<br/>\n<p>Spring Batch는 이러한 구현을 사용자가 직접하지 않고 사용할 수 있도록 자체적으로 서비스를 <code class=\"language-text\">2가지 방식</code>으로 제공합니다</p>\n<ol>\n<li>Cursor-based ItemReader  </li>\n<li>Paging ItemReader  </li>\n</ol>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.62666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABcRAAAXEQHKJvM/AAACA0lEQVQoz2P40+y27W9f2P5fDc4TGJhY1BkYGNREyub58vUfmiE35VC/cN++BQwTT/k0VZTGdXZ1Hevo6Njq4+fnA1LHr2elzdd/oEl84sFpkpMOTebr3dfP8LcnuPHvrIz2P10BqUwMDHJAhSJCPZut7KbvWOU7b89S+2nb18lMOejWVlftOGny5J6JEyc2hkdEGgDVSTFo2YmYTtnZ7jF711ogXmE0ecckBhQgJcU+j4GBb31svln94nUbJq/fsbVp8dr1GbPXmjOggf///4Ppknmr63pXb9nbu2rz9sK5axoYfncHsfyYlsLyf24cMwMfL3crAwP/zIQyy+KFG1a3rNq+rmzButXhszZZgjRPnz6NtX/iRBaf+DTGLUXBjCCxjDnrauuXb9lWv2zzhpTZ6xsRViqqwZnWKw6rAA062rV254nKheuOxM7aYAcSX75iKaPYhAMMor17GG6vmwE2MHvO2t6WlVsvtKzYcgpo+AS4IaISCgxaAdFMILZb/1rlgnnrOppWbe8oWbC+NWDGZkOQ+MWtyxhY5DQYWBV1Gdc7CoENTJ61Lq1u+dbeumVbOuJnbchkwAbk/v9nYXj+n41h1S92htZ9XLx9B7g+f36HVS3T4sdcDPV7OBnajnAydx/kQZZjAcUwAwOjDDgGITHOi8UMVqgcSJ0CEHMhSwIAcKHDW3vyZugAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DB_ItemReader\"\n        title=\"DB_ItemReader\"\n        src=\"/static/f830e8d0ebd2d3f951605759945c2cd3/36727/db-itemreader.png\"\n        srcset=\"/static/f830e8d0ebd2d3f951605759945c2cd3/acf4b/db-itemreader.png 173w,\n/static/f830e8d0ebd2d3f951605759945c2cd3/fc834/db-itemreader.png 345w,\n/static/f830e8d0ebd2d3f951605759945c2cd3/36727/db-itemreader.png 690w,\n/static/f830e8d0ebd2d3f951605759945c2cd3/17fa4/db-itemreader.png 1035w,\n/static/f830e8d0ebd2d3f951605759945c2cd3/a5044/db-itemreader.png 1380w,\n/static/f830e8d0ebd2d3f951605759945c2cd3/07b3b/db-itemreader.png 1875w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>2가지 방식은 같은 데이터를 읽어 오지만 서로 다른 전략으로 DB의 데이터를 읽어 옵니다<br>\n프로세스 동작에 따라 알맞은 전략을 선택해야 하며 전략선택에 따라 Batch의 퍼포먼스를 높일 수 있습니다  </p>\n<br/>\n<h2 id=\"sample-db-setting\"><a href=\"#sample-db-setting\" aria-label=\"sample db setting permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sample DB Setting</h2>\n<p>ItemReader를 테스트할 DB를 먼저 세팅해 보겠습니다<br>\n테스트에 사용할 DB는 <code class=\"language-text\">H2</code>를 선택했습니다<br>\n<code class=\"language-text\">MYSQL</code>을 사용하시고 싶으신 분들은 Meta Table을 생성하셔서 사용하셔도 됩니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.70878459687123%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACVElEQVQoz4VSiW7aQBDl//8mDVGqSlUTSFBwSADbGB9rvOuT9QHeOPheu2OSSq1E1NFoJY/f2zfzZkdL3buarsYz8Wq6HD+ur2fi0vT7vu+6/r8x8mmgarqmG6qmIXOXF2VV11lRE5o6MSP04ESM88s3jXTLni8lYSXDuVJ0UTOJ67vh4eqXcDNdXN8J969q1bSXyd2f/vLTqTsH5zwvToFru8RKaNB3vG2/IDctn6yM70/i7Wx9PXl5kHe87/dRvBA3wlKElFSjrCqAQvP/ZNcBuVWQuVjL642KsEOTFJSbtssbnr7nWV7mVdN94d4IWqJ0bxMMGfheXddQNdxo/LC+mb58u3/+ISinsj4VjWZTw6GavddIsMW+F7OB7AeBZVmmuSuK4kMkSmJJUeWthiwShDFU/Oh4M3m+nS7G9/O7hTxXLOTFo5Zzz/cxxqZpUkr5OVLGbJvYhBCMy7Lsuz4vC9+1aeA5BCrF2QL+qQwwXdeDIBiszvPkeCC2jRCC6wAHHR3T1AIFTDAhVVXzvmsHMueu5501MKDTNAU0yzIHpAc0ZoxB5T3PTRNhy4L64BX43TafZJgZ+NB5GIYw9D6MNooqbRRR3qj6sKokZcMT2hqSihR9B6dJnIFMQ3oWBsPJh9unoozTzA+TfXyMDgxGg62WDa9aXjW8bFrIuuWjummMnXUWGdJ2HHrIJis0k8yfgnz3qj6I6FlzLj7vQXmfMD9Ogzj1oiNNWMKYIG7mK3khbp9eJexH8Vt+mfz3x8f/tyzTDUOD0HWETFik53kXn/dvzcp1CxmBXnIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Spring Batch Meta Data Schema\"\n        title=\"Spring Batch Meta Data Schema\"\n        src=\"/static/55b809cbc69531950dd7c7fa094e4261/36727/meta-data-erd.png\"\n        srcset=\"/static/55b809cbc69531950dd7c7fa094e4261/acf4b/meta-data-erd.png 173w,\n/static/55b809cbc69531950dd7c7fa094e4261/fc834/meta-data-erd.png 345w,\n/static/55b809cbc69531950dd7c7fa094e4261/36727/meta-data-erd.png 690w,\n/static/55b809cbc69531950dd7c7fa094e4261/d181f/meta-data-erd.png 831w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p><code class=\"language-text\">H2</code>의 경우 <code class=\"language-text\">Meta Table</code>을 자동으로 생성해주기 때문에 별다른 설정 없이 테스트 가능합니다<br>\n다른 DB들 경우 각각의 쿼리로 해당 Table들을 생성해 주어야 정상적으로 작동합니다  </p>\n<p><a href=\"https://github.com/spring-projects/spring-batch/blob/master/spring-batch-core/src/main/resources/org/springframework/batch/core/schema-mysql.sql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MYSQL-Spring-Batch-SCHEMA</a>  </p>\n<br/>\n<p>의존관계를 Gradle에 추가해 줍니다 👉 <a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/build.gradle\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a>     </p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">dependencies <span class=\"token punctuation\">{</span>\n <span class=\"token punctuation\">...</span>\n    implementation <span class=\"token string\">'org.springframework.boot:spring-boot-starter-data-jdbc'</span>\n    implementation <span class=\"token string\">'org.springframework.boot:spring-boot-starter-data-jpa'</span>\n    runtimeOnly <span class=\"token string\">'com.h2database:h2'</span>\n <span class=\"token punctuation\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>그리고 <code class=\"language-text\">application-property</code>로 <code class=\"language-text\">DB설정</code>을 해주겠습니다 👉 <a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/src/main/resources/application.yml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a><br>\nSpring Boot에서 간단한 property설정만으로 <code class=\"language-text\">DataSource</code>와 <code class=\"language-text\">EntityManagerFactory</code>를 생성해 주기 때문에 편합니다<br>\n추가적으로 여러개의 Job을 각각 실행해보기 위해서 <code class=\"language-text\">batch-job-names</code>을 설정합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">spring<span class=\"token punctuation\">:</span>\n  datasource<span class=\"token punctuation\">:</span>\n    hikari<span class=\"token punctuation\">:</span>\n      driver<span class=\"token operator\">-</span><span class=\"token keyword\">class</span><span class=\"token operator\">-</span>name<span class=\"token punctuation\">:</span> org<span class=\"token operator\">.</span>h2<span class=\"token operator\">.</span>Driver\n<span class=\"gatsby-highlight-code-line\">      jdbc<span class=\"token operator\">-</span>url<span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>h2<span class=\"token punctuation\">:</span>mem<span class=\"token punctuation\">:</span>spring<span class=\"token operator\">-</span>batch #In<span class=\"token operator\">-</span>memory   </span><span class=\"gatsby-highlight-code-line\">      #jdbc<span class=\"token operator\">-</span>url<span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>h2<span class=\"token punctuation\">:</span>file<span class=\"token punctuation\">:</span><span class=\"token operator\">.</span><span class=\"token string regex\">/spring-boot-batch-in-action/</span>data<span class=\"token operator\">/</span>spring<span class=\"token operator\">-</span>batch<span class=\"token punctuation\">;</span>AUTO_SERVER<span class=\"token operator\">=</span>TRUE<span class=\"token punctuation\">;</span> #File<span class=\"token operator\">-</span>based  </span>      username<span class=\"token punctuation\">:</span> sa\n      password<span class=\"token punctuation\">:</span>\n  jpa<span class=\"token punctuation\">:</span>\n    show<span class=\"token operator\">-</span>sql<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n    hibernate<span class=\"token punctuation\">:</span>\n      ddl<span class=\"token operator\">-</span>auto<span class=\"token punctuation\">:</span> create<span class=\"token operator\">-</span>drop\n    database<span class=\"token operator\">-</span>platform<span class=\"token punctuation\">:</span> org<span class=\"token operator\">.</span>hibernate<span class=\"token operator\">.</span>dialect<span class=\"token operator\">.</span>H2Dialect\n  batch<span class=\"token punctuation\">:</span>\n    job<span class=\"token punctuation\">:</span>\n<span class=\"gatsby-highlight-code-line\">      names<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span>job<span class=\"token operator\">.</span>name<span class=\"token punctuation\">:</span>NONE<span class=\"token punctuation\">}</span>   #<span class=\"token operator\">--</span>job<span class=\"token operator\">.</span>name<span class=\"token operator\">=</span>jdbcCursorItemReaderJob  </span></code></pre></div>\n<br/>\n<p>다음은 <code class=\"language-text\">Schema 설정</code>입니다 👉 <a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/src/main/resources/schema.sql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a><br>\n<code class=\"language-text\">H2</code>를 사용하기 때문에 Batch관련 설정은 필요없지만 Sample 데이터를 설정해 주겠습니다<br>\nSpring boot 초기데이터를 생성하도록 <code class=\"language-text\">src/main/resources/schema.sql</code>파일을 생성해 줍니다<br>\n<code class=\"language-text\">in-memory</code>방식으로 해서 기존 테이블 확인은 필요없지만 <code class=\"language-text\">MYSQL</code>로 테스트 해볼수도 있기 때문에 <span class='red_font'>DROP</span> 조건을 추가하였습니다  </p>\n<p><span class='code_header'>schema.sql</span></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> pay<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> pay2<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> tax<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> pay <span class=\"token punctuation\">(</span>\n  id         <span class=\"token keyword\">bigint</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span> <span class=\"token keyword\">auto_increment</span><span class=\"token punctuation\">,</span>\n  amount     <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span>\n  tx_name     <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  tx_date_time <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> pay2 <span class=\"token punctuation\">(</span>\n  id         <span class=\"token keyword\">bigint</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span> <span class=\"token keyword\">auto_increment</span><span class=\"token punctuation\">,</span>\n  amount     <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span>\n  tx_name     <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  tx_date_time <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> tax <span class=\"token punctuation\">(</span>\n  id        <span class=\"token keyword\">bigint</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span> <span class=\"token keyword\">auto_increment</span><span class=\"token punctuation\">,</span>\n  pay_id    <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span>\n  pay_tax   <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span>\n  location  <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> pay <span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">,</span> tx_name<span class=\"token punctuation\">,</span> tx_date_time<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'trade1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2020-03-11 00:00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> pay <span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">,</span> tx_name<span class=\"token punctuation\">,</span> tx_date_time<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'trade2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2020-03-12 00:00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> pay <span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">,</span> tx_name<span class=\"token punctuation\">,</span> tx_date_time<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'trade3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2020-03-13 00:00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> pay <span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">,</span> tx_name<span class=\"token punctuation\">,</span> tx_date_time<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4000</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'trade4'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2020-03-14 00:00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이것으로 테스트를 돌리기 위한 초기 데이터 세팅이 끝났습니다<br>\n다음은 이제 본격적으로 ItemReader의 살펴 보도록 하겠습니다  </p>\n<br/>\n<h2 id=\"cursor-based-itemreader\"><a href=\"#cursor-based-itemreader\" aria-label=\"cursor based itemreader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cursor-based ItemReader</h2>\n<p>먼저 설명드릴 것은 Batch 시스템의 <code class=\"language-text\">default</code>로 쓰인다고 할 수 있는 <code class=\"language-text\">Cursor Based ItemReader</code>입니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.54696132596685%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABcRAAAXEQHKJvM/AAACz0lEQVQ4y5WUX0hTURzHz92u03J2/Xc3lbTp0pT+EUVS4TB6qIcEoYgeAskeRHyRnCmb4qbl/12d5XSK7SazUduU7jb/zXu3EGEkPVhELz2Xz1L0kNfT784VkfhnP/jyPefA+fA99/7OQbjjKsZMJcZj1RiPVGE8WIF/tZZFEEJ5iXLiPPhZQpFUCl5I9y0YcyY/46yRCM62r2Kd+xPWTLzHalsES+uqAZ5F4pMb6+Lw/XXRVr0u2mu+bg1XbXw3lPkBQCvkstPgJxGp0IAfyewO3E62hEcT+8O9ir6QpWQ80p/CvLUk9IV7ky0hO80ID9Cm8bJy03BJuVlXoNx6fF35w6hLwUx5EtquXFCJAqE0jLEsv2c2t33SU2t0uLt6XvlMzPS82eycMbWwns6OSXdtoTVIod3q4z3NzsWFjewmh5d9+Ny7YnL5+af+sNAyxfENMH/ETrPHrUE1Es3XkNhbicTuCiQyd9BKnY6IbU+AZFngqnbyMP0zvaB8prTySoOTe6af8PAA9Fs5IdDifOPXO7xLTax3FIAqtEclAvAEeHGrQlm4ReXVfNCW3qx3BYb0E24hCvQJswAMSMDmAwB31jJWNzu8Y3BECRgY5Pi5GJAHoH1fIPwZAlGZBIZx411DkrbLn9/ETgPQEwbgHBx5HoBzAAwBcOxACVUDQtTTGSFBPcAfA6ANgEEAcgD0AZAD4CIAbfECSQDmNUNCPSQ0Q8Ihn7AAwPlYwnFoGzquhHATtNAeXdA2rjaXn7X6Qi+MTk5qo5ew3qkZXMreF3hIdyvqdIeXoBm+CJkiGciwdgTVr1CoepFCje8oZFyjUNtqGtyUYhRvwY2RRET1JUjg5SniGzdK4EUbsdc+IibZX8nkcvJoESlLpUm5Klcay84BPKPtdfSzbIvfFZgafRQQ0oJOgaRXR2ryM6ALoIugnHhPR/6TkPwv8Z/5jvoNF+xTrwoP8ckAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cursor-based-itemReader\"\n        title=\"cursor-based-itemReader\"\n        src=\"/static/ca409cac0c190462dec2f12893f0b5de/36727/cursor-based-itemReader.png\"\n        srcset=\"/static/ca409cac0c190462dec2f12893f0b5de/acf4b/cursor-based-itemReader.png 173w,\n/static/ca409cac0c190462dec2f12893f0b5de/fc834/cursor-based-itemReader.png 345w,\n/static/ca409cac0c190462dec2f12893f0b5de/36727/cursor-based-itemReader.png 690w,\n/static/ca409cac0c190462dec2f12893f0b5de/6b7c3/cursor-based-itemReader.png 905w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<br/>\n<p>Java의 <code class=\"language-text\">ResultSet</code>클래스는 <code class=\"language-text\">Cursor</code>를 조작하여 데이터를 읽어 옵니다<br>\n데이터 베이스에 Cursor를 지정해 두고 <code class=\"language-text\">next</code>를 통해서 Cursor의 위치를 <strong>이동해 가면서 차례대로</strong> 가져옵니다  </p>\n<br/>\n<p>이러한 전략에 따라 장점과 단점 그리고 유의 해야할 점이 발생 합니다<br>\n먼저 이러한 유의사항들을 알아보고 Spring Batch에 제공하는 <strong>3가지</strong>의 <code class=\"language-text\">Cursor-based ItemReader</code>에 대해 알아보겠습니다  </p>\n<hr>\n<h3 id=\"장점\"><a href=\"#%EC%9E%A5%EC%A0%90\" aria-label=\"장점 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장점</h3>\n<ol>\n<li><strong>뛰어난 퍼포먼스를 가진다</strong>👍<br>\n모든 데이터를 조회한 뒤 Cursor설정하고 이동하는 방식으로 데이터를 가져오는 방식은 <code class=\"language-text\">높은 성능</code>을 보여 줍니다<br>\n때문에 이슈가 되지 않는 한 <code class=\"language-text\">Default ItemReader</code>로 사용하기 좋습니다<br>\n<br/>    </li>\n<li><strong>Batch 프로세스 동작동안에 데이터 무결성이 유지된다</strong><br>\n스냅샷 방식으로 동작하기 때문에 데이터의 변경에 대해 안전합니다<br>\nConnection을 맺고 <span class='red_font'>Close</span>하기 전까지 DB 트랜잭션을 무시 합니다  </li>\n</ol>\n<br/>\n<h3 id=\"단점\"><a href=\"#%EB%8B%A8%EC%A0%90\" aria-label=\"단점 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단점</h3>\n<ol>\n<li><strong>메모리 사용량이 높다</strong><br>\n스냅샷 방식을 사용하기 때문에 많은 메모리를 사용합니다<br>\n<br/>    </li>\n<li><strong>멀티 쓰레드 환경 사용 불가</strong><br>\n<code class=\"language-text\">단일 ResultSet</code>을 가지기 때문에 <span class='red_font'>Thread Safe 하지 않습니다</span><br>\n<br/></li>\n<li><strong>긴 Timeout 설정이 필요할 수 있다</strong><br>\n<code class=\"language-text\">Cursor</code>가 <span class='red_font'>Close</span>전까지 유지되기 때문에 충분한 <code class=\"language-text\">Timeout 시간</code>이 필요합니다  </li>\n</ol>\n<br/>\n<br/>\n<p><strong>장점보다 단점이 많아 보이지만 <code class=\"language-text\">성능상 유리</code>하기 때문에 사용하기 좋습니다</strong><br>\n멀티 쓰레드 환경이 아니고 메모리 사용량도 엄청큰 대량의 데이터가 아닌 이상 사용상 문제는 없습니다  </p>\n<br/>\n<hr>\n<p>다음은 Spring Batch에서 제공하는 <code class=\"language-text\">Cursor-based ItemReader 3가지</code>에 대해 알아보겠습니다  </p>\n<p><strong>Cursor-based ItemReader</strong>  </p>\n<blockquote>\n<ol>\n<li>JdbcCursorItemReader   </li>\n<li>HibernateCursorItemReader  </li>\n<li>StoredProcedureItemReader  </li>\n</ol>\n</blockquote>\n<br/>\n<hr>\n<h3 id=\"1-jdbccursoritemreader\"><a href=\"#1-jdbccursoritemreader\" aria-label=\"1 jdbccursoritemreader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JdbcCursorItemReader</h3>\n<p><code class=\"language-text\">JdbcCursorItemReader</code>는 가장 <code class=\"language-text\">기본</code>이 되는 <code class=\"language-text\">ItemReader</code>입니다 👉  <a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/src/main/java/com/github/renuevo/config/JdbcCursorItemReaderJobConfig.java\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a><br>\n간편하게 구현 가능합니다<br>\n먼저 데이터를 담을 <code class=\"language-text\">VO 객체</code>를 하나 만들어 줍니다<br>\n여기서는 이후 예제들에서 사용할 JPA도 고려해서 <code class=\"language-text\">Entity</code>로 생성해 주었습니다  </p>\n<p><a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/src/main/java/com/github/renuevo/entity/Pay.java\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Pay.class</a>  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Pay</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DateTimeFormatter</span> DATE_TIME_FORMATTER <span class=\"token operator\">=</span> <span class=\"token class-name\">DateTimeFormatter</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofPattern</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy-MM-dd hh:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> amount<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> txName<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> txDateTime<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Pay</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> amount<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> txName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> txDateTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>amount <span class=\"token operator\">=</span> amount<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>txName <span class=\"token operator\">=</span> txName<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>txDateTime <span class=\"token operator\">=</span> <span class=\"token function\">convertStringToTime</span><span class=\"token punctuation\">(</span>txDateTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Pay</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> amount<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> txName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> txDateTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>amount <span class=\"token operator\">=</span> amount<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>txName <span class=\"token operator\">=</span> txName<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>txDateTime <span class=\"token operator\">=</span> <span class=\"token function\">convertStringToTime</span><span class=\"token punctuation\">(</span>txDateTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> <span class=\"token function\">convertStringToTime</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> txDateTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>txDateTime<span class=\"token punctuation\">,</span> DATE_TIME_FORMATTER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>❓ 참고로 어노테이션이 많은 게 보기 싫을 수도 있지만 <code class=\"language-text\">Entity</code>에 대해서는 <code class=\"language-text\">양방향 관계</code>로 <code class=\"language-text\">deadlock</code>이 생길 수 있어서 <code class=\"language-text\">@Data</code>을 사용하지 않고 있습니다<br>\n<a href=\"https://www.inflearn.com/questions/5788\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">왜 @Data을 사용하지 않았는가?</a>  </p>\n<br/>\n<p>다음은 드디어 <code class=\"language-text\">JdbcCursorItemReader</code>의 구현을 살펴 보겠습니다 👉 <a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/src/main/java/com/github/renuevo/config/JdbcCursorItemReaderJobConfig.java\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a>    </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JdbcCursorItemReaderJobConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DataSource</span> dataSource<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> chunkSize <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//트랜잭션 범위</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">jdbcCursorItemReaderStep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jdbcCursorItemReaderStep\"</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">//step name</span>\n                <span class=\"token punctuation\">.</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span><span class=\"token function\">chunk</span><span class=\"token punctuation\">(</span>chunkSize<span class=\"token punctuation\">)</span> <span class=\"token comment\">//Reader의 반환타입 &amp; Writer의 파라미터타입</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">reader</span><span class=\"token punctuation\">(</span><span class=\"token function\">jdbcCursorItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">writer</span><span class=\"token punctuation\">(</span>list <span class=\"token operator\">-></span> list<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pay</span><span class=\"token operator\">:</span><span class=\"token operator\">:</span><span class=\"token function\">toString</span><span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>log<span class=\"token operator\">:</span><span class=\"token operator\">:</span><span class=\"token function\">info</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">JdbcCursorItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">jdbcCursorItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcCursorItemReaderBuilder</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n                <span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jdbcCursorItemReader\"</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">//reader name</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">fetchSize</span><span class=\"token punctuation\">(</span>chunkSize<span class=\"token punctuation\">)</span> \n                <span class=\"token punctuation\">.</span><span class=\"token function\">dataSource</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">rowMapper</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanPropertyRowMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  </span>                <span class=\"token punctuation\">.</span><span class=\"token function\">sql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT id, amount, tx_name, tx_date_time FROM pay\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">JdbcCursorItemReaderBuilder</code>의 요소를 살펴 보겠습니다  </p>\n<ol>\n<li>name : ItemReader의 이름  </li>\n<li>fetchSize : 한번에 읽어올 Size  </li>\n<li>dataSource : 연결할 DB의 dataSource  </li>\n<li>rowMapper : 가져온 data를 Object로 바꿔줄 Mapper  </li>\n<li>sql : 쿼리!  </li>\n</ol>\n<p>각각의 요소들은 직관적이게 잘 만들어져 있어서 이해하는데 어려움은 없을 것입니다  </p>\n<br/>\n<p><strong>여기서 rowMapper만 좀더 살펴 보겠습니다</strong>    </p>\n<ol>\n<li><code class=\"language-text\">BeanPropertyRowMapper</code>는 Class를 받아서 각각의 이름에 맞게 객체를 매핑해줍니다<br>\n<code class=\"language-text\">Converter</code>을 등록하여 타입 변환 전략도 확장 가능합니다\n<a href=\"https://github.com/benelog/spring-jdbc-tips/blob/master/spring-jdbc-core.md#beanpropertyrowmapper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BeanPropertyRowMapper 설명 더보기</a><br>\n<br/></li>\n<li><code class=\"language-text\">ColumnMapRowMapper</code>을 사용하면 Map의 형태로 받아 올 수 있습니다\n<a href=\"https://github.com/benelog/spring-jdbc-tips/blob/master/spring-jdbc-core.md#columnmaprowmapper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ColumnMapRowMapper 설명 더보기</a><br>\n<br/></li>\n<li>\n<p><code class=\"language-text\">RowMapper Custom 구현</code>도 가능합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomerPayRowMapper</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">RowMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n \n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> ID_COLUMN <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> AMOUNT_COLUMN <span class=\"token operator\">=</span> <span class=\"token string\">\"amount\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> TX_NAME_COLUMN <span class=\"token operator\">=</span> <span class=\"token string\">\"tx_name\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> TX_DATE_TIME_COLUMN <span class=\"token operator\">=</span> <span class=\"token string\">\"tx_date_time\"</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token class-name\">Pay</span> <span class=\"token function\">mapRow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ResultSet</span> rs<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> rowNum<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Pay</span><span class=\"token punctuation\">(</span>rs<span class=\"token punctuation\">.</span><span class=\"token function\">getLong</span><span class=\"token punctuation\">(</span>ID_COLUMN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                      rs<span class=\"token punctuation\">.</span><span class=\"token function\">getLong</span><span class=\"token punctuation\">(</span>AMOUNT_COLUMN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                      rs<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span>TX_NAME_COLUMN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                      rs<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span>TX_DATE_TIME_COLUMN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<br/>\n<p>그리고 <code class=\"language-text\">--job.name=jdbcCursorItemReaderJob</code>과 같이 실행해보면 다음과 같은 결과를 얻을 수 있습니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.32166018158236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAZUlEQVQI1zWNWQ6AMAhEvY4kNmliVyxNvf+dRkD9ILNAHhvFCEoJVCuoNdB1gXrHXgpCCBhjoOpOpkBEPM850fT299avdbtuDjxPUM7vGFRh5g8FdoUXzczsY9nUnjD3r2OHm38AmA9CAE7zaFEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jdbcCursorItemReader\"\n        title=\"jdbcCursorItemReader\"\n        src=\"/static/ca5d1bb718bc9264b6f26acf12f015ed/36727/jdbcCursorItemReader.png\"\n        srcset=\"/static/ca5d1bb718bc9264b6f26acf12f015ed/acf4b/jdbcCursorItemReader.png 173w,\n/static/ca5d1bb718bc9264b6f26acf12f015ed/fc834/jdbcCursorItemReader.png 345w,\n/static/ca5d1bb718bc9264b6f26acf12f015ed/36727/jdbcCursorItemReader.png 690w,\n/static/ca5d1bb718bc9264b6f26acf12f015ed/0fafd/jdbcCursorItemReader.png 771w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<br/>\n<hr>\n<h3 id=\"2-hibernatecursoritemreader\"><a href=\"#2-hibernatecursoritemreader\" aria-label=\"2 hibernatecursoritemreader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. HibernateCursorItemReader</h3>\n<p>다음은 <code class=\"language-text\">HibernateCursorItemReader</code>입니다<br>\nHibernateCursorItemReader는 DataSource 대신에 SessionFactory를 사용합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">HibernateCursorItemReader</span> <span class=\"token function\">hibernateCursorItemReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionFactory</span> sessionFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HibernateCursorItemReaderBuilder</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hibernateCursorItemReader\"</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">sessionFactory</span><span class=\"token punctuation\">(</span>sessionFactory<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">queryString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"from Pay\"</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<hr>\n<h3 id=\"3-storedprocedureitemreader-docs\"><a href=\"#3-storedprocedureitemreader-docs\" aria-label=\"3 storedprocedureitemreader docs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. StoredProcedureItemReader <a href=\"https://docs.spring.io/spring-batch/docs/current/reference/html/readersAndWriters.html#StoredProcedureItemReader\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Docs</a></h3>\n<p>다음은 <code class=\"language-text\">StoredProcedureItemReader</code>입니다<br>\nDB에 Procedure로 등록해둔 액션으로 가져오는 방식입니다<br>\n개인적으로 별로 선호하지 않는 방법입니다<br>\n관리 포인트도 2개로 나뉘어 있고 DB에 따라 Recruit 받는 값도 다릅니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">As a returned ResultSet (used by SQL Server, Sybase, DB2, Derby, and MySQL).\nAs a ref-cursor returned as an out parameter (used by Oracle and PostgreSQL).</code></pre></div>\n<br/>\n<p>그리서 Document에 있는 설정 방법만을 보고 넘어가도록 하겠습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">StoredProcedureItemReader</span> <span class=\"token function\">storedProcedureItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">StoredProcedureItemReader</span> storedProcedureItemReader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StoredProcedureItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tstoredProcedureItemReader<span class=\"token punctuation\">.</span><span class=\"token function\">setDataSource</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tstoredProcedureItemReader<span class=\"token punctuation\">.</span><span class=\"token function\">setProcedureName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sp_pay\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tstoredProcedureItemReader<span class=\"token punctuation\">.</span><span class=\"token function\">setRowMapper</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanPropertyRowMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> storedProcedureItemReader<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>이걸 <code class=\"language-text\">Cursor-based ItemReader</code>에 대한 설명이 끝났습니다<br>\n마지막으로 정리해보면</p>\n<br/>\n<ul>\n<li><strong>퍼포먼스가 우수하다</strong></li>\n<li><strong>지속적인 connection을 가지고 있어야 한다</strong></li>\n<li><strong>병렬처리가 불가능하다</strong></li>\n</ul>\n<br/>\n<p>라는 <code class=\"language-text\">특성</code>을 꼭 기억하고 사용하시기 바랍니다<br>\n다음은 이어서 PagingItemReader를 알아 보도록 하겠습니다  </p>\n<br/>\n<hr>\n<h2 id=\"paging-itemreader\"><a href=\"#paging-itemreader\" aria-label=\"paging itemreader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Paging ItemReader</h2>\n<p>다음은 <code class=\"language-text\">Paging ItemReader</code>입니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.54696132596685%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABcRAAAXEQHKJvM/AAACg0lEQVQ4y6XUXU/TUBgH8OfQURUHU2SbGF+mCJEQr0x8uTHRT+CVH0C5IfHGwd6yZpQsgwy6rp1J3YZuFdGFsKF2Q8ZLuy1BMiWaGGP8Aka49wMcn85FTQwS8En+OT0n6a9P29NCKBSigiDQbDZLFUWhoihSn89XB4AehmGuAJABwh68jPM+R9zwn5j5Qo8/rNPu1Ca9Pv+Zuh6/p06lTs11R1xXgef5bUmSthOJxDaC32RZ/u73+18i0IHgAI5XwcK6cGQdUuVWm1BJHRCqk+xUJdY/XRfaxVqsdao6eThWSdlF4y54PB5rIBCwDg4OWoPBoNXr9ba73e5D8LPaMecwLTcpJQ5h+WR4Jj8UzM5PROeKvLhQHhubfcFzan48PDM/1Cuv2mCnYlmW/DnvGE6zzrjh8qoLWXcmv8HnSvqDUtXgnmn6cKbwBtfV8/KqEziOg0gkAuFwGKLRaOMYu/4Ftdi6GnCnVLM44/oZn7qQHM7kdQRLsmYscrOvSiPZwppPLSQRdMBuhS+iMXaKRutfYNF4jeCiCfr/A0whaCC4KGn6UhPUEUztF0wjWEVwCW+5jOASghUE0/sFFQRXEdQQLCKoIbiCoLJX0Hwpp/3Y4Qh2OIYdJorGMoLlZofTuG3se+oQv4Qe3B4T7kwhN5orqXKx8iQ4q6k4f47r4y5prXtXsO3G7cbYFcoRu6j3Af/2GHCfOuD+hg3urNjA884GwY82GN08il/KBdhrUUrha+kRofU5QrfWCa09JVtaktAVhex2LmPu62YYIMTCdJ+1MPZTzJF7EjinP4B9stx4JL+j74iZV+vHXMNcbOYSxvzr9MI+y0RbMZbmMWl2/c9b+wEan0/s5FXW0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pagingitemReader\"\n        title=\"pagingitemReader\"\n        src=\"/static/f9b82e70aefca0bd0204e9536d6ddb55/36727/pagingitemReader.png\"\n        srcset=\"/static/f9b82e70aefca0bd0204e9536d6ddb55/acf4b/pagingitemReader.png 173w,\n/static/f9b82e70aefca0bd0204e9536d6ddb55/fc834/pagingitemReader.png 345w,\n/static/f9b82e70aefca0bd0204e9536d6ddb55/36727/pagingitemReader.png 690w,\n/static/f9b82e70aefca0bd0204e9536d6ddb55/6b7c3/pagingitemReader.png 905w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<br/>\n<p><code class=\"language-text\">Paging ItemReader</code>는 이전 <code class=\"language-text\">Cursor방식</code>과는 다르게 매번 호출마다 <code class=\"language-text\">Connection</code>을 맺게 됩니다<br>\n때문에 얻어지는 장점과 단점 그리고 <span class=red_font>주의</span>해야할 사항들이 생기게 됩니다  </p>\n<hr>\n<h3 id=\"장점-1\"><a href=\"#%EC%9E%A5%EC%A0%90-1\" aria-label=\"장점 1 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장점</h3>\n<ol>\n<li><strong>Timeout 설정에서 자유롭다</strong><br>\n한번의 <code class=\"language-text\">Connection</code>을 유지하는 방식이 아니기 때문에 Itmeout설정에 문제가 없습니다<br>\n<br/>    </li>\n<li><strong>매번 새로운 참조로 메모리 이슈가 없다</strong><br>\n이전 Cursor 방식과 달리 매번 새로운 연결로 실시간 데이터를 받아 오기 때문에 스냅샷 같은 상태값 저장을 하지 않습니다<br>\n하지만 이 <code class=\"language-text\">장점</code>때문에 데이터 <span clsss='red_font'>무결성이 깨지게</span> 됩니다<br>\n<br/>   </li>\n<li><strong>병렬처리가 가능하다</strong> 🔀<br>\n병렬로 많은 양의 데이터를 빠르게 처리하는 경우 <code class=\"language-text\">Paging ItemReader</code>를 사용하셔야합니다    </li>\n</ol>\n<h3 id=\"단점-1\"><a href=\"#%EB%8B%A8%EC%A0%90-1\" aria-label=\"단점 1 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단점</h3>\n<ol>\n<li><strong>속도가 느리다</strong><br>\n매번 새로운 <code class=\"language-text\">Connection</code>과 <code class=\"language-text\">Sorting</code>으로 속도가 느린편입니다<br>\n<br/>    </li>\n<li><strong>Batch 프로세스 동작동안에 데이터 무결성이 유지되지 않는다</strong><br>\n실시간 데이터를 탐색하는 방식이기 때문에 중간에 데이터가 바뀔수 있습니다<br>\n이점을 유의해서 개발을 해야합니다 👉 <a href=\"https://jojoldu.tistory.com/337\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Paging Reader 주의사항</a><br>\n<br/>   </li>\n<li><strong>정렬이 필수적으로 필요하다</strong><br>\n주의 사항과 같은 <span clsss='red_font'>단점</span>입니다<br>\n<code class=\"language-text\">offset방식</code>으로 값을 읽어오는 특성때문에 <code class=\"language-text\">Sorting</code>을 하지 않을 경우  차례로 데이터를 못 가져 옵니다<br>\n<br/><br>\n<br/>   </li>\n</ol>\n<p><strong>장점보다 단점이 많아 보이지만 <code class=\"language-text\">성능상 유리</code>하기 때문에 사용하기 좋습니다</strong><br>\n멀티 쓰레드 환경이 아니고 메모리 사용량도 엄청큰 대량의 데이터가 아닌 이상 사용상 문제는 없습니다  </p>\n<br/>\n<hr>\n<p>이제 그럼 Spring Batch에서 제공하는 <code class=\"language-text\">Paging ItemReader</code>를 살펴 보겠습니다\n일부 블로그 글에서는 <code class=\"language-text\">HibernatePagingItemReader</code>도 있지만 여기서는 <a href=\"https://docs.spring.io/spring-batch/docs/current/reference/html/readersAndWriters.html#database\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Document</a>에 나와있는 아래 <code class=\"language-text\">두가지</code>만 설명합니다  </p>\n<p><strong>Paging ItemReader</strong>  </p>\n<blockquote>\n<ol>\n<li>JdbcPagingItemReader  </li>\n<li>JpaPagingItemReader   </li>\n</ol>\n</blockquote>\n<br/>\n<hr>\n<h3 id=\"1-jdbcpaingitemreader\"><a href=\"#1-jdbcpaingitemreader\" aria-label=\"1 jdbcpaingitemreader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JdbcPaingItemReader</h3>\n<p><code class=\"language-text\">JdbcPagingItemReader</code>는 PaingItemReader의 가장 기본적인 Reader 입니다 👉 <a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/src/main/java/com/github/renuevo/config/JdbcPagingItemReaderJobConfig.java\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a><br>\n앞서 Cursor-Base처럼 간편하게 구현 가능합니다<br>\n예제 <code class=\"language-text\">데이터</code>와<code class=\"language-text\">VO</code>는 위에서 사용했던 <code class=\"language-text\">Pay.class</code>를 그대로 사용합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">JdbcPagingItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">jdbcPagingItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> parameterValues <span class=\"token operator\">=</span> <span class=\"token class-name\">Maps</span><span class=\"token punctuation\">.</span><span class=\"token function\">newHashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        parameterValues<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"amount\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//조건절 파라미터</span>\n    \n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcPagingItemReaderBuilder</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">pageSize</span><span class=\"token punctuation\">(</span>chunkSize<span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">fetchSize</span><span class=\"token punctuation\">(</span>chunkSize<span class=\"token punctuation\">)</span></span>                <span class=\"token punctuation\">.</span><span class=\"token function\">dataSource</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">rowMapper</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanPropertyRowMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">queryProvider</span><span class=\"token punctuation\">(</span><span class=\"token function\">createQueryProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">parameterValues</span><span class=\"token punctuation\">(</span>parameterValues<span class=\"token punctuation\">)</span>   <span class=\"token comment\">//Provider Where에 조건 세팅</span></span>                <span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jdbcPagingItemReader\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PagingQueryProvider</span> <span class=\"token function\">createQueryProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SqlPagingQueryProviderFactoryBean</span> queryProviderFactoryBean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SqlPagingQueryProviderFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        queryProviderFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setDataSource</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//Datasource를 통한 DB Type 인식해서 Provider 자동 인식</span>\n\n<span class=\"gatsby-highlight-code-line\">        queryProviderFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setSelectClause</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id, amount, tx_name, tx_date_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        queryProviderFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setFromClause</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"from pay\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        queryProviderFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setWhereClause</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"where amount >= :amount\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//조건</span></span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">></span></span> sortKeys <span class=\"token operator\">=</span> <span class=\"token class-name\">Maps</span><span class=\"token punctuation\">.</span><span class=\"token function\">newHashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//Paging은 매번 다른 Connection을 맺기 때문에 Order가 필수</span>\n<span class=\"gatsby-highlight-code-line\">        sortKeys<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">.</span>ASCENDING<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n        queryProviderFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setSortKeys</span><span class=\"token punctuation\">(</span>sortKeys<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> queryProviderFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>JdbcPageItemReader는 크게 2개의 메소드로 나눠서 구성합니다<br>\nPagingItemReader는 <code class=\"language-text\">JdbcPagingItemReaderBuilder</code>로 틀을 구성하는데 주요설정은 2부분으로 나뉩니다<br>\nReader의 <code class=\"language-text\">Size</code>지정과 <code class=\"language-text\">QueryProvider</code>로 Query를 정의합니다  </p>\n<br/>\n<p><strong>Size는 <code class=\"language-text\">PageSize</code>와 <code class=\"language-text\">FetchSize</code> 2가지가 존재합니다</strong><br>\n서로 다른의미를 가지며 같은 크기를 지정하는 것이 일반적이라 <code class=\"language-text\">chunkSize</code>를 똑같이 지정하였습니다<br>\n관련해서 자세한 사항은 이전 포스팅을 참고해주세요 👉 <a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-1/#page-size-%EC%99%80-chunk-size\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chunk Size와 Paging Size</a>  </p>\n<br/>\n<p><code class=\"language-text\">QueryProvider</code>는 <code class=\"language-text\">queryProviderFactoryBean</code>로 지정해 줍니다<br>\n쿼리의 기본구조로 <code class=\"language-text\">setFromClause</code>, <code class=\"language-text\">setFromClause</code>, <code class=\"language-text\">setWhereClause</code>설정하여 쿼리를 생성합니다<br>\n<code class=\"language-text\">JPQL</code>로 쿼리를 작성하였고 관련 유동적 Parameter는 parameterValues를 통해 지정해 주었습니다   </p>\n<br/>\n<p><strong>그리고 PagingItemReader의 <span class='red_font'>필수요소</span>인 <code class=\"language-text\">Sorting</code>이 필요합니다</strong><br>\n<code class=\"language-text\">setSortKeys</code>를 통해 정렬을 설정하는 것으로 PagingItemReader의 생성이 끝이 납니다  </p>\n<br/>\n<p>다음과 같이 설정하면 정상적으로 Pay를 읽어서 출력됩니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.409961685823754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAkUlEQVQI1zWPbRKDIAxEvU2/1CIQQgA71fb+V9qSVH+8eSST2VkG7xlMGYUFOWW0LHiVAoqMZ2gg2ZHKx4h5s3n2BaPLuDwCrmM0nwyzS1h8QggMDVfHqO+EaZEeWg/aQYWLrbNasHKfE24TmQffA7SNtlJWEZTeMoQe2I9JNiy0mgO/wfULKrtZW587rv9f/ADLWWGhWOgEqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jdbcPagingItemReader\"\n        title=\"jdbcPagingItemReader\"\n        src=\"/static/6270f730bc9a372dffa16cd0eb9641c0/36727/jdbcPagingItemReader.png\"\n        srcset=\"/static/6270f730bc9a372dffa16cd0eb9641c0/acf4b/jdbcPagingItemReader.png 173w,\n/static/6270f730bc9a372dffa16cd0eb9641c0/fc834/jdbcPagingItemReader.png 345w,\n/static/6270f730bc9a372dffa16cd0eb9641c0/36727/jdbcPagingItemReader.png 690w,\n/static/6270f730bc9a372dffa16cd0eb9641c0/17fa4/jdbcPagingItemReader.png 1035w,\n/static/6270f730bc9a372dffa16cd0eb9641c0/cac76/jdbcPagingItemReader.png 1044w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<br/>\n<hr>\n<h3 id=\"2-jpapagingitemreader\"><a href=\"#2-jpapagingitemreader\" aria-label=\"2 jpapagingitemreader permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. JpaPagingItemReader</h3>\n<p>마지막으로 알아볼 <code class=\"language-text\">JpaPagingItemReader</code>입니다 <a href=\"https://github.com/renuevo/spring-boot-in-action/blob/master/spring-boot-batch-in-action/src/main/java/com/github/renuevo/config/JpaPagingItemReaderJobConfig.java\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a><br>\n앞서 본 JdbcPagingItemReader 보다 직관적이여서 저는 이 방법을 더 선호합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">JpaPagingItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">jpaPagingItemReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JpaPagingItemReaderBuilder</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jpaPagingItemReader\"</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">entityManagerFactory</span><span class=\"token punctuation\">(</span>entityManagerFactory<span class=\"token punctuation\">)</span> <span class=\"token comment\">//DataSource가 아닌 EntityManagerFactory를 통한 접근  </span></span>                <span class=\"token punctuation\">.</span><span class=\"token function\">pageSize</span><span class=\"token punctuation\">(</span>chunkSize<span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">queryString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT p FROM Pay p WHERE amount >= 2000 ORDER BY id ASC\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//ORDER 조건은 필수!  </span></span>                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 간편하게 구현 가능합니다<br>\n<span class='red_font'>주의할 점</span>인 <code class=\"language-text\">정렬조건</code> 추가만 안 잊으면 됩니다   </p>\n<br/>\n<hr>\n<p>마지막으로 추가적으로 <code class=\"language-text\">JpaRepository</code>를 사용하는 방식입니다<br>\n일반적으로 ItemReader를 따로 구현해서 Repository를 사용할 경우 일반적으로 <code class=\"language-text\">new ListItemReader&lt;&gt;(jpaRepository.findByAmount(amount))</code>와 같이 구현 할 경우\n<span class='red_font'>Batch의 장점인 Paging을 처리하지 않게 됩니다</span><br>\n그래서 JpaRepository 구현이 필요하신분은 기본적으로 Paging이 지원되는 <code class=\"language-text\">RepositoryItemReader</code>를 사용하는것을 추천드립니다 <a href=\"https://stackoverflow.com/questions/43003266/spring-batch-with-spring-data/43986718#43986718\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RepositoryItemReader Example</a>  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RepositoryItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">reader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RepositoryItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pay</span><span class=\"token punctuation\">></span></span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RepositoryItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function\">setRepository</span><span class=\"token punctuation\">(</span>payRepository<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function\">setMethodName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"findAll\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function\">setSort</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">singletonMap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Sort</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Direction</span><span class=\"token punctuation\">.</span>ASC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> reader<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<hr>\n<h2 id=\"관련-참고\"><a href=\"#%EA%B4%80%EB%A0%A8-%EC%B0%B8%EA%B3%A0\" aria-label=\"관련 참고 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관련 참고</h2>\n<p><a href=\"https://stackoverflow.com/questions/43003266/spring-batch-with-spring-data/43986718#43986718\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RepositoryItemReader</a><br>\n<a href=\"https://docs.spring.io/spring-batch/docs/current/reference/html/readersAndWriters.html#database\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch Docs</a><br>\n<a href=\"https://stackoverflow.com/questions/28719836/spring-batch-problems-mix-data-when-converting-to-multithread\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Cursor-based ItemReader Thread Safe</a><br>\n<a href=\"https://github.com/benelog/spring-jdbc-tips/blob/master/spring-jdbc-core.md#beanpropertyrowmapper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">spring-jdbc-tips</a><br>\n<a href=\"https://jojoldu.tistory.com/336\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">기억보단 기록을</a>  </p>","frontmatter":{"title":"[Spring] 3. Spring Batch의 ItemReader - DB Item Reader","date":"April 01, 2020"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/spring/batch/spring-batch-chapter-3/","previous":{"fields":{"slug":"/docker/docker-hello-world/"},"frontmatter":{"title":"[Docker] Docker 시작하기 - Hello World와 Git Bash","category":"Docker"}},"next":{"fields":{"slug":"/elastic/autocomplete/elastic-autocomplete-1/"},"frontmatter":{"title":"[Elastic] 1. Elastic 자동완성 가이드 (Autocomplete Guide) - Prefix Queries","category":"Elastic"}}}}}