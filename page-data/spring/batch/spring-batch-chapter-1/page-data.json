{"componentChunkName":"component---src-templates-blog-post-js","path":"/spring/batch/spring-batch-chapter-1/","webpackCompilationHash":"9bc18b594d2407556304","result":{"data":{"site":{"siteMetadata":{"title":"renuevo blog","author":"deokhwa kim","siteUrl":"https://renuevo.github.io","comment":{"disqusShortName":"https-renuevo-github-io","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"15967f31-70bc-5f2e-a540-93b04fa1ad79","excerpt":"Spring Batch Guide 시리즈 Spring Batch의 기본 개념 Spring Batch의 ItemReader - File Item Reader Spring Batch의 ItemReader - DB Item Reader Chapter 1에서는 Spring Batch의 구조와 동작 방식의 대한 이야기를 다룹니다   Spring의 DI,AOP,서비스 + Accenture의 Batch 노하우 해당 포스팅의 모든 소스는 Github에서 확인하실 수 있습니다   Batch…","html":"<h3 id=\"spring-batch-guide-시리즈\"><a href=\"#spring-batch-guide-%EC%8B%9C%EB%A6%AC%EC%A6%88\" aria-label=\"spring batch guide 시리즈 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Batch Guide 시리즈</h3>\n<ol>\n<li><a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-1/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch의 기본 개념</a></li>\n<li><a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-2/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch의 ItemReader - File Item Reader</a></li>\n<li><a href=\"https://renuevo.github.io/spring/batch/spring-batch-chapter-3/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch의 ItemReader - DB Item Reader</a></li>\n</ol>\n<br/>\n<hr>\n<br/>\n<p><em>Chapter 1에서는 Spring Batch의 구조와 동작 방식의 대한 이야기를 다룹니다</em>  </p>\n<br/>\n<p><strong><em>Spring의 DI,AOP,서비스 + <a href=\"https://www.accenture.com/us-en\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Accenture</a>의 Batch 노하우</em></strong><br>\n해당 포스팅의 모든 소스는 <a href=\"https://github.com/renuevo/spring-boot-in-action\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github</a>에서 확인하실 수 있습니다  </p>\n<br/>\n<p><em>Batch 를 통한 일괄처리</em></p>\n<p><strong><em>Spring Batch의 특성</em></strong></p>\n<ol>\n<li>자동화 - 개입 없이 <code class=\"language-text\">자동 실행</code></li>\n<li>견고성 - <code class=\"language-text\">충돌/중단</code> 없는 안전한 처리</li>\n<li>신뢰성 -  이슈 처리를 추적 할 <code class=\"language-text\">로깅/알림</code> 기능</li>\n<li>성능 - 처리 완료와 독립적 수행의 대한 <code class=\"language-text\">퍼포먼스</code> 확보</li>\n</ol>\n<hr>\n<h2 id=\"data-code-classlanguage-textreadercode와-code-classlanguage-textwritercode를-지원\"><a href=\"#data-code-classlanguage-textreadercode%EC%99%80-code-classlanguage-textwritercode%EB%A5%BC-%EC%A7%80%EC%9B%90\" aria-label=\"data code classlanguage textreadercode와 code classlanguage textwritercode를 지원 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data <code class=\"language-text\">Reader</code>와 <code class=\"language-text\">Writer</code>를 지원</h2>\n<table>\n<thead>\n<tr>\n<th>DataSource</th>\n<th>기술</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Database</td>\n<td>JDBC</td>\n<td>페이징, 커서, 일괄 업데이트등</td>\n</tr>\n<tr>\n<td>Database</td>\n<td>Hibernate</td>\n<td>페이징, 커서</td>\n</tr>\n<tr>\n<td>Database</td>\n<td>JPA</td>\n<td>페이징 (커서 기능 삭제됨)</td>\n</tr>\n<tr>\n<td>File</td>\n<td>Flat file</td>\n<td>지정한 구분자로 파싱</td>\n</tr>\n<tr>\n<td>File</td>\n<td>XML</td>\n<td>XML 파싱</td>\n</tr>\n</tbody>\n</table>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Ibatis 모듈은 현재 삭재 되었고 JDBC ItemReader로 교체를 추천  </code></pre></div>\n<hr>\n<h2 id=\"spring-batch-기본-구조\"><a href=\"#spring-batch-%EA%B8%B0%EB%B3%B8-%EA%B5%AC%EC%A1%B0\" aria-label=\"spring batch 기본 구조 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Batch 기본 구조</h2>\n<p>Spring Batch 실행을 위해서는 다음과 같이 SpringApplication에 annotation을 선언해 주는것 부터 시작합니다    </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"gatsby-highlight-code-line\"><span class=\"token annotation punctuation\">@EnableBatchProcessing</span>  </span><span class=\"token annotation punctuation\">@SpringBootApplication</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BatchApplication</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BatchApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>다음으로 Spring Batch의 구조를 확인하겠습니다<br>\nSpring Batch는 크게 계층형 구조를 이루고 있습니다  </p>\n<br/>\n<p><strong>Job > Step > Task</strong>  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.83087861858812%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACvElEQVQozz2S22sTQRTG84f47v8hFPxHfPVBFPRJBR9UEAQviBUUwUttq7bWqkFttTGX5rLZS2Z3dneS3XQ32dxNO7Va2/M5SYsPHzMcZn585zsnNeDFU23zx++hXZRIPIm2Kw9btoyCqqyJogxalkxGntzq2dIWBel4Ocn9vDSdjPSammx2mQw7llJNRuptSgFPI3HBeBqr2SfI6Iv4FeqIYgMfrEUsqNqGSKO/62LOd3HyrY8T8x7uOg383OUIxh62tl1s7aizx5BqlNZOd60civobWs7O0jf9JXWsH8R5lr54izSff0Dr7hK1RjZ9j306r0V0JiNogTOK+gYFI07NicZKnRql9iM2Q4kDtDnthzWi2MFhzNDtOtBDDxuahqxRQr3P0OhV0YjXwbxVsCAD3jYQDFR9oqENBURqr2nNUNvB35jRTl2jvaaJg6iGpMPx6I2Gm7M5zKUN6KKADecT7qVv4Pb7a9jcWkM8FlNYqGDByEbct5H6fQw8UMBtUaEuy2NoF9Du2BDbIRrbTYihQL1XUy4t9dGCJjIww02EIweBgol+TYkdOfwPbNm0G5hTYNdS0KSCyJ1DUH2MXrKOaMdFRTDMvirgztMMPhfLCPsa0qaOaysOLi87+FQxj1tOOPYjg6TI0YhnMfY19CMFZg/RLt3CIP4AFTqsJsPbb2W8/lpCllXhxQWsGgYuLdg4N2fj3aZxBMQEyJ9TuHaVdo37QKyh0/MR7AjlTKjVUBo6qkU1rD0XvT8+vKQKFuaxUi7hyhLHxQUHH8vmpGVz6vCg/p6kfpcG5jN0+boaispLuZrk1PzpHOU1uY/Vzqnd87s1uHERy+UKLrxycPaFg6WJw1+hOXOoMtzj89TJXqe49ASR9RmtljEFhANbTVHB1GkFRRj1wlRVPw9D5FAOTKzoNpaqNsquiX/D2PhG74McogAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Spring Batch Diagram\"\n        title=\"Spring Batch Diagram\"\n        src=\"/static/d7545ae38bd4eaee607c4eb49b7f3f95/36727/Ch02_SpringBatchArchitecture_Architecture_StepTaskletFlow.png\"\n        srcset=\"/static/d7545ae38bd4eaee607c4eb49b7f3f95/acf4b/Ch02_SpringBatchArchitecture_Architecture_StepTaskletFlow.png 173w,\n/static/d7545ae38bd4eaee607c4eb49b7f3f95/fc834/Ch02_SpringBatchArchitecture_Architecture_StepTaskletFlow.png 345w,\n/static/d7545ae38bd4eaee607c4eb49b7f3f95/36727/Ch02_SpringBatchArchitecture_Architecture_StepTaskletFlow.png 690w,\n/static/d7545ae38bd4eaee607c4eb49b7f3f95/17fa4/Ch02_SpringBatchArchitecture_Architecture_StepTaskletFlow.png 1035w,\n/static/d7545ae38bd4eaee607c4eb49b7f3f95/a5044/Ch02_SpringBatchArchitecture_Architecture_StepTaskletFlow.png 1380w,\n/static/d7545ae38bd4eaee607c4eb49b7f3f95/49956/Ch02_SpringBatchArchitecture_Architecture_StepTaskletFlow.png 1969w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p> <span class='img_caption'>Source : <a href=\"https://terasoluna-batch.github.io/guideline/5.0.0.RELEASE/en/Ch02_SpringBatchArchitecture.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch Architecture</a> </span> </p>\n<p>위에 그림에서 처럼 Job은 Step을 가지고 있고 Step은 Tasklet 인터페이스를 통해 수행 작업들을 가지고 있습니다<br>\nTask는 기본적인 <strong>사용자 정의 형식</strong>과 <strong>read / process / write (RPW) 형식</strong>이 존재합니다<br>\n그럼 각각의 요소들을 정리해 보겠습니다  </p>\n<p><strong>1. Job</strong></p>\n<ul>\n<li>\n<p>Batch Job의 한 단위</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">jobBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> jobBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{Job Name}\"</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">stepBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p><strong>2. Step</strong></p>\n<ul>\n<li>Job내부에서 수행될 1개의 Step</li>\n<li>\n<p>Tasklet에 Step에서 수행할 기능으로 써 2가지의 형태가 존재</p>\n<ul>\n<li>User 커스텀</li>\n<li>Reader &#x26; Processor &#x26; Writer(RPW)가 한 묶음으로 존재</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  <span class=\"token annotation punctuation\">@Bean</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">stepBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{Step Name}\"</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">              <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span> </span><span class=\"gatsby-highlight-code-line\">                  log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is Step ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">                  <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span>              <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<p><strong>파라미터로 Job 실행 지정하기</strong></p>\n<p>Spring Batch는 자체적으로 스케줄 처리를 하는 기능이 없습니다<br>\n그래서 외부에서 Crontab / Jenkins 등을 사용해서 Job을 실행하게 됩니다<br>\n이때 program argument를 통해 job name을 전달해서 원하는 job을 실행 하실 수 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">jobBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> jobBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jpaItemListWriterJob\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">stepBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">batch</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">names</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>job.name<span class=\"token punctuation\">:</span>NONE<span class=\"token punctuation\">}</span></code></pre></div>\n<p>원하는 job을 외부 파라미터로 실행할 경우 다음과 같이 properties로 지정해 줍니다<br>\nproperties를 다음과 같이 지정하므로 모든 job이 실행되는 것을 미연에 방지할 수 있습니다<br>\n그리고 다음으로 program argument 파라미터를 지정해 주시면 됩니다  </p>\n<br/>\n<p>예를 들어 <strong>jpaItemListWriterJob</strong> 이라는 job을 실행하고 싶을 경우 다음과 같이 해주시면 됩니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">program argument : --job.name=jpaItemListWriterJob</code></pre></div>\n<hr>\n<h2 id=\"srping-boot-meta-data\"><a href=\"#srping-boot-meta-data\" aria-label=\"srping boot meta data permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Srping Boot Meta Data</h2>\n<p>Spring Batch에서는 DB를 통해 <code class=\"language-text\">완료/실패</code>와 같은 <code class=\"language-text\">상태관리</code>를 합니다<br>\n크게 4가지의 상태를 DB에 저장하는데  </p>\n<ol>\n<li>이전 실행 Job History</li>\n<li>실패한 Batch와 Parameter / 성공한 Job</li>\n<li>실행 재개 지점</li>\n<li>Job 기준 Step현황과 성공/실패 여부</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.70878459687123%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACVElEQVQoz4VSiW7aQBDl//8mDVGqSlUTSFBwSADbGB9rvOuT9QHeOPheu2OSSq1E1NFoJY/f2zfzZkdL3buarsYz8Wq6HD+ur2fi0vT7vu+6/r8x8mmgarqmG6qmIXOXF2VV11lRE5o6MSP04ESM88s3jXTLni8lYSXDuVJ0UTOJ67vh4eqXcDNdXN8J969q1bSXyd2f/vLTqTsH5zwvToFru8RKaNB3vG2/IDctn6yM70/i7Wx9PXl5kHe87/dRvBA3wlKElFSjrCqAQvP/ZNcBuVWQuVjL642KsEOTFJSbtssbnr7nWV7mVdN94d4IWqJ0bxMMGfheXddQNdxo/LC+mb58u3/+ISinsj4VjWZTw6GavddIsMW+F7OB7AeBZVmmuSuK4kMkSmJJUeWthiwShDFU/Oh4M3m+nS7G9/O7hTxXLOTFo5Zzz/cxxqZpUkr5OVLGbJvYhBCMy7Lsuz4vC9+1aeA5BCrF2QL+qQwwXdeDIBiszvPkeCC2jRCC6wAHHR3T1AIFTDAhVVXzvmsHMueu5501MKDTNAU0yzIHpAc0ZoxB5T3PTRNhy4L64BX43TafZJgZ+NB5GIYw9D6MNooqbRRR3qj6sKokZcMT2hqSihR9B6dJnIFMQ3oWBsPJh9unoozTzA+TfXyMDgxGg62WDa9aXjW8bFrIuuWjummMnXUWGdJ2HHrIJis0k8yfgnz3qj6I6FlzLj7vQXmfMD9Ogzj1oiNNWMKYIG7mK3khbp9eJexH8Vt+mfz3x8f/tyzTDUOD0HWETFik53kXn/dvzcp1CxmBXnIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Spring Batch Meta Data Schema\"\n        title=\"Spring Batch Meta Data Schema\"\n        src=\"/static/55b809cbc69531950dd7c7fa094e4261/36727/meta-data-erd.png\"\n        srcset=\"/static/55b809cbc69531950dd7c7fa094e4261/acf4b/meta-data-erd.png 173w,\n/static/55b809cbc69531950dd7c7fa094e4261/fc834/meta-data-erd.png 345w,\n/static/55b809cbc69531950dd7c7fa094e4261/36727/meta-data-erd.png 690w,\n/static/55b809cbc69531950dd7c7fa094e4261/d181f/meta-data-erd.png 831w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p> <span class='img_caption'>Source : <a href=\"https://docs.spring.io/spring-batch/docs/3.0.x/reference/html/metaDataSchema.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring_Batch_Doc</a> </span> </p>\n<p>해당 Table들은 Spring Batch 동작에 꼭 필요하며 <code class=\"language-text\">H2 DB</code>사용시 자동으로 생성되지만<br>\n그외 DB들은 직접 생성해 주어야합니다</p>\n<p><code class=\"language-text\">DB DDL</code> 쿼리는 org.springframework.batch.core에 포함되어 있고 탐색 및 schema 검색으로 확인할 수 있습니다</p>\n<br/>\n<ol>\n<li>\n<p><strong>BATCH_JOB_INSTANCE</strong>  </p>\n<ol>\n<li>job이 실행 되는 단위  </li>\n<li>job의 name/key/version 등의 정보를 가지고 있습니다  </li>\n</ol>\n</li>\n</ol>\n<br/>\n<ol start=\"2\">\n<li>\n<p><strong>BATCH_JOB_EXCUTION_PARAMS</strong>  </p>\n<ol>\n<li>job과 1:1의 관계를 갖는 parameters 입니다  </li>\n<li>job과 1:1의 속성때문에 param이 다르면 job_instance가 새롭게 생성됩니다  </li>\n<li>Map타입으로 지정데이터를 job에 넘길 수 있습니다  </li>\n</ol>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">jobBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> jobBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testJob\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">stepBean</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token annotation punctuation\">@JobScope</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">stepBean</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#{jobParameters[requestDate]}\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> requestDate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testStep\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span> \n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is Step ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= requestDate {} ==========]\"</span><span class=\"token punctuation\">,</span> requestDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.224008574490888%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAzklEQVQY002Naw6CMBCEOY4UBOSptpS3mJhIRI33P8m4XQv4YzLT7uy3zvR8Y35/cJ9fmEgPysZn67fpgartUdYte90Nq7fDyOqs66aDo3TFw+5y5aJ5L8uqarhUWtf0L0vNHak19RqclcZJKtbxLOEURYEkTVAcT8jynHKKLMs5G5BZjqKIgW0//uAEkqpEHCfwfR9CCJbneXCCMIS7c+G6P5nPJUeHGPsg4BwSNE4zpHQsIR0IZroLaAUK4XFYZQdcItC2sBzdWW2zf+AXIaCkxfOKWQMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Spring Boot Batch Instance\"\n        title=\"Spring Boot Batch Instance\"\n        src=\"/static/a8eae1d0b90346d8518152f99207e91c/36727/spring-boot-batch-instance.png\"\n        srcset=\"/static/a8eae1d0b90346d8518152f99207e91c/acf4b/spring-boot-batch-instance.png 173w,\n/static/a8eae1d0b90346d8518152f99207e91c/fc834/spring-boot-batch-instance.png 345w,\n/static/a8eae1d0b90346d8518152f99207e91c/36727/spring-boot-batch-instance.png 690w,\n/static/a8eae1d0b90346d8518152f99207e91c/5e09a/spring-boot-batch-instance.png 933w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p> <span class='img_caption'>Spring Boot Batch Instance</span> </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.393125671321162%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAm0lEQVQI11WN2xKCMAxE+SihLdD0xmVG0RGRAXH8/89Y0/jkQ2Y3u81pcVvfuDx2TMsL2U/Ljvv2YX/gPG+4Pg8M0wzrI3zq4WInE4cRsR8ROAvdwFmSvQj9r6CQ0LrwNw150dxRBjKIPOfWcUeyCyxEAQuw0gZKa1RKywNTN1DsE5emrkEZ3FqcypIP+VNyslvWfCNTKWYYlKxffFtqJQbfQN0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Spring Boot Batch Param\"\n        title=\"Spring Boot Batch Param\"\n        src=\"/static/041065b97ebf81d1f14a68d0ac3940e7/36727/spring-boot-batch-param.png\"\n        srcset=\"/static/041065b97ebf81d1f14a68d0ac3940e7/acf4b/spring-boot-batch-param.png 173w,\n/static/041065b97ebf81d1f14a68d0ac3940e7/fc834/spring-boot-batch-param.png 345w,\n/static/041065b97ebf81d1f14a68d0ac3940e7/36727/spring-boot-batch-param.png 690w,\n/static/041065b97ebf81d1f14a68d0ac3940e7/36c39/spring-boot-batch-param.png 931w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p> <span class='img_caption'>Spring Boot Batch Param</span></p>\n<ul>\n<li>\n<p>동일 <code class=\"language-text\">Parameter</code>로 실행시 이미 <code class=\"language-text\">Instance</code>가 존재해서 에러가 납니다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.157800358637175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwklEQVQY01WQWRKEIAxEPY8brqXIInL/O2XoOO2MH12hArx0ulrXVUII4r0X51ypQUJM4kMUa61q33etuN+2TTXPsyzLItM0iTFGhmGQruukQjOlpFAoxqjCGQBC72H+gRJQ1/VLFRzmnOU8TwWndD0D8JkgDsM7WxybAoSztm0V1DSN6uWQH1AB4arHcYj/xsEIACPoBUQWBHBtZgoQVyYYdwCO46j59X3/AqvD68pPbqh0zMx+wOLS3T3AkSXA/y4/NbfFLJkHEPsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Parameter Exist Error\"\n        title=\"Parameter Exist Error\"\n        src=\"/static/20d442031bd61e22606261e5e83c4fe0/36727/parameter-exist.png\"\n        srcset=\"/static/20d442031bd61e22606261e5e83c4fe0/acf4b/parameter-exist.png 173w,\n/static/20d442031bd61e22606261e5e83c4fe0/fc834/parameter-exist.png 345w,\n/static/20d442031bd61e22606261e5e83c4fe0/36727/parameter-exist.png 690w,\n/static/20d442031bd61e22606261e5e83c4fe0/17fa4/parameter-exist.png 1035w,\n/static/20d442031bd61e22606261e5e83c4fe0/a5044/parameter-exist.png 1380w,\n/static/20d442031bd61e22606261e5e83c4fe0/856a4/parameter-exist.png 1673w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n</ul>\n<p> <span class='img_caption'>Parameter Exist Error</span></p>\n<ol start=\"3\">\n<li>\n<p><strong>BATCH_JOB_EXECUTION</strong></p>\n<ol>\n<li>batch_job_instance와 대응되면서 <code class=\"language-text\">성공/실패</code> 내역을 갖고 있습니다</li>\n<li>process는 해당 table을 조회해서 재수행이 필요한 job만 처리 합니다</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.88206979542719%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABLUlEQVQoz7WT646DIBCFeZxqRShXrUq13tru7vs/ztkRk6abNK2b7P74cmaADAcYWF1KVJVH1bVo5xF118A5D2MctLLIBEfGOThf9R3s6AVCadGEDuHUIzQnlIWDMhriICG0pIUZsmwbTB4EtBZQ2pAaHJSGshraU+4tlNPI8zw63ALLeI4kSZ6zWzVN080wTrsvwX6//xP+oSD/WTB9mPzNUe9HNq6Atv7OY258AevLqMt4xL+GDfMV0+0T4+WG6fqBmJPONBa6HlVo0bRnNBSH87DGL2Dj7SsWWximC3piiMzohgldP+LUnXGkwmUd4IuSXK/On8EU/QhjLfWghqOFi0NfFNSXGv14wbGqIYSITZsku/d3mN77bkcNLODIgZAyFnC0oxAyzm995W+zDnp/6je54QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BATCH_JOB_EXECUTION\"\n        title=\"BATCH_JOB_EXECUTION\"\n        src=\"/static/423d6616f1c839da11d35f858df96535/36727/job-completed.png\"\n        srcset=\"/static/423d6616f1c839da11d35f858df96535/acf4b/job-completed.png 173w,\n/static/423d6616f1c839da11d35f858df96535/fc834/job-completed.png 345w,\n/static/423d6616f1c839da11d35f858df96535/36727/job-completed.png 690w,\n/static/423d6616f1c839da11d35f858df96535/d181f/job-completed.png 831w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n</ol>\n<p> <span class='img_caption'>BATCH<em>JOB</em>EXECUTION</span></p>\n<p>이외의 Step과 관련된 Meta Table은 생략하겠습니다<br>\nJob과 비슷하므로 한번 실행해 보시면 바로 이해 가능하실껍니다  </p>\n<p>추가적으로 Batch에서 Meta Table을 사용하지 않고 RunIdIncrementer을 설정해서 실행도 가능합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">autoIncrementJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> jobBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"autoIncrementJob\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">incrementer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RunIdIncrementer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">autoIncrementStep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>⚠  <span class='red_font'>하지만 이 방식은 기존의 Spring Batch을 상태관리의 장점을 지워버리므로 추천드리지 않습니다</span>  </p>\n<hr>\n<h2 id=\"spring-batch-flow\"><a href=\"#spring-batch-flow\" aria-label=\"spring batch flow permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Batch Flow</h2>\n<p>다음은 Batch으 흐름제어 입니다<br>\n여기서는 간단하게 실패와 성공 등등의 여부의 흐름만을 설명합니다<br>\n이후 <code class=\"language-text\">skip</code>과 같은 예외사항의 대한 흐름제어는 3부에서 설명하겠습니다<br>\n여기서는 기본적인 Job의 흐름제어는 상태를 저장하고 그 상태의 대한 조건으로 흐름을 제어합니다  </p>\n<br/>\n<p><span class='code_header'><strong>기본적은 상태 저장</strong></span>  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">contribution<span class=\"token punctuation\">.</span><span class=\"token function\">setExitStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExitStatus</span><span class=\"token punctuation\">.</span>FAILED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//setExitStatus로 상태를 저장 할 수 있다</span></code></pre></div>\n<p><strong>흐름 제어 메소드</strong></p>\n<ol>\n<li>on - 이전 step의 status에 대한 다음 행동</li>\n<li>to - on과 연결된 다음 행동</li>\n<li>end - 반환 / build 종료 2가지가 존재 맺음 메소드</li>\n<li>from - on과 end 이외 추가전 이벤트 캐치 사용에 사용  </li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JobSecondConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">JobBuilderFactory</span> jobBuilderFactory<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">StepBuilderFactory</span> stepBuilderFactory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">jobSecondBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> jobBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testJob2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">jobStep1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"FAILED\"</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">//FAILED 이면</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">jobStep3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//step3 실행</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//to와 관계없이</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//반환 종료</span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token function\">jobStep1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//on을 사용한후 추가적 이벤트 캐치</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">//FAILED외의 모든 것</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">jobStep2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//step2 실행</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token function\">jobStep3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">//정상 종료되면 step3 실행</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">//step3 결과 상관없이</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//반환 종료</span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//build 종료</span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">jobStep1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"step1\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is Step1 ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                    contribution<span class=\"token punctuation\">.</span><span class=\"token function\">setExitStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExitStatus</span><span class=\"token punctuation\">.</span>FAILED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//Status Failed  </span></span>                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">jobStep2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"step2\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is Step2 ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">jobStep3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"step3\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is Step3 ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    contribution<span class=\"token punctuation\">.</span><span class=\"token function\">setExitStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExitStatus</span><span class=\"token punctuation\">.</span>FAILED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//Status Failed </span>\n                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위에서 <code class=\"language-text\">하이라이팅</code>된 부분을 보시면 어떤 형식으로 흐름제어를 하는지 한눈에 들어 오실 겁니다<br>\n그리고 실행해보면 아래와 같은 결과를 얻으실 수 있습니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.114157806379406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAZUlEQVQI1z3MWQ7AIAhF0W5HjCPWse5/Wa8Q037cEEI4Vy03vHMorYF6B80JsxZcznhk7r3R5JZl15gZMUaEEE7ew1oLYwyICNfNBU5ArhWk6DiognMMLEEVTCnBy/MPSR+s8+sF7Us/Q/MzXs0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Fail Flow\"\n        title=\"Fail Flow\"\n        src=\"/static/f48ae9b7ae70e38974af215ff6a9c0f7/36727/job-step1.png\"\n        srcset=\"/static/f48ae9b7ae70e38974af215ff6a9c0f7/acf4b/job-step1.png 173w,\n/static/f48ae9b7ae70e38974af215ff6a9c0f7/fc834/job-step1.png 345w,\n/static/f48ae9b7ae70e38974af215ff6a9c0f7/36727/job-step1.png 690w,\n/static/f48ae9b7ae70e38974af215ff6a9c0f7/17fa4/job-step1.png 1035w,\n/static/f48ae9b7ae70e38974af215ff6a9c0f7/a5044/job-step1.png 1380w,\n/static/f48ae9b7ae70e38974af215ff6a9c0f7/7d213/job-step1.png 1787w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span class='img_caption'>Fail Flow</span></p>\n<p>다음은 정상적으로 <code class=\"language-text\">FINISHED</code>로 끝난 코드입니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">jobStep1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"step1\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is Step1 ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                    <span class=\"token comment\">/* contribution.setExitStatus(ExitStatus.FAILED); */</span>  </span>                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.03904071388734%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAW0lEQVQI13XMQQ6AIAxEUa5DKa1EMFD0/scaGxbGmLj4mVm9YDZxXobed6hsKMcB6h00J7hW2Bgw/6UUiAhU9VlmRowRRLRKKSH8gmbg1jD8Twer41/wXc55oTf4QT88CCDfNQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Standard Flow\"\n        title=\"Standard Flow\"\n        src=\"/static/8a76897c204337c8d094cc928934a9d1/36727/job-step.png\"\n        srcset=\"/static/8a76897c204337c8d094cc928934a9d1/acf4b/job-step.png 173w,\n/static/8a76897c204337c8d094cc928934a9d1/fc834/job-step.png 345w,\n/static/8a76897c204337c8d094cc928934a9d1/36727/job-step.png 690w,\n/static/8a76897c204337c8d094cc928934a9d1/17fa4/job-step.png 1035w,\n/static/8a76897c204337c8d094cc928934a9d1/a5044/job-step.png 1380w,\n/static/8a76897c204337c8d094cc928934a9d1/ce243/job-step.png 1793w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span class='img_caption'>Standard Flow</span></p>\n<p><strong>BATCH_STEP_EXECUTION</strong>\n해당 table에서는 <em>각각의 Step에 대한 성공 실패 여부가 기록됩니다</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.99612403100775%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABaUlEQVQoz32S3ZKjIBCFfZwAKpiJEv9AATUmNbN7N+//JGcaMklla2f34qvuhrbtOofMhoBtc5iXAOMXjLPD4BxGH+C3K8JlT0wuoB8tYTBS7pYNM0XrPazz6MMNvd+R6a5F15SYrcU8b5gsDRx6nOoalTpCKoVClsiLHHn+oKC6eNYl3bf+BvPxieyt1ijKAqpSOB5PFI9EBSkrapTgOQcTDFxwcP43jDEURQljJ0wrbVjREEF/YewAxiMswb8R9JHg4jveh4gXYh237IYRg7HIerfjbNdEM4Yn2ix/xEeuzfoDC7p5Jw2vyMJ6wf7+G9vtFzytPK9XEvxC5pDYyaQY18RA+nbj9A8sWiKL4jdaJ9quh5nmZIg+n+ECbd3odBajIoOEEC/miBfuZ1lFBrDDIWmoVEWDzzhQLSkfzISylKSPuRtEBsSBP5nzIJPUGJsi8Ym8nep0IaWCbjsaWKJu4kson33/4wsM0iQ5OUuHgAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BATCH_STEP_EXECUTION\"\n        title=\"BATCH_STEP_EXECUTION\"\n        src=\"/static/97bd14e44ce3583ead26b1f3b31ad70a/36727/step-completed.png\"\n        srcset=\"/static/97bd14e44ce3583ead26b1f3b31ad70a/acf4b/step-completed.png 173w,\n/static/97bd14e44ce3583ead26b1f3b31ad70a/fc834/step-completed.png 345w,\n/static/97bd14e44ce3583ead26b1f3b31ad70a/36727/step-completed.png 690w,\n/static/97bd14e44ce3583ead26b1f3b31ad70a/1cbac/step-completed.png 1032w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span class='img_caption'>BATCH<em>STEP</em>EXECUTION</span></p>\n<p>하지만 위의 코드에서는 <span class='red_font'>문제점</span>이 있습니다<br>\n다음으로는 그 문제점들을 알아보고 해결해 보도록 하겠습니다  </p>\n<br/>\n<p><strong>위의 코드의 <code class=\"language-text\">문제점</code></strong></p>\n<ol>\n<li><code class=\"language-text\">Step</code>이 Flow랑 Process처리라는 <code class=\"language-text\">2가지</code>의 역할을 수행 합니다</li>\n<li>ExitStatus로는 다양한 <code class=\"language-text\">Flow 처리</code>에 번거로움이 있습니다</li>\n</ol>\n<h4 id=\"jobexecutiondecider-를-통한-flow-처리\"><a href=\"#jobexecutiondecider-%EB%A5%BC-%ED%86%B5%ED%95%9C-flow-%EC%B2%98%EB%A6%AC\" aria-label=\"jobexecutiondecider 를 통한 flow 처리 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JobExecutionDecider 를 통한 Flow 처리</h4>\n<p>Spring Batch에서는 이를 위해 <code class=\"language-text\">JobExecutionDecider</code>인터페이스를 구현하는 흐름처리를 제공합니다<br>\n이렇게 Step과 Flow 처리를 분리하므로 보다 결합성 낮은 코드를 구현할 수 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">   \t<span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">jobDeciderBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> jobBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deTestJob\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">startStep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token function\">decider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">//JobExecutionDecider()로직 처리</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token function\">decider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">//JobExecutionDecider()결과 확인</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testDecide\"</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">startStep2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">JobExecutionDecider</span> <span class=\"token function\">decider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token function\">jobDecider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> jobDecider <span class=\"token keyword\">implements</span> <span class=\"token class-name\">JobExecutionDecider</span><span class=\"token punctuation\">{</span>\n\n        <span class=\"token annotation punctuation\">@Override</span>\t<span class=\"token comment\">//조건 정의 method</span>\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">FlowExecutionStatus</span> <span class=\"token function\">decide</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JobExecution</span> jobExecution<span class=\"token punctuation\">,</span> <span class=\"token class-name\">StepExecution</span> stepExecution<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FlowExecutionStatus</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testDecide\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>JobExecutionDecider</strong>로 Flow를 제어하여 역할을 분리하고 유동적으로 많은 조건들을 생성해서 적용 가능합니다  </p>\n<br/>\n<hr>\n<h2 id=\"jobparameter--scope\"><a href=\"#jobparameter--scope\" aria-label=\"jobparameter  scope permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JobParameter &#x26; Scope</h2>\n<p>Process 운영하다 보면 외부의 데이터를 통한 구현이 필요할 때가 있습니다<br>\n<em>Spring Batch에서는 Barch Component에서 사용할 수 있게 지원되는 파라미터</em>를 제공합니다<br>\n<code class=\"language-text\">jobParameters</code>통해 간단하게 값을 받아 올 수 있습니다<br>\n또한 기본적으로 4가지의 <code class=\"language-text\">Double</code>, <code class=\"language-text\">Long</code>, <code class=\"language-text\">Date</code>, <code class=\"language-text\">String</code> 형식만을 지원합니다  </p>\n<p><span class='code_header'><strong>jobParameter 기본형식</strong></span>  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#{jobParameters[parameterName]}\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<p>⚠ JobParameters를 사용시에는 구현부에 다음과 같은 <code class=\"language-text\">annotation</code>들이 <span class='red_font'>강제</span> 됩니다  </p>\n<p><strong>JobParameter Scope</strong>  </p>\n<ol>\n<li>JobScope : Step 사용시 사용  </li>\n<li>StepScope : Tasklet 사용시 사용  </li>\n</ol>\n<br/>\n<p><em>간단한 예제를 통해 동작 방식을 알아 보겠습니다</em></p>\n<br/>\n<p><span class='code_header'><strong>실행 시 parameter 지정</strong></span>  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">program argument : --job.name=jobScope requestDate=20200203</code></pre></div>\n<p>실행은 다음과 같이 jobScope라는 job을 실행하며 뒤에 requestDate라는 파라미터를 주게 됩니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JobParameterConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">JobBuilderFactory</span> jobBuilderFactory<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">StepBuilderFactory</span> stepBuilderFactory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Job</span> <span class=\"token function\">jobScopeBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> jobBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jobScope\"</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token function\">scopeStep1</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> </span>                <span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token function\">scopeStep2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token annotation punctuation\">@JobScope</span>   <span class=\"token comment\">//Step에 대해서 설정 </span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">scopeStep1</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#{jobParameters[requestDate]}\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> requestDate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> </span>        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"scopeStep1\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is scopeStep1 ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span>requestDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Step</span> <span class=\"token function\">scopeStep2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> stepBuilderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"scopeStep2\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">tasklet</span><span class=\"token punctuation\">(</span><span class=\"token function\">scopeStep2Tasklet</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token annotation punctuation\">@StepScope</span>  <span class=\"token comment\">//Tasklet에 대해서 설정</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Tasklet</span> <span class=\"token function\">scopeStep2Tasklet</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#{jobParameters[requestDate]}\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> requestDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>contribution<span class=\"token punctuation\">,</span> chunkContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[========= This is scopeStep2 ==========]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span>requestDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">RepeatStatus</span><span class=\"token punctuation\">.</span>FINISHED<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 하이라이팅된 부분을 보시면 <code class=\"language-text\">Step</code>의 처음에는 <span class='red_font'>null</span>로 입력하지만<br>\n이후 실행에서는 정상적으로 <code class=\"language-text\">20200203</code>라는 값을 얻을 수 있습니다  </p>\n<br/>\n<p>근데 여기서 의문을 가지시는 분들이 계실 수 있습니다<br>\nSpring의 Bean은 기본적으로  <code class=\"language-text\">singleton</code> scope로 구현되어 집니다<br>\n하지만 이렇게 실행되어 지면 외부에서 가져오는 값을 통한 jobParameters 매핑이 어려울 수 있습니다<br>\n그에 대한 해답이 <code class=\"language-text\">@StepScope</code>와 <code class=\"language-text\">@JobScope</code> 입니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@Bean에 @StepScope와 @JobScope를 같이 사용하면 Step의 시작과 종료시 생성/삭제가 이루어지게 됩니다  </code></pre></div>\n<p>즉 해당 annotaion들을 통해서 singleton이 아닌 <code class=\"language-text\">prototype</code>으로 scope가 생성되어 집니다<br>\n<em>거기다.. proxy로요..</em></p>\n<br/>\n<p><code class=\"language-text\">prototype</code>으로 구현되어 얻을수 있는 장점은 크게 <strong>2가지</strong>가 있습니다  </p>\n<ol>\n<li>JobParameter의 Late Binding\n일반적인 Bean 생성시점이 아닌 지점에서 생성 되므로 <code class=\"language-text\">Controller</code>와 <code class=\"language-text\">Service</code>와 같은 <strong>비지니스 로직 처리단계에서 Job Parameter를 할당</strong> 할 수 있게 됩니다</li>\n<li>Component Parallel Processing  👉 <a href=\"https://ko.wikipedia.org/wiki/%EA%B2%BD%EC%9F%81_%EC%83%81%ED%83%9C\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Race Condition 문제</a><br>\n일반적인 <code class=\"language-text\">Singleton</code> 처럼 생성되면 각각의 Step에서 Tasklet의 멤버변수등의 상태를 수정하는 일이 생기면서 데이터가 덮어써지게 됩니다<br>\n<code class=\"language-text\">@StepScope</code>로 <strong>각각의 Step별로 별도의 Tasklet를 생성</strong>하고 관리하게 하므로써 이러한 문제를 해결 할 수 있습니다</li>\n</ol>\n<br/>\n<h3 id=\"jobparameter-주의-사항\"><a href=\"#jobparameter-%EC%A3%BC%EC%9D%98-%EC%82%AC%ED%95%AD\" aria-label=\"jobparameter 주의 사항 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JobParameter 주의 사항</h3>\n<p>위에서의 설명을 요약하면 이렇습니다  </p>\n<ol>\n<li>JobParameter는 <code class=\"language-text\">@Value</code>를 통해서만 값을 할당 받을 수 있습니다  </li>\n<li><code class=\"language-text\">@JobScope</code>와 <code class=\"language-text\">@StepScope</code>로 <strong>Bean</strong>을 생성할때만 Jobparameter가 생성되어 사용 할 수 있습니다  </li>\n</ol>\n<p>만약 이를 어기게 되면 바로 다음과 같은 <span class='red_font'>Error</span>를 보실 수 있습니다<br>\n<br/> </p>\n<p><span class='code_header'><strong>Job Parameter Bean</strong></span>  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.79889807162533%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABcElEQVQ4y41Ty5KDMAzjcxonkHcC9AGl7WH//4O0DtBOuztTOGjMgciyZFddp2AtQUqCEAJE9A9SylfdQnWfFB6TwDRK5KzRaEbzRPPx89xgizC7Gl4TvG2Q2gwf4geUUqz8AEFFvZwn+aa2kvwgGYnEpME0iLlDTCuxCUguI9gEqy3kHoV1XWOKErdEGLuA6+MH0/2B83jFuR1xabnmgUnDqm6TcAlFcPcDh3IQtOCwgMQy4jOwrYAq3dQYWkIOjhV5/uaaLcbeYTh6OG+haonSeE/alVI1Gh4lGoVjd+K0bxgvVwyXETE6GK+hObCCEtAmYfGQSM3jamMRYloeSjWPKcQ6tti3kzOhMXL1afGP3vz6i02FxcOxJzhrEYPBMWluYNYlXrCX7OWh5kctL3iXWgz9CW3sEX2LxPtoi4e8n5LX5Z38K2H5KNcQYsaJA/GG0+WldlwXj/fd8UxYbvcjveIliTWQ1Uta75i2x/4Fcw6s0YOsizYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Jobparameter Bean\"\n        title=\"Jobparameter Bean\"\n        src=\"/static/4ac4c31944b5dcd6e3e066c454e2533d/36727/jobparameter.png\"\n        srcset=\"/static/4ac4c31944b5dcd6e3e066c454e2533d/acf4b/jobparameter.png 173w,\n/static/4ac4c31944b5dcd6e3e066c454e2533d/fc834/jobparameter.png 345w,\n/static/4ac4c31944b5dcd6e3e066c454e2533d/36727/jobparameter.png 690w,\n/static/4ac4c31944b5dcd6e3e066c454e2533d/8d582/jobparameter.png 726w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p><span class='code_header'><strong>Job Tasklet</strong></span>  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.24154025670945%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTklEQVQoz4WSa27DIBCEfZuEN9gBA3aSJmrvf6TpQJ6V6vbHaL2G/ZhBDNerQkoSQkhIKahWVZcQt14p9axbeqwPp6pRCfTew4cRzgd4LSiJME4wxvwL+wH0ViOOCqUm5OOKshZczhnHJcI5D6X1JvD9/xPoLGEHxs4Jc6moXRGHGO7xt/UOegENHXqDNU8o0SFOd1dKwtC95rrWqqvFb7LWbjvUbZN2CLw/6zQh7Fn7N6UMBxqQ1bY1Ywk3m44H7zVSFAS0k3h6c8KBNqTZj4GuGb/BmvNWUwqYmMR057rr4XSwRqLGEcfzBXGOyMkh14h5yZjrjNOl4PNrRa3sSyEs4vxRsSwJE+/fO0szrh+m6HKQpI7WYeXmWDLGw4FDiU+I0TjQI3NPcCPl+9vc7fbY7wXEb5FdoyvBePIWs0VgVCXVayMlpPjzPT7WvgGHCzM03Ja8AAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Jobparameter Component\"\n        title=\"Jobparameter Component\"\n        src=\"/static/ab5780ac1f05fcea17765014fb95dfaf/36727/jobparameter-component.png\"\n        srcset=\"/static/ab5780ac1f05fcea17765014fb95dfaf/acf4b/jobparameter-component.png 173w,\n/static/ab5780ac1f05fcea17765014fb95dfaf/fc834/jobparameter-component.png 345w,\n/static/ab5780ac1f05fcea17765014fb95dfaf/36727/jobparameter-component.png 690w,\n/static/ab5780ac1f05fcea17765014fb95dfaf/ab944/jobparameter-component.png 857w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p><span class='code_header'><strong>Result</strong></span>  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.885700148441368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAZ0lEQVQI12WMSw6AIAxEvY6h/CoIharc/1IjunDjYvImmc8i0tC1YOOIECOo7FhFQCmh1gpVnSxgZoQQXsXZ895/JCIYY14uqgfOqyEnRsoZ1BrWeULT994xxoBI/cbWWjjnfnz05DcWJD+mLWYnYwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Jobparameter Component Result\"\n        title=\"Jobparameter Component Result\"\n        src=\"/static/08aa4186ea55f6aeea4c222f8eaa5bcd/36727/jobparameter-component-complete.png\"\n        srcset=\"/static/08aa4186ea55f6aeea4c222f8eaa5bcd/acf4b/jobparameter-component-complete.png 173w,\n/static/08aa4186ea55f6aeea4c222f8eaa5bcd/fc834/jobparameter-component-complete.png 345w,\n/static/08aa4186ea55f6aeea4c222f8eaa5bcd/36727/jobparameter-component-complete.png 690w,\n/static/08aa4186ea55f6aeea4c222f8eaa5bcd/17fa4/jobparameter-component-complete.png 1035w,\n/static/08aa4186ea55f6aeea4c222f8eaa5bcd/a5044/jobparameter-component-complete.png 1380w,\n/static/08aa4186ea55f6aeea4c222f8eaa5bcd/61d97/jobparameter-component-complete.png 2021w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<br/>\n<p>만약 <code class=\"language-text\">@StepScope</code>가 없는 Bean에  Jobparameter를 지정하게 되면 <code class=\"language-text\">생성시점</code> 때문에  <span class='red_font'>error</span>가 납니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.19668246445498%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABeklEQVQoz5WTa3KkMAyEfZvdARvwEzDGMFt7/yv1tsxOKpNMUpUfHxLGasuSUGkOCN5AG4PB9DC0fd8/0XXdS/8VyjqPFAbkLSOvEcMwMOixoftW/KXgREE3GQQ3wgzMTjOIQlpr6F43gZ9l6D2it/CBwmKjx7zQdw4xOkyjaeLfiTxnaBnEzLynnSRLjXEcWE8Dw2y1XLtlefvM7TMqLgU2zLA+NRz9yQup2faNuLi8YIVPz6jAx7xV+HqHqyfstiPTr/e/2I47yvGnsXBPWgvm/GBvAh8PU5r3dqxjt674zU7/WmZEch4V53lg49oiayFg5AQI03jZgaUSa4x+Q8mYSGP0PKMXYuQBjjX1JFxj9FUTZBLeGqbbu7LWtuBJYBYT360LsGzWtfkKeo8Mv/BxXVD7vqMeBw6y1x2lFKzlRC6Xv20bcs6Ymf3Ksgjix3j9BOM4Nh6+KntBrazX/WTNzuZnBjUoJAJyqIiLUEqpXfEmY/J/6N/zD4R9eGpcNKscAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Jobparameter Error\"\n        title=\"Jobparameter Error\"\n        src=\"/static/a0dcd7f2ab7c9c1eb387f551af0c2d51/36727/jobparameter-component-fail.png\"\n        srcset=\"/static/a0dcd7f2ab7c9c1eb387f551af0c2d51/acf4b/jobparameter-component-fail.png 173w,\n/static/a0dcd7f2ab7c9c1eb387f551af0c2d51/fc834/jobparameter-component-fail.png 345w,\n/static/a0dcd7f2ab7c9c1eb387f551af0c2d51/36727/jobparameter-component-fail.png 690w,\n/static/a0dcd7f2ab7c9c1eb387f551af0c2d51/17fa4/jobparameter-component-fail.png 1035w,\n/static/a0dcd7f2ab7c9c1eb387f551af0c2d51/a5044/jobparameter-component-fail.png 1380w,\n/static/a0dcd7f2ab7c9c1eb387f551af0c2d51/1c80d/jobparameter-component-fail.png 1688w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>   </p>\n<br/>\n<h3 id=\"jobparameter를-사용하는-이유\"><a href=\"#jobparameter%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"jobparameter를 사용하는 이유 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JobParameter를 사용하는 이유</h3>\n<ol>\n<li>\n<p>Late Binding (Command Line실행외의 다른 실행이 어려워 진다)<br>\n<em>다음과 같이 동적 parameter의 대한 대응을 할 수 없습니다</em>  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JobController</span> <span class=\"token punctuation\">{</span>\t<span class=\"token comment\">//단순 예제</span>\n\n   <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">JobLauncher</span> jobLauncher<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Job</span> job<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token class-name\">JobController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JobLauncher</span> jobLauncher<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"JobParameterBean\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Job</span> job<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jobLauncher <span class=\"token operator\">=</span> jobLauncher<span class=\"token punctuation\">;</span>\n       <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>job <span class=\"token operator\">=</span> job<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n\n   <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/launchjob\"</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"requestDate\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> requestDate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n           <span class=\"token class-name\">JobParameters</span> jobParameters <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JobParametersBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                   <span class=\"token punctuation\">.</span><span class=\"token function\">addString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"requestDate\"</span><span class=\"token punctuation\">,</span> requestDate<span class=\"token punctuation\">)</span>\n                   <span class=\"token punctuation\">.</span><span class=\"token function\">addLong</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"time\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                   <span class=\"token punctuation\">.</span><span class=\"token function\">toJobParameters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n           jobLauncher<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> jobParameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n           log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error : {}\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token punctuation\">}</span>\n       <span class=\"token keyword\">return</span> <span class=\"token string\">\"Deon\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.30406599882144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZ0lEQVQ4y5WT7ZKDIAxFfZxFUD4FFavd93+ouxfabp2Odrs/ziSDk9OUhCamgOgltDZQSqFt20OklJV9fkRjfcBgFNIQYK1H13VEUi7rD7xKPhIG2yE4B23cTagEJIUll1L9U+g8ZRQOBsZQ0itGi17r51/eFXwgDFDsYpoXLJeFYodxylX6V/Gh0LBD3bPDMKB0a63jh+OhnA1sT+Mo0rrnfak6hNtQOuaku6PuZ4/zNzTaGAjxhVaIc9od4j3NMG+I8wqf8ikuzh+S0cSJyWWDWa/Q+YKUF2zXbyzrhrXGK0YObJxzjUOayIgQRwyFR15j4pSthUwRYhzxxei54MuSMc9TZeS5444+l1zwil6uYUczTVMVtnmGiJFrM2Db2N26onwLobwgex/Uc2hVfrQ2K4vblCjMtcsivCzcSVJFXKm+76ukxILm0r+++19hZmFbOmQ3gnh2GSn1wdfiswUuwgf7F/QD0USxVt+sDigAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Batch Parameter Controller\"\n        title=\"Batch Parameter Controller\"\n        src=\"/static/dd98eb2046678f22a12c2a7847bbd3a4/36727/batch-parameter-controller.png\"\n        srcset=\"/static/dd98eb2046678f22a12c2a7847bbd3a4/acf4b/batch-parameter-controller.png 173w,\n/static/dd98eb2046678f22a12c2a7847bbd3a4/fc834/batch-parameter-controller.png 345w,\n/static/dd98eb2046678f22a12c2a7847bbd3a4/36727/batch-parameter-controller.png 690w,\n/static/dd98eb2046678f22a12c2a7847bbd3a4/17fa4/batch-parameter-controller.png 1035w,\n/static/dd98eb2046678f22a12c2a7847bbd3a4/a5044/batch-parameter-controller.png 1380w,\n/static/dd98eb2046678f22a12c2a7847bbd3a4/209db/batch-parameter-controller.png 1697w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span><br>\n<strong><em>Spring Batch에서는 웹서버로 Batch를 관리하기를 <code class=\"language-text\">권장하지 않습니다</code></em></strong> ⚠  </p>\n</li>\n</ol>\n<br/>\n<ol start=\"2\">\n<li>Meta Table의 활용성 (Job과 Parameter의 <code class=\"language-text\">1:1</code> 관계)<br>\n<em>이 처럼 Meta Table을 활용하여 Job을 1번만 실행하는지의 여부 확인이 어려워 집니다</em><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.157800358637175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwklEQVQY01WQWRKEIAxEPY8brqXIInL/O2XoOO2MH12hArx0ulrXVUII4r0X51ypQUJM4kMUa61q33etuN+2TTXPsyzLItM0iTFGhmGQruukQjOlpFAoxqjCGQBC72H+gRJQ1/VLFRzmnOU8TwWndD0D8JkgDsM7WxybAoSztm0V1DSN6uWQH1AB4arHcYj/xsEIACPoBUQWBHBtZgoQVyYYdwCO46j59X3/AqvD68pPbqh0zMx+wOLS3T3AkSXA/y4/NbfFLJkHEPsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Parameter Exist Error\"\n        title=\"Parameter Exist Error\"\n        src=\"/static/20d442031bd61e22606261e5e83c4fe0/36727/parameter-exist.png\"\n        srcset=\"/static/20d442031bd61e22606261e5e83c4fe0/acf4b/parameter-exist.png 173w,\n/static/20d442031bd61e22606261e5e83c4fe0/fc834/parameter-exist.png 345w,\n/static/20d442031bd61e22606261e5e83c4fe0/36727/parameter-exist.png 690w,\n/static/20d442031bd61e22606261e5e83c4fe0/17fa4/parameter-exist.png 1035w,\n/static/20d442031bd61e22606261e5e83c4fe0/a5044/parameter-exist.png 1380w,\n/static/20d442031bd61e22606261e5e83c4fe0/856a4/parameter-exist.png 1673w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </li>\n</ol>\n<br/>\n<h3 id=\"bean과-stepscope를-같이-사용할-때-주의사항\"><a href=\"#bean%EA%B3%BC-stepscope%EB%A5%BC-%EA%B0%99%EC%9D%B4-%EC%82%AC%EC%9A%A9%ED%95%A0-%EB%95%8C-%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD\" aria-label=\"bean과 stepscope를 같이 사용할 때 주의사항 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Bean과 @StepScope를 같이 사용할 때 주의사항</h3>\n<p>기억보단 기록을 블로그의 <a href=\"https://jojoldu.tistory.com/132\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">StepScope 사용시 주의사항</a>을 정리해서 요약했습니다<br>\nSpring Batch에서 ItemReader를 구현시 <code class=\"language-text\">@Bean</code>을 사용해서 구현하곤 합니다<br>\n문제는 <code class=\"language-text\">@Bean</code>과 JobParameter를 같이 써야 하면서 <code class=\"language-text\">@StepScope</code>를 같이 추가하면서 일어납니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token annotation punctuation\">@StepScope</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">reader</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#{jobParameters[parameter]}\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> parameter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token class-name\">JpaPagingItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">></span></span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JpaPagingItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    \n    <span class=\"token keyword\">return</span> reader<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>해당 코드와 같이 사용하고 일반적으로 <code class=\"language-text\">JpaPagingItemReader</code>를 사용하게 되면 <code class=\"language-text\">ItemStream</code> 인터페이스를 가지고 있지 않아서 <span class='red_font'>Error</span>가 납니다<br>\n이유인 즉 <code class=\"language-text\">@StepScope</code>가 선언됨에 따라 Bean이 <code class=\"language-text\">Proxy</code>로 설정 되면서 실제 생성한것과 다르게 <em>ItemReader로 return 되기 때문입니다</em>  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"step\"</span><span class=\"token punctuation\">,</span> proxyMode <span class=\"token operator\">=</span> <span class=\"token class-name\">ScopedProxyMode</span><span class=\"token punctuation\">.</span>TARGET_CLASS<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span>RUNTIME<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Documented</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">StepScope</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Scope의 관해서 자세히 알고 싶으시면 제 블로그의 다른 글 👉 <a href=\"https://renuevo.github.io/spring/scope/spring-scope/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Scope의 관해서</a>을 확인 하시기 바랍니다  </p>\n<hr>\n<h2 id=\"chunk-지향-처리\"><a href=\"#chunk-%EC%A7%80%ED%96%A5-%EC%B2%98%EB%A6%AC\" aria-label=\"chunk 지향 처리 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chunk 지향 처리</h2>\n<p>Spring Batch의 가장 큰 장점 중 하나는 <code class=\"language-text\">Chunk</code> 지향 처리입니다<br>\n<code class=\"language-text\">Chunk</code>지향처리란 <strong>한 번에 하나씩의 데이터를 읽어 Chunk라는 덩어리를 만든 뒤, Chunk 단위로 트랜잭션</strong>을 다루는 것을 의미합니다<br>\n그래서 트랜잭션을 수행시 <code class=\"language-text\">Chunk</code>단위로 수행하기 때문에 Chunk 만큼만 롤백 됩니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 594px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.05050505050505%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABiElEQVQoz4WPS0vDQBSF819diaCgf8CtSzdu3Va6Eouim1ZBUbAuqgg+0L6StEkzM3k38/Q0o1JB9DCQO3fuueeLY4zJ53y3eba9f/T4/h497fQ6G48X6+HLXkm7/evVh/baw/n66+VKNjkWxXjU3ex1tt5uNtjowEmTZDh2T67ujq/vA0rL4NR/bkxeG1nQrooxc1vhoBX0W2x8yLMXyQkbNb3ng6jfKOitUxQFpYSXhVaCRCScxVIZIbX5ktKLsyxcbcOx9/l8TihzPXc6ncSMJjETvCLRDCfLUqWE0cpoXR/FeaWUNEYvzFrrhZkQUFRVlSRJVqtfKwgC+JeThRCw/EwmBLG+56VpWpYlXnnFsQsb0fnHjAmERFGU5zlqKQVjMQSzUup3s/3YZADDCQM4UQyHo+FgQAjFL/yVDDxkghYFRuHknCdJTClDjSdM44nUApdlcRACWqQxxr7NQAULaqzIa9m+7/ue606mU/QX5iLPPdcLw1mWf7Jhq6Wy0rWWsaWUtvMBDk9r2yqMa+gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chunk-oriented processing\"\n        title=\"chunk-oriented processing\"\n        src=\"/static/ededcb54565ead1e65848381425a907a/262c7/chunk-oriented-processing.png\"\n        srcset=\"/static/ededcb54565ead1e65848381425a907a/acf4b/chunk-oriented-processing.png 173w,\n/static/ededcb54565ead1e65848381425a907a/fc834/chunk-oriented-processing.png 345w,\n/static/ededcb54565ead1e65848381425a907a/262c7/chunk-oriented-processing.png 594w\"\n        sizes=\"(max-width: 594px) 100vw, 594px\"\n        loading=\"lazy\"\n      />\n    </span><br>\n<span class='img_caption'> Source : <a href=\"https://docs.spring.io/spring-batch/docs/4.0.x/reference/html/index-single.html#chunkOrientedProcessing\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch Docs Chunk-oriented</a></span></p>\n<p>위의 그림은 Spring Batch에서 Item단위로 처리 프로세스가 어떻게 이루어지는지 나타냅니다<br>\n<strong>ItemReader와 ItemProcessor를 처리한뒤 마지막에 ItemWriter으로 전달 합니다</strong> </p>\n<br/> \n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.63208453410183%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZUlEQVQ4y22T2arCQBBE8/8/J8YY3BDBGNQH930rPQMV+nptGJKp6a6prnQyhTgejyqKQq1WS7PZLGHj8VidTkd5nquu64TN53O127nKstT5fI4UypbLpVj7/V6Xy0WLxUJVVWm73ep+v2u1Wqn+kIODPR4P7Xa7dCF1EILdbjc9n09lvV5PxUfBdDpNhBycTie9Xq9ESLDnncLr9ZqedAMBQS4YORkvk8lEENMKIAoo5HYUHg6HVEChScDIcYAnQhRRyCEAB7RGAa13u910gQNSq/5J6JvjwXq9btrkjD128O5cWv5JaFVOtE9RDWRcgPLRaKTBYKDhcNh4/E+hfTGhRyGqwUuetA8xXxi7nPdH4XfLKIrh0fhu2YQmTYQQcMCGBZm/KjhPZtTj4vFBaRwvc2RWZR8BnWgsfqCIsTabjfr9fvK2IYzxq2X20WfbwIpCmjmMi2L8iW2gxH+RMXtoItvzBlax9G9BhrDgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spring batch chunk\"\n        title=\"spring batch chunk\"\n        src=\"/static/aac8f74d08de518fa48c9a923ba56fc5/36727/spring-batch-chunk.png\"\n        srcset=\"/static/aac8f74d08de518fa48c9a923ba56fc5/acf4b/spring-batch-chunk.png 173w,\n/static/aac8f74d08de518fa48c9a923ba56fc5/fc834/spring-batch-chunk.png 345w,\n/static/aac8f74d08de518fa48c9a923ba56fc5/36727/spring-batch-chunk.png 690w,\n/static/aac8f74d08de518fa48c9a923ba56fc5/17fa4/spring-batch-chunk.png 1035w,\n/static/aac8f74d08de518fa48c9a923ba56fc5/a5044/spring-batch-chunk.png 1380w,\n/static/aac8f74d08de518fa48c9a923ba56fc5/48160/spring-batch-chunk.png 2082w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span><br>\n<span class='img_caption'> Source : <a href=\"https://jojoldu.tistory.com/331\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">기억보단 기록을 Chunk 지향처리</a></span><br>\n위의 그림은 이해를 돕기 위한 그림입니다<br>\n<strong>Reader와 Processor가 Item을 1건씩 처리하고 Chunk단위 만큼 처리가 끝나면 Writer쪽으로 전달되어 일괄 처리 됩니다</strong>  </p>\n<br/>\n<h3 id=\"page-size-와-chunk-size\"><a href=\"#page-size-%EC%99%80-chunk-size\" aria-label=\"page size 와 chunk size permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Page Size 와 Chunk Size</h3>\n<p>Spring Batch에서 일반적으로 Reader로 <code class=\"language-text\">PagingItemReader</code>를 많이들 사용합니다<br>\n일반적으로 Page Size와 Chunk Size를 같은 의미로 생각할 수 있습니다<br>\n<strong>하지만 Page Size와 Chunk Size는 서로 의미하는 바가 다릅니다</strong>  </p>\n<br/>\n<p><strong>1. Chunk Size는 한번에 처리될 트랜잭션 단위</strong><br>\n<strong>2. Page Size는 한번에 조회할 Item의 양</strong>  </p>\n<br/>\n<p>아래 코드로 ItemReader에서 Read가 이루어지는 경우를 한눈에 볼 수 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">protected</span> <span class=\"token class-name\">T</span> <span class=\"token function\">doRead</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">//results가 없거나, index가 pageSize를 초과한 경우 </span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>results <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> current <span class=\"token operator\">>=</span> pageSize<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    </span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">isDebugEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Reading page \"</span> <span class=\"token operator\">+</span> <span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        \n            <span class=\"token comment\">//신규 Item을 읽어서 results list에 추가한다</span>\n<span class=\"gatsby-highlight-code-line\">            <span class=\"token function\">doReadPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </span>            page<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>current <span class=\"token operator\">>=</span> pageSize<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                current <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">int</span> next <span class=\"token operator\">=</span> current<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>next <span class=\"token operator\">&lt;</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token keyword\">return</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 Read는 <code class=\"language-text\">Page Size</code> 단위로 이루어지며 <strong>쿼리 실행시 Page의 Size를 지정하기 위한 용도</strong>입니다<br>\n<strong>Chunk는 Item이 처리되는 단위</strong>이며 이 때문에 <strong>Chunk Size와 Page Size가 다를 경우 불필요한 Read가 발생할 수 있습니다</strong></p>\n<br/>\n<p><code class=\"language-text\">즉 Chunk Size가 Page Size보다 클경우 Chunk Size를 만족할 만큼의 Page Read가 이루어 집니다</code></p>\n<br/>\n<p>그래서 JpaPagingItemReader에서는 다음과 같이 주석으로 알려주고 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/*\n * &lt;p>\n<span class=\"gatsby-highlight-code-line\"> <span class=\"token operator\">*</span> <span class=\"token class-name\">Setting</span> a fairly large page size and using a commit interval that matches the</span><span class=\"gatsby-highlight-code-line\"> <span class=\"token operator\">*</span> page size should provide better performance<span class=\"token punctuation\">.</span></span> <span class=\"token operator\">*</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n <span class=\"token operator\">*</span><span class=\"token operator\">/</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JpaPagingItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractPagingItemReader</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">상당히 큰 페이지 크기를 설정하고 페이지 크기와 일치하는 커미트 간격을 사용하면 성능이 향상됩니다</code></pre></div>\n<p><strong>즉 Chunk Size와 Page Size를 일치 시키는게 보편적으로 좋은 방법입니다</strong></p>\n<ul>\n<li>JPA에서의 영속성 컨텍스트가 깨지는 문제도 있을 수 있다고 합니다<br>\n관련 정리 👉 <a href=\"https://jojoldu.tistory.com/146\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">영속성 컨텍스트 문제</a></li>\n</ul>\n<br/>\n<hr>\n<h2 id=\"관련-참고\"><a href=\"#%EA%B4%80%EB%A0%A8-%EC%B0%B8%EA%B3%A0\" aria-label=\"관련 참고 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관련 참고</h2>\n<p><a href=\"https://docs.spring.io/spring-batch/docs/current/reference/html/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch Doc</a><br>\n<a href=\"https://terasoluna-batch.github.io/guideline/5.0.0.RELEASE/en/Ch02_SpringBatchArchitecture.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Batch Guideline</a><br>\n<a href=\"https://jojoldu.tistory.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">기억보단 기록을</a>   </p>","frontmatter":{"title":"[Spring] 1. Spring Batch의 기본 개념","date":"January 30, 2020"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/spring/batch/spring-batch-chapter-1/","previous":{"fields":{"slug":"/elastic/elastic-jvm-matrix/"},"frontmatter":{"title":"[Elastic] Could not create the Java Virtual Machine Error","category":"Elastic"}},"next":{"fields":{"slug":"/spring/batch/spring-batch-chapter-2/"},"frontmatter":{"title":"[Spring] 2. Spring Batch의 ItemReader - File Item Reader","category":"Spring"}}}}}