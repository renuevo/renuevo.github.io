{"componentChunkName":"component---src-templates-blog-post-js","path":"/spring/scope/spring-scope/","webpackCompilationHash":"9cfe2f0a052f67c2ba66","result":{"data":{"site":{"siteMetadata":{"title":"renuevo blog","author":"deokhwa kim","siteUrl":"https://renuevo.github.io","comment":{"disqusShortName":"https-renuevo-github-io","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"566358b2-f0af-5380-b524-e83ff02b6676","excerpt":"Spring Scope Spring Bean을 생성시 적용되는 Scope에 대해 알아보려 합니다\n아래 모든 소스의 제 Github에서 확인 하실 수 있습니다   해당 포스팅은 내부적 구현 요소의 대해 설명에 집중하며 Scope의 일반적인 사용법을 보시려면 \n👉 baeldung - spring-bean-scopes   Spring Bean의 Scope는 크게 2가지가 존재합니다 Spring의 내부 를 보면 과…","html":"<h1 id=\"spring-scope\"><a href=\"#spring-scope\" aria-label=\"spring scope permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Scope</h1>\n<p><em>Spring Bean을 생성시 적용되는 Scope에 대해 알아보려 합니다</em>\n아래 모든 소스의 제 <a href=\"https://github.com/renuevo/spring-boot-in-action/tree/master/spring-boot-scope-in-action\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github</a>에서 확인 하실 수 있습니다  </p>\n<p>해당 포스팅은 내부적 구현 요소의 대해 설명에 집중하며 Scope의 일반적인 사용법을 보시려면\n👉 <a href=\"https://www.baeldung.com/spring-bean-scopes\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">baeldung - spring-bean-scopes</a>  </p>\n<p>Spring Bean의 Scope는 크게 2가지가 존재합니다<br>\nSpring의 내부 <code class=\"language-text\">ConfigurableBeanFactory</code>를 보면 <code class=\"language-text\">singleton</code>과 <code class=\"language-text\">prototype</code> 2가지 속성을 나타내고 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ConfigurableBeanFactory</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HierarchicalBeanFactory</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SingletonBeanRegistry</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token comment\">/**\n\t * Scope identifier for the standard singleton scope: \"singleton\".\n\t * Custom scopes can be added via {@code registerScope}.\n\t * @see #registerScope\n\t */</span>\n\t<span class=\"token class-name\">String</span> SCOPE_SINGLETON <span class=\"token operator\">=</span> <span class=\"token string\">\"singleton\"</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">/**\n\t * Scope identifier for the standard prototype scope: \"prototype\".\n\t * Custom scopes can be added via {@code registerScope}.\n\t * @see #registerScope\n\t */</span>\n\t<span class=\"token class-name\">String</span> SCOPE_PROTOTYPE <span class=\"token operator\">=</span> <span class=\"token string\">\"prototype\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>일반적으로 생성되는 빈들은 모두 <code class=\"language-text\">Singleton</code>으로 생성되게 됩니다<br>\n즉 아래 두개의 Bean들은 서로 동일하게 Singleton으로 생성되게 됩니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Single</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"singleton\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Single</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Singleton</code>으로 생성하게 되면 어디서나 1개의 인스턴스를 참조하여 사용하게 됩니다<br>\n<br/></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Single</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>예를 들어 다음 같이 Singleton Bean을 하나 만들고  </p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeWrapper</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Getter</span>\n    <span class=\"token class-name\">Single</span> single<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>WrapperClass를 하나 만들어서 해당 Bean을 Autowired DI 해줍니다</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ScopeWrapper</span> scopeWrapper<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Single</span> single<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">scopeTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[============== Singleton Bean ==============]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Scope Service Single : \"</span> <span class=\"token operator\">+</span> single<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Scope Wrapper Single : \"</span> <span class=\"token operator\">+</span> scopeWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">getSingle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그 후 ScopeService 만들어서 각각의 Bean을 DI하고 각각의 Single 인스턴스를 출력하면 다음과 같습니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.699410609037326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABbqAAAW6gHljkMQAAAAmUlEQVQI1z2OQQ6DIBREPQ58tIBRQIGaNE3TTVdd9P4nGQcSu3iBGYY/fxDn0PEeYi2MMbA8Hb2LZVkwzzM8M5fXMiIaWilorXmX/neQfUfnXiExYpwm7NSlFOScUWv96+M4uteh/oSIL99+zDztDYpDB2F7JwQItzDjiHVdsW0bUkoI9Nt2zWs6srQRyIPei7l3YQE31hx4Aud9YFzsntkaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"singleton-bean\"\n        title=\"singleton-bean\"\n        src=\"/static/821cd584b57621f69915b0f0e69cae81/36727/singleton-bean.png\"\n        srcset=\"/static/821cd584b57621f69915b0f0e69cae81/acf4b/singleton-bean.png 173w,\n/static/821cd584b57621f69915b0f0e69cae81/fc834/singleton-bean.png 345w,\n/static/821cd584b57621f69915b0f0e69cae81/36727/singleton-bean.png 690w,\n/static/821cd584b57621f69915b0f0e69cae81/59fbd/singleton-bean.png 1018w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>\n<code class=\"language-text\">Singleton</code>으로 당연하게 같은 Instance를 확인 할 수 있습니다  </p>\n<h2 id=\"br\"><a href=\"#br\" aria-label=\"br permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><br/></h2>\n<p><code class=\"language-text\">Prototype</code>은 매번 새로운 Instance를 생성하여 Bean의 생명주기가 필요할 때 사용되게 됩니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prototype\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Proto</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Prototype Bean을 하나 생성하고</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeWrapper</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Getter</span>\n    <span class=\"token class-name\">Proto</span> proto<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아까와 같이 WrapperClass에 Propotype Bean을 DI해줍니다  </p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ScopeWrapper</span> scopeWrapper<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Proto</span> proto<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">scopeTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[============== Prototype Bean ==============]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Scope Service Proto : \"</span> <span class=\"token operator\">+</span> proto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Scope Wrapper Proto : \"</span> <span class=\"token operator\">+</span> scopeWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">getProto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ScopeService 아까와 같이 구성해서 출력하면 다음과 같습니다<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.560165975103734%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABbqAAAW6gHljkMQAAAAkklEQVQI1zVOQRKDIBDzOwWcEVwEBB3toV9op///R5pFe8gkJLthByOCjpQuHh38NEGo53nuWJYFiXnO+falszBzzl0YR1hrMRgOmVJgtg2qHwy0YN93bPRqrSjMU044jqN7ipX+2RreMeJD/W0VL+4OJgR06HXK/M1730v/FwW+p9uLLFCWKMjUT155ckZRWPgDiZRhDksNTjAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prototype-bean\"\n        title=\"prototype-bean\"\n        src=\"/static/bfbb6a315a27a000b66514d1170bd3fc/36727/prototype-bean.png\"\n        srcset=\"/static/bfbb6a315a27a000b66514d1170bd3fc/acf4b/prototype-bean.png 173w,\n/static/bfbb6a315a27a000b66514d1170bd3fc/fc834/prototype-bean.png 345w,\n/static/bfbb6a315a27a000b66514d1170bd3fc/36727/prototype-bean.png 690w,\n/static/bfbb6a315a27a000b66514d1170bd3fc/d4d70/prototype-bean.png 964w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>\n<code class=\"language-text\">Prototype</code>으로 서로 다른 Instance를 확인 할 수 있습니다   </p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationContext</span> ctx<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">scopeTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[============== Prototype getBean ==============]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getBean Case 1 : \"</span> <span class=\"token operator\">+</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"proto\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getBean Case 2 : \"</span> <span class=\"token operator\">+</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"proto\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.418125643666324%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABbqAAAW6gHljkMQAAAAoUlEQVQI10WOwQ7CIBBE+ztdrIUChWKhlWg8e9H//5JxiiYeNkOG3ZfXibWQeYY4BxkGjOMIy26aJhhj4NjHGDFzJ6XEv29/7DjOmTdKBEopCLOTZYHkDElMwpx1qLUisztAzjvs+xXbtrUpJSOtK568e10ueJfCd8TQ9xBCu7+hbYZGm2YSwtwstNYIBIcQaOlbeu5Xmt+ZD4Jv3uP0A34Aia9hDktqpgcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prototype-bean\"\n        title=\"prototype-bean\"\n        src=\"/static/c3da605c201130bf54fb1011f84cf71a/36727/prototype-getbean.png\"\n        srcset=\"/static/c3da605c201130bf54fb1011f84cf71a/acf4b/prototype-getbean.png 173w,\n/static/c3da605c201130bf54fb1011f84cf71a/fc834/prototype-getbean.png 345w,\n/static/c3da605c201130bf54fb1011f84cf71a/36727/prototype-getbean.png 690w,\n/static/c3da605c201130bf54fb1011f84cf71a/4c710/prototype-getbean.png 971w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>\n<code class=\"language-text\">ApplicationContext</code>를 통해 getBean으로 Proto를 가져와도 다른 Instance를 가져오는 것을 확인 할 수 있습니다  </p>\n<br/>\n<hr>\n<p>위에 예제들을 통해 <code class=\"language-text\">Singleton</code>과 <code class=\"language-text\">Prototype</code>의 특성을 살펴 보았습니다<br>\n이 스코프 특성들은 각각 사용하거나 Prototype에서 Singleton을 가지고 사용하는 것에는 문제가 없습니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.95238095238095%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABcRAAAXEQHKJvM/AAACmklEQVQ4y2OIbzvzL6blzL8oEG4+8yey5eJ/oNiF////MzMAQfG0SwwkgYCq43/jW0/9TW0/+Tej6+Tv5K6L/4NqT52HGZjSeYo0A/O6j/8/15P9/+rMqv83ZpT9Pzah+n9E1c7ri2/9ZwXJt238T5qBHfPPeb7cPMnzw8FFnp8OLvS4s2mOd27bVjsuPiFeoDSHuoE9XC0jlAa6nuHjgkyGD9OjGT7MjIVgIPvjggwGhsvP/3MJzPjPzdvxn0uw5z+X0bL/3EANHCBNQMAOxGCDYYZycnLhd2FU0+mPEU2nf0Q2n/ke3njma3Ddqf+RTadO/f//iQUkbxtQzAg1EGQwGwPClYxAzISOGQJrjv9Oajv5P639+P/MjqP/M3sv/gcaegksiQoYudhYeIA0n4t3ANe7CQFL3nU4nwfiY++6XE+863A68X6C/wmG7PbDf672JP+/Oz3v//3pOf8vTCz8H1G57aq+ewIfyIdsHNzcQBqEuUR52UFBwCOroKT0rMHm5f/Z/v//z4v6/39B9P//07z//5/g/J+he/Flq+d7Ftt8OLfT+uP53db39qy2rZp00FDdzB3kZWY2dk5mmAu52Vk5QZZMXLKB5cOkoEnvOl13vu/z2fS+12szkL35/cTAzQyztz6S9Z/wViaw57FMYPcjmdjpr2WX7nsthuZddvQwxAnCGk79iQTlECCOaDrzK7Tx/P+IxtMnQIEOlGZlYeNEiWUQ4OYXYrgCpM8B8UUoPgfFDMG1J/8ntpz4n9x67H9m57F/KZ3n/gdUHjrvZGMACkMONWMvRnRHgJLUp1WVDJ8W5zJ8WpIPwYtyGT4DxRjy2/b8u9cZ8u/p9LR/L6fG/7ncm/4/pGzrmaZdr8DJ5v5/0nIKAOtEUcQlod0aAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prototype-in-singleton\"\n        title=\"prototype-in-singleton\"\n        src=\"/static/0960ab756dfd4f678c1f30edd0f890e2/36727/prototype-in-singleton.png\"\n        srcset=\"/static/0960ab756dfd4f678c1f30edd0f890e2/acf4b/prototype-in-singleton.png 173w,\n/static/0960ab756dfd4f678c1f30edd0f890e2/fc834/prototype-in-singleton.png 345w,\n/static/0960ab756dfd4f678c1f30edd0f890e2/36727/prototype-in-singleton.png 690w,\n/static/0960ab756dfd4f678c1f30edd0f890e2/04a72/prototype-in-singleton.png 840w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<br/>\n<br/>\n<p><strong>반대로 Singleton에서 Prototype을 가지고 있는 경우에는 의도한 것과 다른 결과를 낼 수 있습니다</strong><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.88481675392669%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABcRAAAXEQHKJvM/AAACHklEQVQoz31R4UsTcRj+5eZM0FhEFDSoT31Z9Q80IQZSW9IHqX0pQgbGRHTIwKh9kCKy9G6hJoPOOZda7uZut9utu1u01giUxThKsCQCZWsYzpajnN5sb3dGGX3wgYfn5ffjeXheXsQwDISoIITpEFDBYEWey4LAAy8I7UgGy7JqRQsJL/qAfuOb+7KqgJ9XF1xNO8RM6rURqwqRJFkOMFw5IsTLbCxeDvPxUohhgY0wbYpZFEUV+oOaLkTXod3xIsZBZtIJy2QPLFO98GWiG8SID8bIcLfy73A4NP97ikSLZRVvup3vN93I3z/rzPedu7mKmXvWPK1X0HOOxYuj1/CNJ534D/I6/tNn7Z+ddA3jj8aNsrdKp9Ptk7Wutqa6/rjcUQlcuWtMAmECIJoBRi0AIxcBHhrh68CFFEq9SRumUouG8dcfDRPJecPjmcXTL9Pvz2Q/LRz+p9SeIwe1ai1CWqRpOJC71cDnsEswN2jfnB/q3Hr3oF1autcMxTuNCRSm6e2jRKOszCjQoRDwPK/MHUqSzWZTWtXu1VTXH5JVeSsNmCk35oNW7O26c2hm0+YSN9y93kqlwzyHAoEABP1PIUpPwzOZDEVuRcI0+P2kXTHr9fr9smjsLZa/db9z2NEs5zm1EKP02QR1IvOK1n/mPCdLSeIYYqhpaWnYKuWINinj7ZJW3FfXk2N9MOid2g4EgKqdzVUo3bj7kX8BlNMZvN77C4AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"singleton-in-prototype\"\n        title=\"singleton-in-prototype\"\n        src=\"/static/266c2b65e173fd9cad227a9bd6e94aa8/36727/singleton-in-prototype.png\"\n        srcset=\"/static/266c2b65e173fd9cad227a9bd6e94aa8/acf4b/singleton-in-prototype.png 173w,\n/static/266c2b65e173fd9cad227a9bd6e94aa8/fc834/singleton-in-prototype.png 345w,\n/static/266c2b65e173fd9cad227a9bd6e94aa8/36727/singleton-in-prototype.png 690w,\n/static/266c2b65e173fd9cad227a9bd6e94aa8/578a5/singleton-in-prototype.png 764w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>이미 Singleton으로 생성되는 시점에 Prototype이 생성되어 들어 오기 때문에<br>\n<strong>Singleton 내부의 Prototype을 호출해게 되면 매번 같은 값을 가져오게 됩니다</strong>  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationContext</span> ctx<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">scopeTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[============== Singleton getBean And getPrototype ==============]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ScopeWrapper getBean Proto Case 1 : \"</span> <span class=\"token operator\">+</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ScopeWrapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ScopeWrapper getBean Proto Case 2 : \"</span> <span class=\"token operator\">+</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ScopeWrapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.550135501355015%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABbqAAAW6gHljkMQAAAAm0lEQVQI1zVOWw6DMAzjOKwVhZa+WxBI077Y7n8bz+3YR+TYcSwPYp4htEZDKSWUUpi5/0drg2VZYO2K1RhyDXNj9/DW7mqa8BhHDKJkiH2HSBGSYkwJ53mi1oKd+m+vOI4DIXiUUrrW+LZV5JzxihEfei5mDcJZiBAg2KA1dM71oMzgzOdIs/eeYeFuantI0xM9gfjkz0V8k38BWqBhn4+MKd0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"singleton-getbean-and-getPrototype\"\n        title=\"singleton-getbean-and-getPrototype\"\n        src=\"/static/d0f2c302e63760cdce23db5d929623b8/36727/singleton-getbean-and-getPrototype.png\"\n        srcset=\"/static/d0f2c302e63760cdce23db5d929623b8/acf4b/singleton-getbean-and-getPrototype.png 173w,\n/static/d0f2c302e63760cdce23db5d929623b8/fc834/singleton-getbean-and-getPrototype.png 345w,\n/static/d0f2c302e63760cdce23db5d929623b8/36727/singleton-getbean-and-getPrototype.png 690w,\n/static/d0f2c302e63760cdce23db5d929623b8/17fa4/singleton-getbean-and-getPrototype.png 1035w,\n/static/d0f2c302e63760cdce23db5d929623b8/38e05/singleton-getbean-and-getPrototype.png 1107w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span><br>\n다음과 같이 같은 Instance가 return 된걸 확인 할 수 있습니다<br>\n<strong>그럼 원래 처럼 매번 다른 Instance를 받아 오려면 어떻게 해야 할까요?</strong>  </p>\n<br/>\n<p>이러한 문제를 해결하기 위해 Spring에서는 <code class=\"language-text\">ProxyMode</code>를 제시하고 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"prototype\"</span><span class=\"token punctuation\">,</span> proxyMode <span class=\"token operator\">=</span> <span class=\"token class-name\">ScopedProxyMode</span><span class=\"token punctuation\">.</span>TARGET_CLASS<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProtoProxy</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeWrapper</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token annotation punctuation\">@Getter</span>\n    <span class=\"token class-name\">ProtoProxy</span> protoProxy<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 Prototype에 <code class=\"language-text\">ProxyMode</code>를 추가 하고 Wrapper에 DI 후 출력해 봅니다   </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationContext</span> ctx<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">scopeTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[============== Singleton getBean And getProxyPrototype ==============]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ScopeWrapper getBean Proxy Proto Case 1 : \"</span> <span class=\"token operator\">+</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ScopeWrapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProtoProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ScopeWrapper getBean Proxy Proto Case 2 : \"</span> <span class=\"token operator\">+</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ScopeWrapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProtoProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.244897959183675%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABbqAAAW6gHljkMQAAAAc0lEQVQI1x1LOQ6DMBDkPRtw8LURyGfhig4pRf7/kMmYYjT3Is5BQoB4j9e2wVoLT+2YxxgRNUJVyfr4qZXZ7CcC9zt/73WFIRY5T0jOkJQgxiCRxxiotaL3jlIK8oMM/Sgas9Yayuz5u48DX35+3FzB4w8srUHZPMgO7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prototype-proxy-bean\"\n        title=\"prototype-proxy-bean\"\n        src=\"/static/6bad3e48c746c95e745dd2c885e88857/36727/prototype-proxy-bean.png\"\n        srcset=\"/static/6bad3e48c746c95e745dd2c885e88857/acf4b/prototype-proxy-bean.png 173w,\n/static/6bad3e48c746c95e745dd2c885e88857/fc834/prototype-proxy-bean.png 345w,\n/static/6bad3e48c746c95e745dd2c885e88857/36727/prototype-proxy-bean.png 690w,\n/static/6bad3e48c746c95e745dd2c885e88857/17fa4/prototype-proxy-bean.png 1035w,\n/static/6bad3e48c746c95e745dd2c885e88857/a300b/prototype-proxy-bean.png 1176w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span><br>\n<strong><code class=\"language-text\">ProxyMode</code>로 우회해서 다음과 같이 원하는 값을 얻어 낼 수 있었습니다</strong>  </p>\n<br/>\n<p>참고로 <code class=\"language-text\">request</code> or <code class=\"language-text\">session</code>과 같은 scope도 이런 <code class=\"language-text\">ProxyMode</code>를 구현되어 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span>TYPE<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span>METHOD<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span>RUNTIME<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Documented</span>\n<span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebApplicationContext</span><span class=\"token punctuation\">.</span>SCOPE_SESSION<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">SessionScope</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token comment\">/**\n\t * Alias for {@link Scope#proxyMode}.\n\t * &lt;p>Defaults to {@link ScopedProxyMode#TARGET_CLASS}.\n\t */</span>\n\t<span class=\"token annotation punctuation\">@AliasFor</span><span class=\"token punctuation\">(</span>annotation <span class=\"token operator\">=</span> <span class=\"token class-name\">Scope</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token class-name\">ScopedProxyMode</span> <span class=\"token function\">proxyMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token class-name\">ScopedProxyMode</span><span class=\"token punctuation\">.</span>TARGET_CLASS<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span>TYPE<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span>METHOD<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span>RUNTIME<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Documented</span>\n<span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebApplicationContext</span><span class=\"token punctuation\">.</span>SCOPE_REQUEST<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">RequestScope</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token comment\">/**\n\t * Alias for {@link Scope#proxyMode}.\n\t * &lt;p>Defaults to {@link ScopedProxyMode#TARGET_CLASS}.\n\t */</span>\n\t<span class=\"token annotation punctuation\">@AliasFor</span><span class=\"token punctuation\">(</span>annotation <span class=\"token operator\">=</span> <span class=\"token class-name\">Scope</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token class-name\">ScopedProxyMode</span> <span class=\"token function\">proxyMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token class-name\">ScopedProxyMode</span><span class=\"token punctuation\">.</span>TARGET_CLASS<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<p>다음은 마지막으로 <code class=\"language-text\">Interface</code>와 <code class=\"language-text\">ProxyMode</code>를 통한 <code class=\"language-text\">Bean 생성시</code> 유의해야할 사항에 대해 알아 보겠습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ProtoInterface</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProtoInterfaceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ProtoInterface</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Getter</span>\n    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ProtoInterfaceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ProtoInterfaceImpl</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Interface</code>를 생성하고 구현체인 <code class=\"language-text\">ProfoInterfaceImpl</code>을 생성하였습니다<br>\n<br/></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProtoInterFaceBean</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ProtoInterfaceProxy\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"prototype\"</span><span class=\"token punctuation\">,</span> proxyMode <span class=\"token operator\">=</span> <span class=\"token class-name\">ScopedProxyMode</span><span class=\"token punctuation\">.</span>TARGET_CLASS<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ProtoInterface</span> <span class=\"token function\">getProtoInterfaceProxyBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ProtoInterfaceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ProtoInterface\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"prototype\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ProtoInterface</span> <span class=\"token function\">getProtoInterfaceBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ProtoInterfaceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 다음과 같이 각각 일반 Prototype Bean 한개와 ProxyMode의 Bean을 생성합니다<br>\n<strong>Bean에서는 return은 Interface로 하지만 실제적으론 구현체인 ProtoInterfaceImpl을 생성하여 return 하였습니다</strong>  </p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScopeService</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ProtoInterface\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span>  <span class=\"token class-name\">ProtoInterface</span> protoInterface<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ProtoInterfaceProxy\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span>  <span class=\"token class-name\">ProtoInterface</span> protoInterfaceProxy<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">scopeTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[============== ProtoInterfaceImpl Prototype Bean Return ProtoInterface ==============]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bean Is ProtoInterface Instranceof : \"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>protoInterface <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ProtoInterface</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bean Is ProtoInterfaceImpl Instranceof : \"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>protoInterface <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ProtoInterfaceImpl</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[============== ProtoInterfaceImpl Prototype Proxy Bean Return ProtoInterface ==============]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Proxy Bean Is ProtoInterface Instranceof : \"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>protoInterfaceProxy <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ProtoInterface</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Proxy Bean Is ProtoInterfaceImpl Instranceof : \"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>protoInterfaceProxy <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ProtoInterfaceImpl</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그 다음 다음과 같이 각각의 Bean을 DI 받아서 <code class=\"language-text\">instanceof</code>로 확인하면 어떻게 될까요?  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.133891213389122%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABbqAAAW6gHljkMQAAAAbklEQVQI1zXNWw6FIAwEUNdTikB5RFGQH3P3v6K59fVx0nQyaScSAaUEihHGWkgIEM0uOWeUUp6pnayi9j5J96B97/2NmTHRuoL2HbRVsHNoraHWit47xhg4jo6mfsuCUwLcPIP1sX1dRz7GGPwBAS0/zqUAktEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"interface-bean\"\n        title=\"interface-bean\"\n        src=\"/static/d39297ac0f81d66d39fc719c111f9b66/36727/interface-bean.png\"\n        srcset=\"/static/d39297ac0f81d66d39fc719c111f9b66/acf4b/interface-bean.png 173w,\n/static/d39297ac0f81d66d39fc719c111f9b66/fc834/interface-bean.png 345w,\n/static/d39297ac0f81d66d39fc719c111f9b66/36727/interface-bean.png 690w,\n/static/d39297ac0f81d66d39fc719c111f9b66/17fa4/interface-bean.png 1035w,\n/static/d39297ac0f81d66d39fc719c111f9b66/d248c/interface-bean.png 1195w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span><br>\n일반적으로 생성된 Bean의 경우 당연하게도 interface와 구현체 모두 <code class=\"language-text\">true</code>로 확인이 가능합니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.992616899097621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABbqAAAW6gHljkMQAAAAbUlEQVQI1z2OSw7EIAxDe50GaIEEVQzfbe9/IE/KqLN4suREtjcKAcQCigHWWsQY/6SUFqJczPjoL6sy/+4igqCe935hjMFGOYNqxa7qjgO9d7TWUErBnBNjjOX1WnBrQD5PGC12D86tES9P4Bf6ID/JgqCTQgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"interface-proxy-bean\"\n        title=\"interface-proxy-bean\"\n        src=\"/static/4b2a5794a8f7ba770d0768d80255eafe/36727/interface-proxy-bean.png\"\n        srcset=\"/static/4b2a5794a8f7ba770d0768d80255eafe/acf4b/interface-proxy-bean.png 173w,\n/static/4b2a5794a8f7ba770d0768d80255eafe/fc834/interface-proxy-bean.png 345w,\n/static/4b2a5794a8f7ba770d0768d80255eafe/36727/interface-proxy-bean.png 690w,\n/static/4b2a5794a8f7ba770d0768d80255eafe/17fa4/interface-proxy-bean.png 1035w,\n/static/4b2a5794a8f7ba770d0768d80255eafe/53d32/interface-proxy-bean.png 1219w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span><br>\n하지만 Proxy의 한번 경유하는 특성으로 <code class=\"language-text\">Return Type</code>과 같은 interface에서만 <code class=\"language-text\">true</code>로 나온 것을 확인할 수 있습니다  </p>\n<br/>\n<p>이러한 문제로 ProxyMode가 걸린 Bean의 경우 주의가 필요합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProtoInterFaceBean</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ProtoInterfaceProxySafe\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"prototype\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ProtoInterfaceImpl</span> <span class=\"token function\">getProtoInterfaceProxySafeBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ProtoInterfaceImpl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Safe Bean\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 간단하게 <code class=\"language-text\">Return Type</code>을 맞춰 주는 것으로 해결 할 수 있습니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.965964343598054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABbqAAAW6gHljkMQAAAAk0lEQVQI13WOSw6DMAxEuQ4mIT8SVKABorZZ9P7nmU5YVN108TS25bGnkxAgWsFaC+89nHMInMWUkOaEOE3UGTfOMgnsJ3LtxHhp8zaftQad7Dt6Y7CtK2qtKOVEvm94PR8oJ+ucsR8HyrLg3Y6PI5TW0D8opb50wlTCon1ITBWDR6aptqTDgJ4MIhCqoTb61v/hA31NXywOxdByAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"interface-proxy-bean-safe\"\n        title=\"interface-proxy-bean-safe\"\n        src=\"/static/e05de13c5365acf351560c78982c3759/36727/interface-proxy-bean-safe.png\"\n        srcset=\"/static/e05de13c5365acf351560c78982c3759/acf4b/interface-proxy-bean-safe.png 173w,\n/static/e05de13c5365acf351560c78982c3759/fc834/interface-proxy-bean-safe.png 345w,\n/static/e05de13c5365acf351560c78982c3759/36727/interface-proxy-bean-safe.png 690w,\n/static/e05de13c5365acf351560c78982c3759/17fa4/interface-proxy-bean-safe.png 1035w,\n/static/e05de13c5365acf351560c78982c3759/67bc9/interface-proxy-bean-safe.png 1234w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<br/>\n<hr>\n<p>이것으로 Bean의 생명주기 Scope의 대한 포스팅을 마무리 합니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 498px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.3012048192771%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwACBP/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/9oADAMBAAIQAxAAAAEWyhnPPFf/xAAZEAADAQEBAAAAAAAAAAAAAAAAAQIDEQT/2gAIAQEAAQUC8/WWrR3UnaZHrTXVJ//EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwGMv//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAbEAADAAIDAAAAAAAAAAAAAAAAARECITFBkf/aAAgBAQAGPwKQUxOjjcgqjbXh/8QAGxAAAwEAAwEAAAAAAAAAAAAAAREhABAxQVH/2gAIAQEAAT8hZMlWfcOoiZ4NNidR4MIH/BkAHO5n/9oADAMBAAIAAwAAABCk/wD/xAAWEQADAAAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QmCQ//8QAFhEAAwAAAAAAAAAAAAAAAAAAARBR/9oACAECAQE/EDS//8QAGxABAQACAwEAAAAAAAAAAAAAAREAITFBYVH/2gAIAQEAAT8QacgbDa4nmNShqXd68xQNJKMPjhApmI7obctAiDSL7hZdKrNtz//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"good\"\n        title=\"good\"\n        src=\"/static/7ee67e2b0778a2bed4f1e40c32f08b4d/58a9f/good-image.jpg\"\n        srcset=\"/static/7ee67e2b0778a2bed4f1e40c32f08b4d/6f483/good-image.jpg 173w,\n/static/7ee67e2b0778a2bed4f1e40c32f08b4d/0fa0d/good-image.jpg 345w,\n/static/7ee67e2b0778a2bed4f1e40c32f08b4d/58a9f/good-image.jpg 498w\"\n        sizes=\"(max-width: 498px) 100vw, 498px\"\n        loading=\"lazy\"\n      />\n    </span>  </p>\n<p>Scope와 관련해서 이것저것 애매한 사항이 많았는데<br>\n이렇게 한번 정리하면서 소스를 짜고 보니 맘속까지 후련해 졌습니다<br>\n이 포스팅이 저와 같은 궁금증을 가지신 분들에서 도움이 되길 바립니다  </p>","frontmatter":{"title":"[Spring] Spring의 Scope와 ProxyMode 알아보기","date":"December 20, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/spring/scope/spring-scope/","previous":{"fields":{"slug":"/data-science/facebook-cambridge-analytica/"},"frontmatter":{"title":"[DataScience] 페이스북을 활용한 트럼프의 대선 전략과 LSA 알고리즘","category":"Data Science"}},"next":{"fields":{"slug":"/elastic/elastic-jvm-matrix/"},"frontmatter":{"title":"[Elastic] Could not create the Java Virtual Machine Error","category":"Elastic"}}}}}