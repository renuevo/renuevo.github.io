{"componentChunkName":"component---src-templates-blog-post-js","path":"/spring/proxy/spring-proxy/","result":{"data":{"site":{"siteMetadata":{"title":"renuevo blog","author":"rubber","siteUrl":"https://renuevo.github.io","comment":{"disqusShortName":"https-renuevo-github-io","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"ba5c95f0-ac19-5229-8c18-dcdb688566de","excerpt":"Spring AOP에서 사용하는 Proxy 스프링에서 사용하는 프록시에 대해 알아볼 시간입니다 총 3편으로 나누어서 구성하였습니다   Spring Proxy의 JDK Dynamic Proxy와 CGLIB   a. Proxy 살펴보기 b. JDK Dynamic Proxy c. CGLIB   Spring의 프록시 생성 (ProxyBeanFactory) a. FactoryBean b. ProxyBeanFactory   Spring Proxy의 빈 후처리기(BeanPostProcessor…","html":"<h2 id=\"spring-aop에서-사용하는-proxy\" style=\"position:relative;\"><a href=\"#spring-aop%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-proxy\" aria-label=\"spring aop에서 사용하는 proxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring AOP에서 사용하는 Proxy</h2>\n<p><strong>스프링에서 사용하는 프록시에 대해 알아볼 시간입니다</strong></p>\n<p>총 3편으로 나누어서 구성하였습니다  </p>\n<ol>\n<li>\n<p><a href=\"https://renuevo.github.io/spring/proxy/spring-proxy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Proxy의 JDK Dynamic Proxy와 CGLIB</a>  </p>\n<blockquote>\n<p>a. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy/#proxy-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Proxy 살펴보기</a><br>\nb. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy/#jdk-dynamic-proxy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JDK Dynamic Proxy</a><br>\nc. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy/#cglib\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CGLIB</a>  </p>\n</blockquote>\n</li>\n<li>\n<p><a href=\"https://renuevo.github.io/spring/proxy/spring-proxy-factory\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring의 프록시 생성 (ProxyBeanFactory)</a></p>\n<blockquote>\n<p>a. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy-factory/#factory-bean\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">FactoryBean</a><br>\nb. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy-factory/#proxyfactorybean\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ProxyBeanFactory</a>  </p>\n</blockquote>\n</li>\n<li><a href=\"\">Spring Proxy의 빈 후처리기(BeanPostProcessor)</a> 🚧 작성중</li>\n</ol>\n<h2 id=\"proxy-살펴보기\" style=\"position:relative;\"><a href=\"#proxy-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"proxy 살펴보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proxy 살펴보기</h2>\n<p>일반적으로 스프링에서 말하는 기능적 프록시는 2가지 패턴의 기능 역할을 합니다  </p>\n<ol>\n<li><strong>데코레이션 패턴 (Decorator Pattern)</strong> 👉 <a href=\"https://renuevo.github.io/design-pattern/decorator-pattern/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">데코레이션 포스팅</a></li>\n</ol>\n<blockquote>\n<p>부가적으로 기능을 부여한다</p>\n</blockquote>\n<ol start=\"2\">\n<li><strong>프록시 패턴 (Proxy Pattern)</strong></li>\n</ol>\n<blockquote>\n<p>접근에 대한 제어를 한다</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.52601156069364%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAACxLAAAsSwGlPZapAAAAk0lEQVQoz7VRWQ6FIBDz/nf0x4h+KAkuyE5fOi94ApyklMzSaWCotaIXGAM6BkUHHiEEQYxRuJQixZwzvPdvnmhuWq5xSunvkEPOOazrimVZcBwH9n2HMQZKKeF5nqG1lnvjaZpgrcU4jti2TURFkNue58F5niLGJi6hS269ruutsY95gs7v+xZx1l7BT96w5y//AA36Jp+ocjxyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"proxy\"\n        title=\"proxy\"\n        src=\"/static/c6aec1262657594ce3f76a730bc1d66d/1e043/proxy.png\"\n        srcset=\"/static/c6aec1262657594ce3f76a730bc1d66d/991de/proxy.png 173w,\n/static/c6aec1262657594ce3f76a730bc1d66d/e4d6b/proxy.png 345w,\n/static/c6aec1262657594ce3f76a730bc1d66d/1e043/proxy.png 690w,\n/static/c6aec1262657594ce3f76a730bc1d66d/e3189/proxy.png 1035w,\n/static/c6aec1262657594ce3f76a730bc1d66d/b1001/proxy.png 1380w,\n/static/c6aec1262657594ce3f76a730bc1d66d/7595a/proxy.png 3576w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>프록시는 <code class=\"language-text\">OCP(개방-폐쇄 원칙)</code>을 지키는 아주 좋은 수단입니다<br>\n클라이언트가 서비스 호출시 프록시를 통해 실제 target(서비스구현체)을 호출하도록 만듭니다<br>\n중간에서 프록시는 <strong>부가기능 or 접근제어</strong> 등의 역할을 수행합니다  </p>\n<p>일반적으로 많이 사용하는 <code class=\"language-text\">@Transactional</code> 같은 애들이 이러한 프록시를 통해 구현되어 있으며<br>\n이러한 트릭을 통해 개발자는 서비스 구현에만 더욱 집중할 수 있도록 만들어 줍니다  </p>\n<br/>\n<br/>\n<p><strong>👎하지만 프록시는 <span class='red_font'>단점</span>도 가지고 있습니다</strong>  </p>\n<ol>\n<li>target(서비스)의 개수만큼 프록시가 생성되어야 한다  </li>\n<li>같은 기능의 경우 코드 중복이 일어난다  </li>\n<li>프록시를 사용하지 않는 메서드도 래핑처리되어 프록시를 통해 target에 도달한다  </li>\n</ol>\n<br/>\n<p>이러한 단점들을 보완하기 위한 해결책이 다이나믹프록시입니다<br>\n개발자가 프록시를 별도로 생성하는것이 아니라 런타임시 동적으로 가상 객체를 적용시킵니다<br>\n이렇게 런타임시 동적으로 프록시 객체를 생성해서 적용하는 방식을 <code class=\"language-text\">런타임 위빙(Runtime Weaving)</code>이라고 합니다  </p>\n<br/>\n<p>그럼 다음으로 Spring AOP가 내부에서 동적으로 프록시를 생성할때 사용되는 <code class=\"language-text\">JDK Dynamic Proxy</code>와 <code class=\"language-text\">CGLIB</code>를 알아보겠습니다  </p>\n<br/>\n<h2 id=\"jdk-dynamic-proxy\" style=\"position:relative;\"><a href=\"#jdk-dynamic-proxy\" aria-label=\"jdk dynamic proxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JDK Dynamic Proxy</h2>\n<p>예전(🦷)에는 꼭 스프링 3.0에서는 @Service를 만들기전에 interface를 생성해야 한다고 배웠었습니다<br>\n그 이유는 그때 당시에 스프링에서는 기본적으로 사용되던 프록시가 <code class=\"language-text\">JDK Dynamic Proxy</code>이기 때문입니다<br>\n그럼 JDK Dynamic Proxy의 구조를 살펴 보며 왜 interface가 필요한지 알아보도록 하겠습니다  </p>\n<br/>\n<h3 id=\"jdk-dynamic-proxy-구조-살펴보기\" style=\"position:relative;\"><a href=\"#jdk-dynamic-proxy-%EA%B5%AC%EC%A1%B0-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"jdk dynamic proxy 구조 살펴보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JDK Dynamic Proxy 구조 살펴보기</h3>\n<p>JDK Dynamic Proxy의 내부 구성부터 알아보겠습니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.06936416184971%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAACxLAAAsSwGlPZapAAABOklEQVQoz4WS666CMBCEef/nkx8KhCDIHcUbCKJrvk2WQ4gnNpl0205nZ7d1TqeTuK4rURRJmqaSZdmM1+sljPf7Lb+GcRwCLk7TpDNr21sKET+fT+UtwR4wjvMrq4k+Hg8ZhkG6rpPL5TKDPTCO45/D/7AcXGJcr1fZ7Xay3+8lDEPp+165zCq4dLIWwVVVVXI8HuV8Pkscx5Lnudzvd2maRvt8u93UKeV/dUjv7DHIihPf9+VwOMy9YsDhIXEbBIEmnx0uSZvNRl/d8zwtkxLpmyW0R2CvrmudAVzuOzQTJ2xQFiUYEAPElNm2rZZHDJdWIGZ8NByycADKslQymXCYJIk6L4pC+K/0E0HOwHa71XbQFkxhzkHAnp5s5gQHBkTs2xDbuX0d1txTwfW/4+IaEC3pt3MDlX0AHyRVCdCP66sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JDK Dynamic Proxy\"\n        title=\"JDK Dynamic Proxy\"\n        src=\"/static/014aa2863cc665cffa41ff95549fe600/1e043/jdk-proxy.png\"\n        srcset=\"/static/014aa2863cc665cffa41ff95549fe600/991de/jdk-proxy.png 173w,\n/static/014aa2863cc665cffa41ff95549fe600/e4d6b/jdk-proxy.png 345w,\n/static/014aa2863cc665cffa41ff95549fe600/1e043/jdk-proxy.png 690w,\n/static/014aa2863cc665cffa41ff95549fe600/e3189/jdk-proxy.png 1035w,\n/static/014aa2863cc665cffa41ff95549fe600/b1001/jdk-proxy.png 1380w,\n/static/014aa2863cc665cffa41ff95549fe600/fa65c/jdk-proxy.png 3064w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>JDK Proxy</span></p>\n<p>실제적으로 서비스구현체와 같은 interface를 상속받아서 프록시가 구성됩니다<br>\n같은 interface로 구현되면서 호출에 대한 메서드를 래핑해서 구현하는게 가능합니다<br>\n이 과정에서 메서드정보등이 사용되면서 자바내의 리플렉션을 사용합니다  </p>\n<br/>\n<p><strong>🏷️위의 구조로 JDK Dynamic Proxy의 특징을 살펴볼수 있습니다</strong>  </p>\n<ol>\n<li>public 메서드만 proxy가 작동한다  </li>\n<li>내부끼리의 메서드 호출로는 proxy를 타지 않기 때문에 aop가 동작하지 않는다  </li>\n<li>리플렉션을 사용하면서 오버헤드가 발생한다  </li>\n<li>interface가 필수적으로 필요하다  </li>\n</ol>\n<br/>\n<br/>\n<h3 id=\"jdk-dynamic-proxy-소스로-확인하기\" style=\"position:relative;\"><a href=\"#jdk-dynamic-proxy-%EC%86%8C%EC%8A%A4%EB%A1%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"jdk dynamic proxy 소스로 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JDK Dynamic Proxy 소스로 확인하기</h3>\n<p>Proxy생성을 위해 java에서는 리플랙션 패키지내의 Proxy 클래스가 존재합니다<br>\n내부적으로 target의 대한 메서드 호출을 위해 <code class=\"language-text\">InvocationHandler</code>만 구현하여 간단하게 프록시 생성이 가능합니다  </p>\n<p>핵심 클래스는 아래 두개입니다  </p>\n<blockquote>\n<ol>\n<li>Proxy  </li>\n<li>InvocationHandler  </li>\n</ol>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span>reflect</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Proxy</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>Serializable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">newProxyInstance</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassLoader</span> loader<span class=\"token punctuation\">,</span>       <span class=\"token operator\">-></span> 프록시를 만들 <span class=\"token class-name\">Class</span> <span class=\"token class-name\">Loader</span>\n                                          <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> interfaces<span class=\"token punctuation\">,</span>    <span class=\"token operator\">-></span> target <span class=\"token keyword\">interface</span>\n                                          <span class=\"token class-name\">InvocationHandler</span> h<span class=\"token punctuation\">)</span>      <span class=\"token operator\">-></span> <span class=\"token class-name\">InvocationHandler</span> 구현체\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">InvocationHandler</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>\n                            <span class=\"token class-name\">Object</span> proxy<span class=\"token punctuation\">,</span>   <span class=\"token operator\">-></span> 프록시 객체 <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token class-name\">Method</span> method<span class=\"token punctuation\">,</span>  <span class=\"token operator\">-></span> 호출된 메서드 \n                            <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args   <span class=\"token operator\">-></span> 메서드의 매개변수\n                        <span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 두개의 클래스를 통해 간단하게 JDK Proxy를 구현할 수 있고 메서드별 핸들링이 가능합니다<br>\n내부적으로는 메서드 호출은 아래와 같은 플로우 구조를 가집니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.398843930635834%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAACE4AAAhOAFFljFgAAAA/ElEQVQoz41S2aqFQAzz/z9PXBDFDTcQ3HHXXhKYwes5DydQ0DTNtJ0x2rYVx3EkjmPxPE+iKJLzPAW47/trPHMK6tt4i67r+hC/8TZ6hqESfd/Lvu//CmA+TRNzXdcJptm2jTnw4zh+HEbD4zgkDEOp65qm8zyTA8D7vs9wXZfGQJIkzOGAdV0ZukOQCBRhn1mWsZtlWXRHCjgMUZYlDW3blqIoqMNE2hAiGFqWRQEKcEGmabKzIAj0gWmaskNwyEOPyb4a4qbzPJemacgNw6C7wxqwN3SOKaBHh1VVcWRtCKFavFo+igD8IwfjJ684BL5xSfrZ/PI8fuGBP2autj9LuYUZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JDK Dynamic Proxy\"\n        title=\"JDK Dynamic Proxy\"\n        src=\"/static/f22df8b9e3b524c9a65e0992e9c8cfc2/1e043/jdk-proxy-call.png\"\n        srcset=\"/static/f22df8b9e3b524c9a65e0992e9c8cfc2/991de/jdk-proxy-call.png 173w,\n/static/f22df8b9e3b524c9a65e0992e9c8cfc2/e4d6b/jdk-proxy-call.png 345w,\n/static/f22df8b9e3b524c9a65e0992e9c8cfc2/1e043/jdk-proxy-call.png 690w,\n/static/f22df8b9e3b524c9a65e0992e9c8cfc2/e3189/jdk-proxy-call.png 1035w,\n/static/f22df8b9e3b524c9a65e0992e9c8cfc2/b1001/jdk-proxy-call.png 1380w,\n/static/f22df8b9e3b524c9a65e0992e9c8cfc2/fa63f/jdk-proxy-call.png 2298w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>JDK Proxy 호출구조</span></p>\n<br/>\n<br/>\n<p><strong>그럼 간단하게 프록시를 구현해 보겠습니다</strong> 👉 <a href=\"https://github.com/renuevo/spring-boot-kotlin-in-action/tree/master/spring-boot-aop-proxy-in-action\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a><br>\n<span class='code_header'><strong>Target Code</strong></span></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">interface</span> JdkProxyService <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token annotation builtin\">@Service</span>\n<span class=\"token keyword\">class</span> JdkProxyServiceImpl <span class=\"token operator\">:</span> JdkProxyService <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"I'm A\"</span></span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"I'm B\"</span></span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"I'm C\"</span></span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='code_header'><strong>Proxy Test Code</strong></span></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> JdkProxyTest <span class=\"token operator\">:</span> <span class=\"token function\">ShouldSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">context</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"JDK Proxy Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Invocation Handler\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> jdkProxyTarget<span class=\"token operator\">:</span> JdkProxyService <span class=\"token operator\">=</span> <span class=\"token function\">JdkProxyServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">val</span> proxy <span class=\"token operator\">=</span> Proxy<span class=\"token punctuation\">.</span><span class=\"token function\">newProxyInstance</span><span class=\"token punctuation\">(</span>\n                jdkProxyTarget<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>classLoader<span class=\"token punctuation\">,</span>\n                <span class=\"token function\">arrayOf</span><span class=\"token punctuation\">(</span>JdkProxyService<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">TestInvocationHandler</span><span class=\"token punctuation\">(</span>jdkProxyTarget<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> JdkProxyService\n\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> TestInvocationHandler <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span>jdkProxyService<span class=\"token operator\">:</span> JdkProxyService<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> InvocationHandler <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> target <span class=\"token operator\">=</span> jdkProxyService\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>proxy<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> Method<span class=\"token punctuation\">,</span> args<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span><span class=\"token keyword\">out</span> Any<span class=\"token operator\">></span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"methodA\"</span></span> <span class=\"token operator\">-></span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"너는 A로 향하는군\"</span></span> <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span> <span class=\"token operator\">-></span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"TestInvocationHandler 지나갑니다\"</span></span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>args <span class=\"token operator\">?:</span> <span class=\"token function\">arrayOfNulls</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>    <span class=\"token operator\">-></span> 실제 target 호출\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='code_header'><strong>Result</strong></span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">INFO com.github.renuevo.proxy.TestInvocationHandler - 너는 A로 향하는군\nINFO com.github.renuevo.proxy.domain.jdk.JdkProxyServiceImpl - I'm A\nINFO com.github.renuevo.proxy.TestInvocationHandler - TestInvocationHandler 지나갑니다\nINFO com.github.renuevo.proxy.domain.jdk.JdkProxyServiceImpl - I'm B\nINFO com.github.renuevo.proxy.TestInvocationHandler - TestInvocationHandler 지나갑니다\nINFO com.github.renuevo.proxy.domain.jdk.JdkProxyServiceImpl - I'm C</code></pre></div>\n<p>결과에서 프록시를 통해 순차적으로 잘 호출되는 것을 확인할 수 있습니다  </p>\n<br/>\n<h2 id=\"cglib\" style=\"position:relative;\"><a href=\"#cglib\" aria-label=\"cglib permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CGLIB</h2>\n<p>다음으로 알아볼 것은 CGLIB입니다<br>\n현재 스프링에서 defulat로 채택되어 사용되고 있는 프록시 방식이기도 합니다<br>\n<code class=\"language-text\">CGLIB</code>은 바이트코드 연산으로 JDK Proxy보다 빠른 프록시를 지원합니다<br>\n그럼 CGLIB의 구조를 살펴 보며 왜 interface가 필요없고 더 빠르게 동작할 수 있는지 알아보도록 하겠습니다  </p>\n<br/>\n<h3 id=\"cglib-구조-살펴보기\" style=\"position:relative;\"><a href=\"#cglib-%EA%B5%AC%EC%A1%B0-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"cglib 구조 살펴보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CGLIB 구조 살펴보기</h3>\n<p>CGLIB의 내부 구성을 알아보겠습니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.06936416184971%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAACxLAAAsSwGlPZapAAABGUlEQVQoz4WS6aqDQAyFff/nUxRcfohFFKn70rqkfIEUEe9t4DBjcsycnBmnaRrxPE+iKJLH4yFFUUiaptK2rRDHcSh+hXEcNvu+K7ZtE/s2wnld11UBz2A54zi/TrWGy7LI6/WS9/stfd9L13W60szyX4V/4axwnmdVTmRZJnEcqzUEeera8Kzk6tU5hwr8xtthGOT5fEqe57onx/i3Cs/+/RfwUBiGoY5/6yEk13X11iHi2/kiqNs3NRRP0/TlUXcwk/kZyca5AvPHcdQGqLEcK3nj0cupqkr9AGVZKoGTUIj5BG+zrmutowYBQRCI7/uSJInyUaoNaYA6QNKUoNaAKns27C1ngM9/2vB6q/x4BUQ79K5uQOkHTt9YyaIcFB4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CGLIB\"\n        title=\"CGLIB\"\n        src=\"/static/0351ba723de6689f20a80700cefc8a4b/1e043/cglib.png\"\n        srcset=\"/static/0351ba723de6689f20a80700cefc8a4b/991de/cglib.png 173w,\n/static/0351ba723de6689f20a80700cefc8a4b/e4d6b/cglib.png 345w,\n/static/0351ba723de6689f20a80700cefc8a4b/1e043/cglib.png 690w,\n/static/0351ba723de6689f20a80700cefc8a4b/e3189/cglib.png 1035w,\n/static/0351ba723de6689f20a80700cefc8a4b/b1001/cglib.png 1380w,\n/static/0351ba723de6689f20a80700cefc8a4b/fa65c/cglib.png 3064w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>CGLib Proxy</span></p>\n<p>CGLIB은 기본 클래스를 상속받아서 Proxy를 구현합니다<br>\n이러한 구조 덕분에 별도의 interface 없이도 프록시 생성이 가능합니다<br>\n또한 CGLIB을 이용한 리플렉션 활용으로 빠른 메서드 호출도 지원합니다  </p>\n<br/>\n<p><strong>🏷️위의 구조로 CGLIB Proxy의 특징을 살펴볼수 있습니다</strong>  </p>\n<ol>\n<li>public, protected 메서드에서 proxy가 작동한다    </li>\n<li>내부끼리의 메서드 호출로는 proxy를 타지 않기 때문에 aop가 동작하지 않는다  </li>\n<li>내부에서 CGLIB을 이용해 리플렉션을 사용한다  </li>\n<li>상속을 통해 프록시를 만들어서 interface가 필요하지 않다 (상속이기 때문에 final, private ❌)  </li>\n</ol>\n<br/>\n<br/>\n<h3 id=\"cglib-소스로-확인하기\" style=\"position:relative;\"><a href=\"#cglib-%EC%86%8C%EC%8A%A4%EB%A1%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"cglib 소스로 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CGLIB 소스로 확인하기</h3>\n<p>CGLIB Proxy구현을 위해서는 CGLIB 라이브러리가 필요합니다 (Spring 3.2부터는 Core패키지에 cglib.proxy가 포함)<br>\nCGLIB에서도 JDK Proxy와 같이 CGLIB 패키지내의 <code class=\"language-text\">InvocationHandler</code>를 구현하여 프록시 생성이 가능합니다<br>\n하지만 일반적으로 사용되고 있는 <code class=\"language-text\">MethodInterceptor</code>를 구현하여 프록시를 생성해 보겠습니다  </p>\n<p>핵심 클래스는 아래 두개입니다  </p>\n<blockquote>\n<ol>\n<li>Enhancer  </li>\n<li>MethodInterceptor<br>\n<span class='red_font'>이곳에서 사용하는 MethodInterceptor는 ProxyFactoryBean에서 사용하는 것과는 다릅니다!!</span>  </li>\n</ol>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cglib<span class=\"token punctuation\">.</span>proxy</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Enhancer</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractClassGenerator</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span> superclass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Callback</span> callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">Enhancer</span> e <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Enhancer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\te<span class=\"token punctuation\">.</span><span class=\"token function\">setSuperclass</span><span class=\"token punctuation\">(</span>superclass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token operator\">-></span> 프록시를 만들 <span class=\"token class-name\">Class</span>\n\t\te<span class=\"token punctuation\">.</span><span class=\"token function\">setCallback</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>          <span class=\"token operator\">-></span> <span class=\"token class-name\">MethodInterceptor</span> 구현체\n\t\t<span class=\"token keyword\">return</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cglib<span class=\"token punctuation\">.</span>proxy</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Method</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MethodInterceptor</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Callback</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Object</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> var1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Method</span> var2<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> var3<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MethodProxy</span> var4<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 두개의 클래스를 통해 CGLIB을 구현할 수 있습니다<br>\nfilter를 통해 메서드별 interceptor를 컨트롤 가능하며 <code class=\"language-text\">MethodProxy var4</code>를 통해 빠른 메서드 invoke가 가능합니다<br>\n호출 구조는 아래와 같습니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.398843930635834%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAACxLAAAsSwGlPZapAAABFElEQVQoz22Ri66CMBBE+/9/R4JRw0sgIQQERR6igHtzNilBvJtM291up9Opud/vcj6f5XK5SBAEcjwepa5rIT6fzw/29X1uGIqikLZttbAsy9r4X+z39rl5v9+SJIlUVSWsx3Fc0TSN3G43BS/hUupd18n1etXZ9g7DoLNhsIE6YCOOY3FdV204HA5qCwEROdYg4vl8rsTm9Xopu+d52pRlmTYA9rZhD6GYy/AecB7Qr4Q0pWmqpHmeS1mWEoahOI4jvu9rnRm11CGLomhVbkX9EHIIwr7vFXhIzPOs4Kkox2+IT6eTXvalEDIWNGH01lMIHo/HFwhI+SRyLgXWRzNNk25YVfykbQIctLC1LZHN2Yf0DyJXsbBhBbv7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CGLib Proxy\"\n        title=\"CGLib Proxy\"\n        src=\"/static/a6c2d6602ff8c1ca9192cf64f4160deb/1e043/cglib-call.png\"\n        srcset=\"/static/a6c2d6602ff8c1ca9192cf64f4160deb/991de/cglib-call.png 173w,\n/static/a6c2d6602ff8c1ca9192cf64f4160deb/e4d6b/cglib-call.png 345w,\n/static/a6c2d6602ff8c1ca9192cf64f4160deb/1e043/cglib-call.png 690w,\n/static/a6c2d6602ff8c1ca9192cf64f4160deb/e3189/cglib-call.png 1035w,\n/static/a6c2d6602ff8c1ca9192cf64f4160deb/b1001/cglib-call.png 1380w,\n/static/a6c2d6602ff8c1ca9192cf64f4160deb/fa65c/cglib-call.png 3064w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>CGLib 호출구조</span></p>\n<br/>\n<br/>\n<p><strong>그럼 간단하게 프록시를 구현해 보겠습니다</strong> 👉 <a href=\"https://github.com/renuevo/spring-boot-kotlin-in-action/tree/master/spring-boot-aop-proxy-in-action\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a><br>\n<span class='code_header'><strong>Target Code</strong></span></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Service</span>\n<span class=\"token keyword\">class</span> CglibService <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"I'm A\"</span></span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"I'm B\"</span></span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"I'm C\"</span></span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='code_header'>Proxy Test Code</span></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> CglibTest <span class=\"token operator\">:</span> <span class=\"token function\">ShouldSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">context</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Cglib Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Method Interceptor\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> enhancer <span class=\"token operator\">=</span> <span class=\"token function\">Enhancer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            enhancer<span class=\"token punctuation\">.</span><span class=\"token function\">setSuperclass</span><span class=\"token punctuation\">(</span>CglibService<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span>\n            enhancer<span class=\"token punctuation\">.</span><span class=\"token function\">setCallbacks</span><span class=\"token punctuation\">(</span>\n                <span class=\"token function\">arrayOf</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token function\">TestCglibMethodInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"0\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\">//0</span>\n                    <span class=\"token function\">TestCglibMethodInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"1\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\">//1</span>\n                <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n            \n            <span class=\"token comment\">//필터를 통해 A만 1번 Interceptor로</span>\n            enhancer<span class=\"token punctuation\">.</span><span class=\"token function\">setCallbackFilter</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"methodA\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span>\n                <span class=\"token keyword\">else</span> <span class=\"token number\">0</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">val</span> proxy <span class=\"token operator\">=</span> enhancer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> CglibService\n\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> <span class=\"token function\">TestCglibMethodInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> number<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> MethodInterceptor <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> Method<span class=\"token punctuation\">,</span> args<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span><span class=\"token keyword\">out</span> Any<span class=\"token operator\">></span><span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> proxy<span class=\"token operator\">:</span> MethodProxy<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"interceptor number is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">number</span></span><span class=\"token string\">\"</span></span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">//성능상 이점을 가진다</span>\n        <span class=\"token keyword\">return</span> proxy<span class=\"token punctuation\">.</span><span class=\"token function\">invokeSuper</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>args <span class=\"token operator\">?:</span> <span class=\"token function\">arrayOfNulls</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이전 InvocationHandler와는 다르게 method를 invoke하지 않고 <strong>proxy의 invokeSuper</strong>를 사용합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">private</span> void <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/*</span>\n<span class=\"token comment\">     * Using a volatile invariant allows us to initialize the FastClass and</span>\n<span class=\"token comment\">     * method index pairs atomically.</span>\n<span class=\"token comment\">     *</span>\n<span class=\"token comment\">     * Double-checked locking is safe with volatile in Java 5.  Before 1.5 this</span>\n<span class=\"token comment\">     * code could allow fastClassInfo to be instantiated more than once, which</span>\n<span class=\"token comment\">     * appears to be benign.</span>\n<span class=\"token comment\">     */</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fastClassInfo <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">synchronized</span> <span class=\"token punctuation\">(</span>initLock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fastClassInfo <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                CreateInfo ci <span class=\"token operator\">=</span> createInfo<span class=\"token punctuation\">;</span>\n\n                FastClassInfo fci <span class=\"token operator\">=</span> new <span class=\"token function\">FastClassInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                fci<span class=\"token punctuation\">.</span>f1 <span class=\"token operator\">=</span> <span class=\"token function\">helper</span><span class=\"token punctuation\">(</span>ci<span class=\"token punctuation\">,</span> ci<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                fci<span class=\"token punctuation\">.</span>f2 <span class=\"token operator\">=</span> <span class=\"token function\">helper</span><span class=\"token punctuation\">(</span>ci<span class=\"token punctuation\">,</span> ci<span class=\"token punctuation\">.</span>c2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                fci<span class=\"token punctuation\">.</span>i1 <span class=\"token operator\">=</span> fci<span class=\"token punctuation\">.</span>f1<span class=\"token punctuation\">.</span><span class=\"token function\">getIndex</span><span class=\"token punctuation\">(</span>sig1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                fci<span class=\"token punctuation\">.</span>i2 <span class=\"token operator\">=</span> fci<span class=\"token punctuation\">.</span>f2<span class=\"token punctuation\">.</span><span class=\"token function\">getIndex</span><span class=\"token punctuation\">(</span>sig2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                fastClassInfo <span class=\"token operator\">=</span> fci<span class=\"token punctuation\">;</span>\n                createInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">public</span> Object <span class=\"token function\">invokeSuper</span><span class=\"token punctuation\">(</span>Object obj<span class=\"token punctuation\">,</span> Object<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> throws Throwable <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        FastClassInfo fci <span class=\"token operator\">=</span> fastClassInfo<span class=\"token punctuation\">;</span></span>        <span class=\"token keyword\">return</span> fci<span class=\"token punctuation\">.</span>f2<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>fci<span class=\"token punctuation\">.</span>i2<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>InvocationTargetException e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getTargetException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>MethodProxy는 내부적으로 FastClassInfo를 처음 호출시에만 init()하여 보관하며 invoke를 호출합니다<br>\nFastClass의 invoke를 호출하여 기존 method invoke보다 빠른 함수 호출을 사용합니다  </p>\n<p><span class='code_header'>Result</span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">INFO com.github.renuevo.proxy.TestCglibMethodInterceptor - interceptor number is 1\nINFO com.github.renuevo.proxy.domain.cglib.CglibService - I'm A\nINFO com.github.renuevo.proxy.TestCglibMethodInterceptor - interceptor number is 0\nINFO com.github.renuevo.proxy.domain.cglib.CglibService - I'm B\nINFO com.github.renuevo.proxy.TestCglibMethodInterceptor - interceptor number is 0\nINFO com.github.renuevo.proxy.domain.cglib.CglibService - I'm C</code></pre></div>\n<p>결과에서 프록시가 잘 호출되는 것을 확인할 수 있습니다  </p>\n<br/>\n<h3 id=\"cglib-부가-설명\" style=\"position:relative;\"><a href=\"#cglib-%EB%B6%80%EA%B0%80-%EC%84%A4%EB%AA%85\" aria-label=\"cglib 부가 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CGLIB 부가 설명</h3>\n<p>현재 <code class=\"language-text\">Spring은 4.3, Spring-boot는 1.4</code>부터 CGLIB을 Proxy생성에 defulat로 사용되고 있습니다<br>\nCGLIB에 있던 문제들이 아래와 같이 해결되었기 때문입니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.80346820809249%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcRAAAXEQHKJvM/AAAC+UlEQVQoz12S70uTURTH77NNayrOYa5QMjObmFTQi+qVidUfoAytvVtbakigvjAl0S0HvgvcIqlMKRVKSCgHoquGphub+cJsM2Ktlj7Osbk9P/bD9rNz5ybRhQ/n3Of53nPOveegvr4+MVANnAOKgVPACaBCpVJVKxTyol9OJ/J4vGjH7UYsy6JoNIoikUjGEthPJpMoteDgNaC2v7+/Bmw5WAIsb2xsjItFdoejdIskb7vd7lsu146cYRg5BJIBd2KxWDWAYtEocRBQqVTyu7q6suvr63MHBgZyBgcHcRKckUOS27gyidfrTXp3fUmKopMMy6Zg2UByb29PGQqFUTAU4iUSif2APT09SK/XY5fb3t6OmpubUXd3N/pm2+C4tkhE/t48v/HV9tb23fHK7nC+tv9wvNkit1+wgdDLSCxeiyvbcXs4FosFmUwmhCQSCUovbmdnZ8oRCoUpe0N6ExsOIAKOAMX4Nw6CCQTD2BLT09OpvVgsRqikpCT1sbe3Nwf9tyBr9r97fGht7Qt/2WjK+vDRkK3VPuKVlZVxxsfH+fgf+PuVQQNqlpaWHoKPA+QDhxobG08ajcanVVVVRbAXAHkikagQrvWktbW1AmuAAnxmcXFRMzExUQd+Fg5IDA8/Fk5NTZ2GMcl/PjpaoNFoCoeGho7q9e8rJycnc0HDGxl5lg+aArhepVarPTY7OyswGAyC+fl5AfTgeEdHBx8Xh+x2O6Io/wOaYfw0Q2+Gw2EXzJU7Hk84YTTYeDyuNa9YsOaTz7froynqJ0VRLoamXTCTm8Fg0A8a3fr6+v4sfl5dRVartWZhYUFtNpvvQfn35+bmVFCB0uPx3AXRpT/hMBEMBlYgQIiFxDCL/kCA9dM0TYGPx2cZD7zNZiUy780DSoFKAL8PtAuVpzmMBS0tLWebmpquyGSyyw0NDXVSqbS2ra3tIkmSxZBUkGnaQffSneao1Wruu5kZQqfTcRQKBQ8C8QSClP4McB24AOAGXE37OHleprK/mPnMXZU9ckUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cglib 문제점 해결\"\n        title=\"cglib 문제점 해결\"\n        src=\"/static/fad15f8f7a6890bc35e98f1956ba1182/1e043/cglib4.png\"\n        srcset=\"/static/fad15f8f7a6890bc35e98f1956ba1182/991de/cglib4.png 173w,\n/static/fad15f8f7a6890bc35e98f1956ba1182/e4d6b/cglib4.png 345w,\n/static/fad15f8f7a6890bc35e98f1956ba1182/1e043/cglib4.png 690w,\n/static/fad15f8f7a6890bc35e98f1956ba1182/e3189/cglib4.png 1035w,\n/static/fad15f8f7a6890bc35e98f1956ba1182/b1001/cglib4.png 1380w,\n/static/fad15f8f7a6890bc35e98f1956ba1182/2d912/cglib4.png 1772w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br>\n<span class='img_caption'>Source : <a href=\"https://gmoon92.github.io/spring/aop/2019/04/20/jdk-dynamic-proxy-and-cglib.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Moon Blog</a></span>  </p>\n<br/>\n<hr>\n<br/>\n<h3 id=\"one-more-thing-\" style=\"position:relative;\"><a href=\"#one-more-thing-\" aria-label=\"one more thing  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>One More Thing 🤔</h3>\n<p>JDK Proxy와 CGLIB Proxy로 스프링에서 사용하는 Proxy에 대해 알아 보았습니다<br>\n하지만 이렇게 간단히 프록시 생성이 가능하지만 관리 및 생성의 문제가 있습니다  </p>\n<ol>\n<li>프록시가 중첩되면 코드가 복잡해진다  </li>\n<li>target별로 프록시를 생성하는 코드 및 관리 포인트가 증가한다  </li>\n<li>사용하지 않는 메서드도 프록시에 구현해서 서빙해야 한다  </li>\n<li>같은 기능의 프록시 기능이 target별로 중복될 수 있다  </li>\n</ol>\n<br/>\n<p>이러한 문제를 해결하기 위해 Spring은 내부적으로 <code class=\"language-text\">ProxyBeanFactory</code>를 통해 Proxy를 생성합니다  </p>\n<p>Spring은 내부적으로 인터페이스가 있으면 JDK Proxy, 없으면 CGLIB으로 프록시를 생성합니다<br>\n사용자는 간단하게 Spring AOP를 통해 Proxy 기능을 사용할 수 있습니다  </p>\n<br/>\n<p><strong>다음 포스팅에서는 ProxyBeanFactory에 대해 알아보도록 하겠습니다</strong>  </p>\n<br/>\n<h2 id=\"관련-참고\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EB%A0%A8-%EC%B0%B8%EA%B3%A0\" aria-label=\"관련 참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관련 참고</h2>\n<p><a href=\"https://www.baeldung.com/cglib\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">baeldung cglib</a><br>\n<a href=\"https://www.baeldung.com/spring-aop-vs-aspectj\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">baeldung spring-aop-vs-aspectj</a><br>\n<a href=\"https://velog.io/@suhongkim98/JDK-Dynamic-Proxy%EC%99%80-CGLib\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">suhongkim98님 블로그</a><br>\n<a href=\"https://gmoon92.github.io/spring/aop/2019/04/20/jdk-dynamic-proxy-and-cglib.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Moon님 블로그</a><br>\n<a href=\"https://velog.io/@hanblueblue/Spring-Proxy-1-Java-Dynamic-Proxy-vs.-CGLIB\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">keep going님 블로그</a><br>\n<a href=\"https://jiwondev.tistory.com/151\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JiwonDev님 블로그</a><br>\n<a href=\"https://yejun-the-developer.tistory.com/6\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">로키님 블로그</a>  </p>","frontmatter":{"title":"[Spring] Spring Proxy의 JDK Dynamic Proxy와 CGLIB","date":"August 25, 2022"}}},"pageContext":{"slug":"/spring/proxy/spring-proxy/","previous":{"fields":{"slug":"/spring/proxy/spring-bean-post-processor/"},"frontmatter":{"title":"[Spring] Spring Proxy의 빈 후처리기(BeanPostProcessor)","category":"Spring"}},"next":{"fields":{"slug":"/spring/proxy/spring-proxy-factory/"},"frontmatter":{"title":"[Spring] Spring의 프록시 생성 (ProxyBeanFactory)","category":"Spring"}}}},"staticQueryHashes":["3128451518","96099027"]}