{"componentChunkName":"component---src-templates-blog-post-js","path":"/spring/proxy/spring-proxy-factory/","result":{"data":{"site":{"siteMetadata":{"title":"renuevo blog","author":"deokhwa kim","siteUrl":"https://renuevo.github.io","comment":{"disqusShortName":"https-renuevo-github-io","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"584984b8-6e73-54db-ba47-fccc9a6d44d8","excerpt":"Spring AOP에서 사용하는 Proxy 스프링에서 사용하는 프록시에 대해 알아볼 시간입니다 총 3편으로 나누어서 구성하였습니다   Spring Proxy의 JDK Dynamic Proxy와 CGLIB   a. Proxy 살펴보기 b. JDK Dynamic Proxy c. CGLIB   Spring의 프록시 생성 (ProxyBeanFactory)   a. FactoryBean b. ProxyBeanFactory   Spring Proxy의 빈 후처리기(BeanPostProcessor…","html":"<h2 id=\"spring-aop에서-사용하는-proxy\" style=\"position:relative;\"><a href=\"#spring-aop%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-proxy\" aria-label=\"spring aop에서 사용하는 proxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring AOP에서 사용하는 Proxy</h2>\n<p><strong>스프링에서 사용하는 프록시에 대해 알아볼 시간입니다</strong></p>\n<p>총 3편으로 나누어서 구성하였습니다  </p>\n<ol>\n<li>\n<p><a href=\"https://renuevo.github.io/spring/proxy/spring-proxy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Proxy의 JDK Dynamic Proxy와 CGLIB</a>  </p>\n<blockquote>\n<p>a. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy/#proxy-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Proxy 살펴보기</a><br>\nb. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy/#jdk-dynamic-proxy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JDK Dynamic Proxy</a><br>\nc. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy/#cglib\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CGLIB</a>  </p>\n</blockquote>\n</li>\n<li>\n<p><a href=\"https://renuevo.github.io/spring/proxy/spring-proxy-factory\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring의 프록시 생성 (ProxyBeanFactory)</a>  </p>\n<blockquote>\n<p>a. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy-factory/#factory-bean\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">FactoryBean</a><br>\nb. <a href=\"https://renuevo.github.io/spring/proxy/spring-proxy-factory/#proxyfactorybean\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ProxyBeanFactory</a>  </p>\n</blockquote>\n</li>\n<li><a href=\"\">Spring Proxy의 빈 후처리기(BeanPostProcessor)</a> 🚧 작성중  </li>\n</ol>\n<h2 id=\"proxy-factory-살펴보기\" style=\"position:relative;\"><a href=\"#proxy-factory-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"proxy factory 살펴보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proxy Factory 살펴보기</h2>\n<p>이전 포스팅에서 프록시를 직접 생성해서 관리할때의 문제점을 마지막으로 살펴보았습니다  </p>\n<ol>\n<li>프록시가 중첩되면 코드가 복잡해진다  </li>\n<li>target별로 프록시를 생성하는 코드 및 관리 포인트가 증가한다  </li>\n<li>사용하지 않는 메서드도 프록시에 구현해서 서빙해야 한다  </li>\n<li>같은 기능의 프록시 기능이 target별로 중복될 수 있다  </li>\n</ol>\n<p>이러한 문제를 해결하기 위해 스프링에서는 <code class=\"language-text\">Proxy Factory</code>를 통해 프록시를 생성합니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.55491329479769%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAACxLAAAsSwGlPZapAAABH0lEQVQoz52SWYuDUAyF/f//zidfKi5VUdS27nXN8GWIyCwwzIU0t7nJycmJThRFcr/fpW1b+e85jkON40zTJNj7/ZZt22RdVzXuxNM0ldvtJmVZatH1HTMgA3a4LMsiTdPIMAzS9710XaceezweUte1TmDvePJ5o5E1UIb8wGSe5z+PaM2TJBHP87ThOI6fgKDT/fl8aieS6ZrnuSYZK5pypxhmGHFyMGpPDauqkjiOT81835cgCFQKAFgaHp1hRQ5+3/dvy3Eoso4UXA9amk54mCANcZvm9XopEXBODQEi2bbII55YlmUShqEURaFxWAHIf/RzXVfZIscJSPF1s7ZJtGU8xgcAJvZGPp4YRGx85/od/XQoYqyvcvz2gX8AjM8HyV0hBssAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"proxy factory\"\n        title=\"proxy factory\"\n        src=\"/static/09fe71c480c634ab592ae3becc7db054/1e043/proxy-factory.png\"\n        srcset=\"/static/09fe71c480c634ab592ae3becc7db054/991de/proxy-factory.png 173w,\n/static/09fe71c480c634ab592ae3becc7db054/e4d6b/proxy-factory.png 345w,\n/static/09fe71c480c634ab592ae3becc7db054/1e043/proxy-factory.png 690w,\n/static/09fe71c480c634ab592ae3becc7db054/e3189/proxy-factory.png 1035w,\n/static/09fe71c480c634ab592ae3becc7db054/b1001/proxy-factory.png 1380w,\n/static/09fe71c480c634ab592ae3becc7db054/3620b/proxy-factory.png 3624w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Proxy Factory</span></p>\n<p><strong>프록시 팩토리(Proxy Factory)는 스프링의 동적 프록시를 통합하여 생성하는 기능을 제공합니다</strong><br>\n이를 통해 생성 방법을 하나로 통일하여 코드 중복과 관리포인트를 줄일 수 있습니다<br>\n인터페이스의 유무에 따라서 JDK, CGLIB 프록시를 선택하여 생성해 줍니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@SpringBootTest</span>\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> <span class=\"token function\">SpringProxyBeanFactoryTest</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> factoryJdkProxyService<span class=\"token operator\">:</span> FactoryJdkProxyService<span class=\"token punctuation\">,</span>   <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> 인터페이스\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> factoryCglibService<span class=\"token operator\">:</span> FactoryCglibService          <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> 서비스객체\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">ShouldSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Factory Proxy Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> factoryJdkProxyService<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> JDK 프록시\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> factoryCglibService<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>     <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> CGLIB 프록시\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">INFO 28088 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.sun.proxy.$Proxy60\nINFO 28088 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.github.renuevo.proxy.domain.factory.FactoryCglibService$$EnhancerBySpringCGLIB$$236a53fd</code></pre></div>\n<br/>\n<p>그럼 스프링에서 내부적으로 사용하는 ProxyFactory의 대해 알아보도록 하겠습니다  </p>\n<br/>\n<hr>\n<br/>\n<h2 id=\"factory-bean\" style=\"position:relative;\"><a href=\"#factory-bean\" aria-label=\"factory bean permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Factory Bean</h2>\n<p>스프링이 사용하는 일반적인 객체는 new 연산자로 간당히 생성할 수 없을때가 있습니다<br>\nDI(의존성 주입) 및 Bean으로 관리가 필요할 때가 그 이유입니다<br>\nFactoryBean은 빈을 생성하는 팩토리역할을 제공하는 Interface입니다  </p>\n<br/>\n<p><strong>FactoryBean을 통해 객체를 DI 및 Bean으로 사용할 수 있게 되며 IoC에 맞게 구현이 가능하게 합니다</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> FactoryBean<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\n\tString OBJECT_TYPE_ATTRIBUTE <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"factoryBeanObjectType\"</span></span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation builtin\">@Nullable</span>\n\tT <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> throws Exception<span class=\"token punctuation\">;</span> <span class=\"token operator\">-></span> bean 생성\n\n\t<span class=\"token annotation builtin\">@Nullable</span>\n\tClass<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">></span> <span class=\"token function\">getObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">-></span> FactoryBean으로 생성되는 객체의 <span class=\"token keyword\">class</span> type\n\n\tdefault boolean <span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>  <span class=\"token operator\">-></span> bean 생성 객체의 싱글톤 여부\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러한 FactoryBean을 통해서 프록시를 구성한다면 프록시의 생성을 잘 관리 할 수 있을 것 처럼 보입니다<br>\n그러면 어떻게 FactoryBean을 통해 프록시를 구성할 수 있는지 확인해 보도록 하겠습니다  </p>\n<br/>\n<br/>\n<h3 id=\"factorybean을-활용하여-proxy를-구성해보기--code\" style=\"position:relative;\"><a href=\"#factorybean%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-proxy%EB%A5%BC-%EA%B5%AC%EC%84%B1%ED%95%B4%EB%B3%B4%EA%B8%B0--code\" aria-label=\"factorybean을 활용하여 proxy를 구성해보기  code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FactoryBean을 활용하여 Proxy를 구성해보기 👉 <a href=\"https://github.com/renuevo/spring-boot-kotlin-in-action/tree/master/spring-boot-aop-proxy-in-action\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a></h3>\n<p><span class='code_header'><strong>FactoryBean Proxy Code</strong></span></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">    <span class=\"token annotation builtin\">@Configuration</span>\n    <span class=\"token keyword\">class</span> FactoryBeanConfig <span class=\"token punctuation\">{</span>\n    \n        <span class=\"token annotation builtin\">@Bean</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>   <span class=\"token keyword\">fun</span> <span class=\"token function\">jdkProxyService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TestFactoryBean <span class=\"token operator\">=</span> <span class=\"token function\">TestFactoryBean</span><span class=\"token punctuation\">(</span>   <span class=\"token operator\">-></span> FactoryBean을 통한 프록시 처리</span>                interfaceType <span class=\"token operator\">=</span> JdkProxyService<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">,</span>\n                target <span class=\"token operator\">=</span> <span class=\"token function\">JdkProxyServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n    \n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">class</span> <span class=\"token function\">TestFactoryBean</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> interfaceType<span class=\"token operator\">:</span> Class<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> target<span class=\"token operator\">:</span> Any\n    <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> FactoryBean<span class=\"token operator\">&lt;</span>Any<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    \n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>   <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any <span class=\"token operator\">=</span> Proxy<span class=\"token punctuation\">.</span><span class=\"token function\">newProxyInstance</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">            interfaceType<span class=\"token punctuation\">.</span>classLoader<span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token function\">arrayOf</span><span class=\"token punctuation\">(</span>interfaceType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token function\">FactoryBeanInvocationHandler</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span></span>        <span class=\"token punctuation\">)</span>\n    \n        <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Class<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> interfaceType\n    \n    <span class=\"token punctuation\">}</span>\n    \n    \n    <span class=\"token keyword\">class</span> <span class=\"token function\">FactoryBeanInvocationHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> target<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> InvocationHandler <span class=\"token punctuation\">{</span>\n    \n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n    \n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>   <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>proxy<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> Method<span class=\"token punctuation\">,</span> args<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span><span class=\"token keyword\">out</span> Any<span class=\"token operator\">></span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"Factory Bean Invocation Handler\"</span></span> <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token keyword\">return</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>args <span class=\"token operator\">?:</span> <span class=\"token function\">arrayOfNulls</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">//실제 target 호출</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span></span>    \n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='red_font'>(1)</span> <code class=\"language-text\">fun jdkProxyService(): TestFactoryBean</code>  </p>\n<blockquote>\n<p>Bean 생성을 위해 TestFactoryBean을 return 하지만 Spring 내부 동작으로 interfaceType의 Bean이 등록됩니다  </p>\n</blockquote>\n<br/>\n<p><span class='red_font'>(2)</span> <code class=\"language-text\">override fun getObject(): Any</code>  </p>\n<blockquote>\n<p>실제적으로 Bean에 등록될 객체를 생성하는 부분입니다<br>\nProxy.newProxyInstance를 통해서 프록시 객체를 생성하였습니다  </p>\n</blockquote>\n<br/>\n<p><span class='red_font'>(3)</span> <code class=\"language-text\">override fun invoke(proxy: Any, method: Method, args: Array&lt;out Any>?): Any?</code></p>\n<blockquote>\n<p>FactoryBean에 등록하여 사용할 기능을 정의 합니다    </p>\n</blockquote>\n<br/>\n<br/>\n<p><span class='code_header'><strong>FactoryBean Proxy Test Code</strong></span></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@ContextConfiguration</span><span class=\"token punctuation\">(</span>classes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>FactoryBeanConfig<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> <span class=\"token function\">SpringBeanFactoryTest</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> jdkProxyService<span class=\"token operator\">:</span> JdkProxyService  <span class=\"token operator\">-></span> 스프링 Bean DI</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">ShouldSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">extensions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Extension<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">listOf</span><span class=\"token punctuation\">(</span>SpringExtension<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">init</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Factory Proxy Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            jdkProxyService<span class=\"token punctuation\">.</span><span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            jdkProxyService<span class=\"token punctuation\">.</span><span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            jdkProxyService<span class=\"token punctuation\">.</span><span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='code_header'><strong>Result</strong></span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">INFO com.github.renuevo.proxy.domain.factory.FactoryBeanInvocationHandler - Factory Bean Invocation Handler\nINFO com.github.renuevo.proxy.domain.jdk.JdkProxyServiceImpl - I'm A\nINFO com.github.renuevo.proxy.domain.factory.FactoryBeanInvocationHandler - Factory Bean Invocation Handler\nINFO com.github.renuevo.proxy.domain.jdk.JdkProxyServiceImpl - I'm B\nINFO com.github.renuevo.proxy.domain.factory.FactoryBeanInvocationHandler - Factory Bean Invocation Handler\nINFO com.github.renuevo.proxy.domain.jdk.JdkProxyServiceImpl - I'm C</code></pre></div>\n<p>테스트로 스프링 Bean을 할당받아서 메소드를 호출하여 FactoryBeanInvocationHandler이 잘 적용된걸 확인 할 수 있습니다<br>\n이를 통해 FactoryBean을 활용하여 프록시 생성을 한결 쉽게 할 수 있고 부가기능을 독립적으로 재사용하는게 가능해 집니다  </p>\n<br/>\n<h3 id=\"factorybean으로-proxy구성시-한계점\" style=\"position:relative;\"><a href=\"#factorybean%EC%9C%BC%EB%A1%9C-proxy%EA%B5%AC%EC%84%B1%EC%8B%9C-%ED%95%9C%EA%B3%84%EC%A0%90\" aria-label=\"factorybean으로 proxy구성시 한계점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FactoryBean으로 Proxy구성시 한계점</h3>\n<p>앞서 FactoryBean을 활용해 스프링의 프록시 팩토리를 구현해 보았습니다<br>\n하지만 이러한 구현에도 <span class='red_font'>한계점</span>이 존재합니다  </p>\n<ol>\n<li>\n<p><strong>InvocationHandler 같은 부가기능을 적용할 타겟의 대한 관리</strong>  </p>\n<blockquote>\n<p>부가 기능을 기준으로 여러 타겟에 적용할 때의 어려움이 들어남  </p>\n</blockquote>\n</li>\n<li>\n<p><strong>타겟 기준으로 InvocationHandler 같은 부가기능을 여러게 등록</strong>  </p>\n<blockquote>\n<p>타겟을 기준으로 InvocationHandler을 여러게 등록하려고 하면 FactoryBean을 계속해서 생성해 주어야함  </p>\n</blockquote>\n</li>\n</ol>\n<br/>\n<p>결국 이러한 한계점으로 OCP(개방폐쇄 원칙)을 지키며 개발하기 힘들어 집니다<br>\n프록시 Bean 설정의 대한 중복코드와 자유로운 확장이 어려워 지는 것입니다  </p>\n<br/>\n<h2 id=\"proxyfactorybean\" style=\"position:relative;\"><a href=\"#proxyfactorybean\" aria-label=\"proxyfactorybean permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ProxyFactoryBean</h2>\n<p>이러한 문제점을 해결하기 위해서 스프링에서는 프록시 Bean을 생성해 주는 <code class=\"language-text\">ProxyFactoryBean</code>을 제공합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> ProxyFactoryBean extends ProxyCreatorSupport\n\t\timplements FactoryBean<span class=\"token operator\">&lt;</span>Object<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> BeanClassLoaderAware<span class=\"token punctuation\">,</span> BeanFactoryAware <span class=\"token punctuation\">{</span>\n\t\t\n\t\t<span class=\"token operator\">..</span><span class=\"token operator\">..</span><span class=\"token operator\">..</span>\n\t\t\n\t<span class=\"token keyword\">public</span> Object <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> throws BeansException <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">\t\t<span class=\"token function\">initializeAdvisorChain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> 부가기능 체인</span>\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">getSingletonInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>targetName <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Using non-singleton proxies with singleton targets is often undesirable. \"</span></span> <span class=\"token operator\">+</span>\n\t\t\t\t\t\t<span class=\"token string-literal singleline\"><span class=\"token string\">\"Enable prototype proxies by setting the 'targetName' property.\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">newPrototypeInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n\n\t<span class=\"token keyword\">public</span> Class<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">></span> <span class=\"token function\">getObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonInstance <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonInstance<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tClass<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> ifcs <span class=\"token operator\">=</span> <span class=\"token function\">getProxiedInterfaces</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ifcs<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> ifcs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ifcs<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">createCompositeInterface</span><span class=\"token punctuation\">(</span>ifcs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>targetName <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>beanFactory <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getType</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>targetName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">getTargetClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t\n\t<span class=\"token keyword\">public</span> boolean <span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singleton<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\t\n\t\t<span class=\"token operator\">..</span><span class=\"token operator\">..</span><span class=\"token operator\">..</span>\n\t\t\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<br/>\n<p><code class=\"language-text\">FactoryBean&lt;Object></code>을 상속받고 있고 이전 임시로 구현해본 ProxyFactory와 같이 getObject()를 통해 프록시 객체를 리턴합니다  </p>\n<br/>\n<p>스프링에서 이러한 프록시에 대한 부가기능을 적용하기 위해 3가지 용어가 등장합니다<br>\nAOP를 쓰다보면 자주 등장하는 용어인 <code class=\"language-text\">Advisor</code>, <code class=\"language-text\">Advice</code>, <code class=\"language-text\">Pointcut</code> 입니다  </p>\n<ol>\n<li><strong>Advisor : Advice(부가기능) + Pointcut(적용대상)</strong>  </li>\n<li><strong>Advice</strong> : 타겟에 적용할 부가기능  </li>\n<li><strong>Pointcut</strong> : 부가기능 적용대상을 지정  </li>\n</ol>\n<p>프록시에는 <code class=\"language-text\">Advisor</code>와 <code class=\"language-text\">Adivce</code>를 등록할 수 있고 <code class=\"language-text\">initializeAdvisorChain()</code>을 통해 프록시의 부가기능이 적용됩니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.57225433526012%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAACxLAAAsSwGlPZapAAABG0lEQVQoz41SW3KDMBDjNNAAAeMHfkNnev8zqVon07RpptMP4bW11u7KdMNkMKsdsRQEwucCvccWh1qwbB6S8zbbf6FryVeL1XjoGLFwnZTH5iOFA6bF/RL8a9/Jpx8NlA0oZ4XWO0U88vGBo55Q2qN/0aHcETyLN8GBGEcNtwUkn1FsRLQFanIvx5Wz1QQYWjM+TdAN90rjhYIrO4sn3uOBxNHVxfzoRHKHe6xcgK8Z0+oeHNcu0vh4VNiQiAMlFaIiy94nPPgKFzMS43RKnGCYI1xDrTD0vZuUw7w5VrKYdeBjFBL00nme7w2LxPRWsFiPq6XPck/d+KvZW6cyfntlQU8PF5tZ6UDOGZm/jST0d/47viyYniwhPgHoYfw9eEu6LgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ProxyBeanFactory Relation\"\n        title=\"ProxyBeanFactory Relation\"\n        src=\"/static/d152a02e12db902dc6949afe32e02950/1e043/ProxyBeanFactory-relation.png\"\n        srcset=\"/static/d152a02e12db902dc6949afe32e02950/991de/ProxyBeanFactory-relation.png 173w,\n/static/d152a02e12db902dc6949afe32e02950/e4d6b/ProxyBeanFactory-relation.png 345w,\n/static/d152a02e12db902dc6949afe32e02950/1e043/ProxyBeanFactory-relation.png 690w,\n/static/d152a02e12db902dc6949afe32e02950/e3189/ProxyBeanFactory-relation.png 1035w,\n/static/d152a02e12db902dc6949afe32e02950/b1001/ProxyBeanFactory-relation.png 1380w,\n/static/d152a02e12db902dc6949afe32e02950/5661c/ProxyBeanFactory-relation.png 5316w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br>\n<span class='img_caption'>ProxyBeanFactory Dependency</span>  </p>\n<p>ProxyBeanFactory의 디펜던시를 보게되면 <code class=\"language-text\">AdvisedSupport</code>가 존재합니다<br>\nAdvisedSupport에서는 타겟과 부가기능(Advisor, Advice)를 등록하는 기능을 제공합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> AdvisedSupport extends ProxyConfig implements Advised <span class=\"token punctuation\">{</span>\n\n   <span class=\"token operator\">..</span><span class=\"token operator\">..</span><span class=\"token operator\">..</span>\n   \n   <span class=\"token annotation builtin\">@Override</span>\n   <span class=\"token keyword\">public</span> void <span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span>Object target<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setTargetSource</span><span class=\"token punctuation\">(</span>new <span class=\"token function\">SingletonTargetSource</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   \n   <span class=\"token annotation builtin\">@Override</span>\n   <span class=\"token keyword\">public</span> void <span class=\"token function\">addAdvisor</span><span class=\"token punctuation\">(</span>Advisor advisor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      int pos <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>advisors<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">addAdvisor</span><span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">,</span> advisor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   \n   <span class=\"token annotation builtin\">@Override</span>\n   <span class=\"token keyword\">public</span> void <span class=\"token function\">addAdvice</span><span class=\"token punctuation\">(</span>Advice advice<span class=\"token punctuation\">)</span> throws AopConfigException <span class=\"token punctuation\">{</span>\n      int pos <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>advisors<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">addAdvice</span><span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">,</span> advice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   \n   <span class=\"token operator\">..</span><span class=\"token operator\">..</span><span class=\"token operator\">..</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>결론적으로 pointcut, advice등을 별도로 구성하여 등록하는 구조가 되면서<br>\n부가기능을 독립적인 객체로 관리하며 사용할 수 있게 되었고 OCP 원칙에 맞게 구조가 갖추어 지게 되었습니다  </p>\n<br/>\n<p>그럼 간단한 코드를 통해 어떠한 구조가 된것 인지 확인해 보도록 하겠습니다  </p>\n<br/>\n<br/>\n<h3 id=\"코드를-통해-proxyfactorybean-살펴보기--code\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C%EB%A5%BC-%ED%86%B5%ED%95%B4-proxyfactorybean-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0--code\" aria-label=\"코드를 통해 proxyfactorybean 살펴보기  code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드를 통해 ProxyFactoryBean 살펴보기 👉 <a href=\"https://github.com/renuevo/spring-boot-kotlin-in-action/tree/master/spring-boot-aop-proxy-in-action\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code</a></h3>\n<p><strong>프록시의 구현은 순서는 4가지로 분류됩니다</strong>  </p>\n<ol>\n<li>Pointcut으로 대상 선정  </li>\n<li>Advice를 통한 기능 구현  </li>\n<li>Advisor로 Pointcut과 Advice를 묶기  </li>\n<li>ProxyFactoryBean을 통한 Proxy 등록  </li>\n</ol>\n<p>이렇게 4개를 구현하게 되면 아래와 같은 flow를 통해 Proxy가 동작하게 됩니다  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.55491329479769%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAACxLAAAsSwGlPZapAAABAklEQVQoz4WSiYqAMAxE/f8vVBFEEcX7vo8uL1CpruwWYtNJOp2OtXzfV2EYqiAIZJ6mSTGu65Iwh8beuK4xLAiIcRxl3vf9k+Q8z08S8wBmiwSSeZ6FcFkWWR/HITnYMAxSX9dVcLOfGn03IR+ALMtUkiTS0Pe9KK6qStZRFAnWdZ3gbduqpmlUWZZiFeT3lfnoaxMUzcGmoihUnucP71CrbWJ+KDQ9oZHYtk3VdS1qyFGHYmrciHjvvRXqhd6IStu2leu6D295EY7jCKk+yNx//xQNYDYquB6+xXEsvpKnaXrn1LFCvwhTqfU+gedBaIyf4Xne7e1Xzy/CN/gX9l/PD5YXDSdL6CvrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AdvisedSupportProxy\"\n        title=\"AdvisedSupportProxy\"\n        src=\"/static/2cb8faa10f0e663237e4c49bf7e4a6ec/1e043/advised-support-proxy.png\"\n        srcset=\"/static/2cb8faa10f0e663237e4c49bf7e4a6ec/991de/advised-support-proxy.png 173w,\n/static/2cb8faa10f0e663237e4c49bf7e4a6ec/e4d6b/advised-support-proxy.png 345w,\n/static/2cb8faa10f0e663237e4c49bf7e4a6ec/1e043/advised-support-proxy.png 690w,\n/static/2cb8faa10f0e663237e4c49bf7e4a6ec/e3189/advised-support-proxy.png 1035w,\n/static/2cb8faa10f0e663237e4c49bf7e4a6ec/b1001/advised-support-proxy.png 1380w,\n/static/2cb8faa10f0e663237e4c49bf7e4a6ec/3620b/advised-support-proxy.png 3624w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Advised Support Proxy</span></p>\n<br/>\n<p>먼저 구현해 줄것은 <code class=\"language-text\">MethodInterceptor</code>입니다<br>\n여기서 말씀드리는 MethodInterceptor는 앞서 프록시에서 구현했것과는 다른 인터페이스입니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>aopalliance<span class=\"token punctuation\">.</span>intercept</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@FunctionalInterface</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MethodInterceptor</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Interceptor</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token annotation punctuation\">@Nullable</span>\n\t<span class=\"token class-name\">Object</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Nonnull</span> <span class=\"token class-name\">MethodInvocation</span> invocation<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n\n<span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cglib<span class=\"token punctuation\">.</span>proxy</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MethodInterceptor</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Callback</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Object</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> var1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Method</span> var2<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> var3<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MethodProxy</span> var4<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>\n<p><code class=\"language-text\">org.springframework.cglib.proxy.MethodInterceptor</code>  </p>\n<blockquote>\n<p>프록시 구현에서 사용, Callback을 상속받는 인터페이스  </p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">org.aopalliance.intercept.MethodInterceptor</code>  </p>\n<blockquote>\n<p>스프링 Advice를 상속하는 인터페이스  </p>\n</blockquote>\n</li>\n</ol>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.11560693641618%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAACxLAAAsSwGlPZapAAABjUlEQVQoz42S63KCMBCFfRgFwk2TcBGRGUUsAmqdjtMfnb7/a5zuRrTYOq0/Didkw8nmIyPHj/CnPA2b3CPfOBq5pVCQFza5rbGmcUA1q187eiaQFweOwj5e4Py5x25Xoukq1PsKWz2Hotot0KbHf6Em0NV4DRJ0ywJdnuO4LtBkOdoghhT6PvAZ8eKQQr2JxNTXkFPCYEkzd8VyO7IbxnBpJzdMIHxykhiIa7zOprFDXYppAneW0By/97X+pCPLUzi17zgcG2zqFXaHC5vmWGFHak9blNuVCT1/dGhpriKGdbcx9W1Twp/G34E8iOICUbqAiueI5gvEWWb8KhVn1GmENF9C0zgtcuRVAZ1mRiIYdMiPiaswEfSniAe77Ukjy5UYO6qf0xizhxpiRrxC+m5Qux774V/2iKVPnEJ5cRbPBcQt1Kl5Fz++uetwKN61rEvi1RKrNbq3lxtL5stsmR+HWw+a+RXIO4UqNWxm1I0krkOpJIOM5nfcHgbe7htf5J7l0C128c16yG0Y+AVCOHwD0ujowgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MethodInterceptor\"\n        title=\"MethodInterceptor\"\n        src=\"/static/583e5606faac76b9174320529b4b8344/1e043/MethodInterceptor.png\"\n        srcset=\"/static/583e5606faac76b9174320529b4b8344/991de/MethodInterceptor.png 173w,\n/static/583e5606faac76b9174320529b4b8344/e4d6b/MethodInterceptor.png 345w,\n/static/583e5606faac76b9174320529b4b8344/1e043/MethodInterceptor.png 690w,\n/static/583e5606faac76b9174320529b4b8344/e3189/MethodInterceptor.png 1035w,\n/static/583e5606faac76b9174320529b4b8344/b1001/MethodInterceptor.png 1380w,\n/static/583e5606faac76b9174320529b4b8344/497e9/MethodInterceptor.png 2064w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span><br>\n<span class='img_caption'>MethodInterceptor</span></p>\n<p>MethodInterceptor는 Adivce 인터페이스를 상속받고 있습니다<br>\nProxyBeanFactory에서 사용하는 MethodInterceptor는 org.aopalliance.intercept 패키지의 인터페이스를 사용합니다   </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> CustomAdvice <span class=\"token operator\">:</span> MethodInterceptor <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>invocation<span class=\"token operator\">:</span> MethodInvocation<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"Proxy 부가기능\"</span></span> <span class=\"token punctuation\">}</span>\n        \n        <span class=\"token keyword\">return</span> invocation<span class=\"token punctuation\">.</span><span class=\"token function\">proceed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>간단하게 MethodInterceptor의 기능으로 “Proxy 부가기능”이라고 출력하도록 작성하였습니다  </p>\n<br/>\n<p>이제 차례대로 프록시에서 사용할 빈으로 등록해 줍니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Configuration</span>\n<span class=\"token keyword\">class</span> CustomAdvisorConfig <span class=\"token punctuation\">{</span>\n\n       <span class=\"token annotation builtin\">@Bean</span>\n <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>   <span class=\"token keyword\">fun</span> <span class=\"token function\">targetPointcut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Pointcut <span class=\"token operator\">=</span> <span class=\"token function\">NameMatchMethodPointcut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">addMethodName</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"method*\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n   \n   \n       <span class=\"token annotation builtin\">@Bean</span>\n <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>   <span class=\"token keyword\">fun</span> <span class=\"token function\">customAdvice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Advice <span class=\"token operator\">=</span> <span class=\"token function\">CustomAdvice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n   \n   \n       <span class=\"token annotation builtin\">@Bean</span>\n <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>   <span class=\"token keyword\">fun</span> <span class=\"token function\">customAdvisor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Advisor <span class=\"token operator\">=</span> <span class=\"token function\">DefaultPointcutAdvisor</span><span class=\"token punctuation\">(</span><span class=\"token function\">targetPointcut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">customAdvice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   \n   \n       <span class=\"token annotation builtin\">@Bean</span>\n <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>   <span class=\"token keyword\">fun</span> <span class=\"token function\">proxyFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token function\">ProxyFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">           <span class=\"token function\">setTarget</span><span class=\"token punctuation\">(</span><span class=\"token function\">ProxyFactoryBeanTarget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">-></span> Target Class 지정</span><span class=\"gatsby-highlight-code-line\">           <span class=\"token function\">setInterceptorNames</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"customAdvisor\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> 이름을 통한 Advisor 지정</span>       <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> ProxyFactoryBeanTarget <span class=\"token operator\">:</span> <span class=\"token function\">FactoryCglibService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<p><span class='red_font'>(1)</span> <code class=\"language-text\">Pointcut을 통한 적용대상 구현</code>  </p>\n<blockquote>\n<p>함수명이 이름이 “method”로 시작하는 메소드에 부가기능이 적용됩니다  </p>\n</blockquote>\n<br/>\n<p><span class='red_font'>(2)</span> <code class=\"language-text\">Advice를 통한 부가기능 구현</code>  </p>\n<blockquote>\n<p>이전 MethodInterceptor를 상속받아 구현한 “Proxy 부가기능” 출력이 기능으로 들어갑니다  </p>\n</blockquote>\n<br/>\n<p><span class='red_font'>(3)</span> <code class=\"language-text\">Advisor를 통한 적용대상과 기능 묶기</code>  </p>\n<blockquote>\n<p>위에서 선언된 Pointcut의 적용대상과 Advice의 기능을 묶어서 Proxy에 등록하도록 생성됩니다  </p>\n</blockquote>\n<br/>\n<p><span class='red_font'>(4)</span> <code class=\"language-text\">ProxyFactoryBean을 통한 Proxy 생성</code>  </p>\n<blockquote>\n<p>Target과 Adivsor를 등록하여 Target에 Proxy를 적용 시킵니다  </p>\n</blockquote>\n<br/>\n<p>인터페이스를 활용하여 각각의 역할을 분리하고 기능을 정의하므로 OCP원칙의 맞는 개발을 할 수 있습니다<br>\n이렇게 인터페이스로 결합도를 낮추고 객체로 기능을 정의하고 포함시켜 코드를 재사용하는 방법을 <strong>합성(Composition)</strong>이라고 합니다  </p>\n<br/>\n<p><span class='code_header'>프록시 확인 코드</span></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@SpringBootTest</span>\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> <span class=\"token function\">SpringProxyBeanFactoryTest</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> factoryJdkProxyService<span class=\"token operator\">:</span> FactoryJdkProxyService<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> factoryCglibService<span class=\"token operator\">:</span> FactoryCglibService<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> proxyFactoryBean<span class=\"token operator\">:</span> ProxyFactoryBeanTarget\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">ShouldSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">context</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Proxy Bean Factory Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Factory Proxy Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> factoryJdkProxyService<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> factoryCglibService<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> proxyFactoryBean<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Call Proxy Bean Factory Method\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            proxyFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxyFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxyFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">### Factory Proxy Test\nINFO 20788 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.sun.proxy.$Proxy60\nINFO 20788 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.github.renuevo.proxy.domain.factory.FactoryCglibService$$EnhancerBySpringCGLIB$$feeedfff\nINFO 20788 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.github.renuevo.proxy.domain.factory.config.ProxyFactoryBeanTarget$$EnhancerBySpringCGLIB$$5eee0c36\n\n\n### Call Proxy Bean Factory Method\nINFO 18716 --- [         task-4] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 18716 --- [         task-6] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 18716 --- [         task-5] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 18716 --- [         task-4] c.g.r.p.d.factory.FactoryCglibService    : I'm A\nINFO 18716 --- [         task-5] c.g.r.p.d.factory.FactoryCglibService    : I'm B\nINFO 18716 --- [         task-6] c.g.r.p.d.factory.FactoryCglibService    : I'm C</code></pre></div>\n<p>가장 먼저 확인해 본것은 <strong>프록시 종류와 프록시 기능 동작</strong> 여부입니다  </p>\n<p>“Factory Proxy Test” 테스트에서 <code class=\"language-text\">JDK Proxy, CGLIB, CGLIB</code>으로 프록시가 생성된것을 확인할 수 있습니다</p>\n<p>“Call Proxy Bean Factory Method” 테스트에서 async로 순서는 보장되지 않았지만 부가기능이 잘 찍히는걸 볼 수 있습니다  </p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@SpringBootTest</span>\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">class</span> <span class=\"token function\">SpringProxyBeanFactoryTest</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> customAdvisor<span class=\"token operator\">:</span> Advisor\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">ShouldSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">val</span> log <span class=\"token operator\">=</span> KotlinLogging<span class=\"token punctuation\">.</span><span class=\"token function\">logger</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">context</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Proxy Bean Factory Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"JDK Proxy Factory Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> proxy <span class=\"token operator\">=</span> <span class=\"token function\">ProxyFactory</span><span class=\"token punctuation\">(</span><span class=\"token function\">FactoryJdkProxyServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">addAdvisor</span><span class=\"token punctuation\">(</span>customAdvisor<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>proxy <span class=\"token keyword\">as</span> FactoryJdkProxyService\n\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> proxy<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"CGlib Proxy Factory Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> proxy <span class=\"token operator\">=</span> <span class=\"token function\">ProxyFactory</span><span class=\"token punctuation\">(</span><span class=\"token function\">ProxyFactoryBeanTarget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span>\n                isProxyTargetClass <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                <span class=\"token function\">addAdvisor</span><span class=\"token punctuation\">(</span>customAdvisor<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>proxy <span class=\"token keyword\">as</span> ProxyFactoryBeanTarget\n\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> proxy<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">should</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Interface Target To CGLIB Proxy Test\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> proxy <span class=\"token operator\">=</span> <span class=\"token function\">ProxyFactory</span><span class=\"token punctuation\">(</span><span class=\"token function\">FactoryJdkProxyServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span>\n                isProxyTargetClass <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                <span class=\"token function\">addAdvisor</span><span class=\"token punctuation\">(</span>customAdvisor<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>proxy <span class=\"token keyword\">as</span> FactoryJdkProxyService\n\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span> <span class=\"token punctuation\">{</span> proxy<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            proxy<span class=\"token punctuation\">.</span><span class=\"token function\">methodC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">### JDK Proxy Factory Test\nINFO 13840 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.sun.proxy.$Proxy60\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.f.FactoryJdkProxyServiceImpl   : I'm A\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.f.FactoryJdkProxyServiceImpl   : I'm B\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.f.FactoryJdkProxyServiceImpl   : I'm C\n\n\n### CGlib Proxy Factory Test\nINFO 13840 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.github.renuevo.proxy.domain.factory.config.ProxyFactoryBeanTarget$$EnhancerBySpringCGLIB$$a27f344b\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.FactoryCglibService    : I'm A\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.FactoryCglibService    : I'm B\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.FactoryCglibService    : I'm C\n\n\n### Interface Target To CGLIB Proxy Test\nINFO 13840 --- [pool-1-thread-1] c.g.r.proxy.SpringProxyBeanFactoryTest   : class com.github.renuevo.proxy.domain.factory.FactoryJdkProxyServiceImpl$$EnhancerBySpringCGLIB$$1187480c\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.f.FactoryJdkProxyServiceImpl   : I'm A\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.f.FactoryJdkProxyServiceImpl   : I'm B\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.factory.config.CustomAdvice    : Proxy 부가기능\nINFO 13840 --- [pool-1-thread-1] c.g.r.p.d.f.FactoryJdkProxyServiceImpl   : I'm C</code></pre></div>\n<p>마지막으로 ProxyFactory를 통해 임의로 프록시를 생성해서 확인해 보았습니다<br>\n인터페이스를 가지고 있다고 하더라도 <code class=\"language-text\">isProxyTargetClass = true</code>를 활용하면 CGLIB 프록시를 생성할 수 있는것 까지 확인할 수 있습니다  </p>\n<hr>\n<h2 id=\"관련-참고\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EB%A0%A8-%EC%B0%B8%EA%B3%A0\" aria-label=\"관련 참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관련 참고</h2>\n<p><a href=\"https://yejun-the-developer.tistory.com/7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">로키님 블로그</a><br>\n<a href=\"https://jiwondev.tistory.com/152\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JiwonDev님 블로그</a><br>\n<a href=\"https://gmoon92.github.io/spring/aop/2019/02/23/spring-aop-proxy-bean.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Moon님 블로그</a><br>\n<a href=\"https://davidpark20.tistory.com/48\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">다비드박의 개발이야기 블로그</a><br>\n<a href=\"https://davidpark20.tistory.com/49\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">다비드박의 개발이야기 블로그</a>  </p>","frontmatter":{"title":"[Spring] Spring의 프록시 생성 (ProxyBeanFactory)","date":"September 08, 2022"}}},"pageContext":{"slug":"/spring/proxy/spring-proxy-factory/","previous":{"fields":{"slug":"/spring/proxy/spring-proxy/"},"frontmatter":{"title":"[Spring] Spring Proxy의 JDK Dynamic Proxy와 CGLIB","category":"Spring"}},"next":null}},"staticQueryHashes":["3128451518","96099027"]}