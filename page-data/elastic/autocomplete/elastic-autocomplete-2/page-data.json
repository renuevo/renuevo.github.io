{"componentChunkName":"component---src-templates-blog-post-js","path":"/elastic/autocomplete/elastic-autocomplete-2/","result":{"data":{"site":{"siteMetadata":{"title":"renuevo blog","author":"rubber","siteUrl":"https://renuevo.github.io","comment":{"disqusShortName":"https-renuevo-github-io","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"39db31fb-08ec-5960-8afb-1a9ce1fb4102","excerpt":"Elastic Autocomplete Guide 시리즈 Autocomplete Prefix Queries Autocomplete Index Search Elastic을 활용하여 다음 3가지 방법의 자동완성 서비스를 구현하는 기술을 다룹니다 Elastic 7.x 버젼을 기준으로 진행합니다    Prefix Queries를 활용한 자동완성   Index 색인을 통한 Search   Completion Suggester를 활용한 자동완성   해당 포스팅에서는 앞서 소개한 Prefix Queries…","html":"<h3 id=\"elastic-autocomplete-guide-시리즈\" style=\"position:relative;\"><a href=\"#elastic-autocomplete-guide-%EC%8B%9C%EB%A6%AC%EC%A6%88\" aria-label=\"elastic autocomplete guide 시리즈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elastic Autocomplete Guide 시리즈</h3>\n<ol>\n<li><a href=\"https://renuevo.github.io/elastic/autocomplete/elastic-autocomplete-1/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Autocomplete Prefix Queries</a></li>\n<li><a href=\"https://renuevo.github.io/elastic/autocomplete/elastic-autocomplete-2/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Autocomplete Index Search</a></li>\n</ol>\n<br/>\n<hr>\n<br/>\n<p><em>Elastic을 활용하여 다음 3가지 방법의 자동완성 서비스를 구현하는 기술을 다룹니다</em><br>\n<em>Elastic 7.x 버젼을 기준으로 진행합니다</em>   </p>\n<ol>\n<li>Prefix Queries를 활용한 자동완성  </li>\n<li>Index 색인을 통한 Search  </li>\n<li>Completion Suggester를 활용한 자동완성  </li>\n</ol>\n<p>해당 포스팅에서는 앞서 소개한 <a href=\"https://renuevo.github.io/elastic/autocomplete/elastic-autocomplete-1/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prefix Queries</a>에서는 다룰수 없었던<br>\n초성검색과 같은 보다 복잡한 자동완성을 해결할 수 있는 <code class=\"language-text\">Index Search</code>를 활용한 자동완성을 만드는 방법 소개합니다  </p>\n<br/>\n<hr>\n<h2 id=\"example-data-setting\" style=\"position:relative;\"><a href=\"#example-data-setting\" aria-label=\"example data setting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Data Setting</h2>\n<p>먼저 테스트 데이터를 준비해 줍니다<br>\n간단한 Index Mapping 정보를 작성합니다  </p>\n<p><span class=\"code_header\"><strong>Autocomplete Example Mapping</strong></span>  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">PUT autocomplete_test_2\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"analysis\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"autocomplete\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"autocomplete\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"lowercase\"</span>\n          <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"autocomplete_search\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lowercase\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"autocomplete\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"edge_ngram\"</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token property\">\"min_gram\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token property\">\"max_gram\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token property\">\"token_chars\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token string\">\"letter\"</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token string\">\"digit\"</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token punctuation\">]</span></span>        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"autocomplete\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"search_analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"autocomplete_search\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>색인을 활용한 자동완성을 위해 커스텀한 형태소 분석을 추가해 줍니다  </p>\n<br/>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elastic에서 기본적으로 제공하는 Tokenizer reference</a><br>\n토큰을 끊는 기준을 Elastic에서 제공하는 edge_ngram으로 작성했습니다<br>\n<code class=\"language-text\">edge_ngram</code>은 자동완성과 아주 잘 맞는 Tokenizer 입니다  </p>\n<br/>\n<p><span class=\"code_header\"><strong>Edge_ngram Tokenizer</strong></span>  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">  <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"autocomplete\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"edge_ngram\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"min_gram\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"max_gram\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"token_chars\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"letter\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"digit\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>edge_ngram는 기본적으로 min_gram과 max_gram을 지정하게 되어있습니다<br>\n글자수를 지정하는 단위로 위와 같이 설정할 경우 “2 Quick Foxes”를 <code class=\"language-text\">[ Qu, Qui, Quic, Quick, Fo, Fox, Foxe, Foxes ]</code> 다음과 같이 끊어 줍니다<br>\n그래서 실제 검색하는 글자 타이핑에 맞게 알맞은 색인어들이 생성됩니다  </p>\n<br/>\n<p>token_chars는 글자수에 포함될 형태의 단위로 위에는 문자와 숫자를 추가 하였습니다<br>\n문자와 숫자를 제외한 다른 것들(공백, 줄바꿈등)은 새롭게 토큰을 시작하는 기준이 됩니다  </p>\n<br/>\n<p>자세한 설명은 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-edgengram-tokenizer.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elastic 공식 가이드</a>에서 확인할 수 있습니다!!  </p>\n<br/>\n<hr>\n<br/>\n<p>이제 기본 index 설정 개념을 알아봤으니 예제의 사용할 데이터를 생성하겠습니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.91329479768786%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVQoz4WSyW7TUBSG87A8Ba/AkiVLWLQrRJFAQt1UVEBLIWmjJnYosZ3JQz1c29eO54/rhNKqCHGk/55zN5/+MwxyKQkchzwIKGOHKBNkRYPcVuQq9+r/aV7t8r8ktzVJ3jBwjTmnb4+YH72h1t7zbT3FCFuipCAv2SnNSkQiqVuo6o6qeSgo1BPFGW7cMUjrhjDJEGmAnbvIMKFwPXyVE1nsssxy8kwispq2Q0VH16nikdpWOfQqiVNIvCrDKRNcVS98FzP0WCUhlrjFT2OEEPhRTCgbmj/Q/t3z+mjalsG6ztg0Ges6x24LFmXK5NZmqjRTUD1wseOIREQ4oqRq7x0+1B6oHDptjdu19HnTbjHVUrQepkDXzgrdd7BFSCBUy3nL3twdaO/sDtj2DkfBOefuMaPgTAFzjDxiuDIZrS00d83YXWH5Nl4oiUt+xz3sIXDXslm7aKnOTBosmxSrivm6mDO2l0oLvpgzzFuHLE3VHGP8RzP8C/j89TN1KjqLWmLVqYJmTEKXE/2az3Od0cbC8GxEGOAFkVpQSaHup+ua3Vb7NvvZ9dCmUTN8+uIJB59eYSpnltq0Ve3BJzcT3o0uOP2pM1nN2BbKAf+PwcHxW15+OORiecOaErNU4DrBKAWnls7h2UeOr4640oZcXg+ZzL6z3MwwlmO0H0Om2pTL8RUre6OOP+YXV/JBnlr1tPEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"coupang_autocomplete\"\n        title=\"coupang_autocomplete\"\n        src=\"/static/7753c6d1c972b63bdcc5f693266ec0a4/1e043/coupang_autocomplete.png\"\n        srcset=\"/static/7753c6d1c972b63bdcc5f693266ec0a4/991de/coupang_autocomplete.png 173w,\n/static/7753c6d1c972b63bdcc5f693266ec0a4/e4d6b/coupang_autocomplete.png 345w,\n/static/7753c6d1c972b63bdcc5f693266ec0a4/1e043/coupang_autocomplete.png 690w,\n/static/7753c6d1c972b63bdcc5f693266ec0a4/774b6/coupang_autocomplete.png 738w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Coupang Search</span>  </p>\n<p>자동완성 샘플 데이터는 쿠팡에 <strong>세트</strong>를 검색해서 나오는 자동완성을 가져왔습니다  </p>\n<br/>\n<p><span class=\"code_header\"><strong>Autocomplete Example Data</strong></span>  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">POST _bulk\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"추석 선물 세트\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"여성 트레이닝복 세트\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"3\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"김밥 재료 세트\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"4\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"여성 속옷 세트\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"5\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"선물 세트\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"6\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"설화수 세트\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"7\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"달고나 만들기 세트\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"autocomplete_test_2\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"8\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"무선 키보드마우스 세트\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>이걸로 기본 데이터 설정은 끝났습니다<br>\n다음은 검색을 통해 어떠한 결과를 가지고 오는지 살펴 보겠습니다  </p>\n<br/> \n<br/>\n<h2 id=\"search를-통한-검색\" style=\"position:relative;\"><a href=\"#search%EB%A5%BC-%ED%86%B5%ED%95%9C-%EA%B2%80%EC%83%89\" aria-label=\"search를 통한 검색 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Search를 통한 검색</h2>\n<p>이게 샘플 데이터를 가지고 검색을 해보겠습니다<br>\n먼저 이해를 돕기 위해 Index에 설정된 analyze로 샘플 데이터가 어떻게 색인되는지 살펴보겠습니다<br>\n다음 쿼리로 샘플데이터의 색인 토큰을 확인 하실 수 있습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">GET autocomplete_test_2/_analyze\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"autocomplete\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"text\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"여성 트레이닝복 세트\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 535px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 140.46242774566474%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMElEQVRIx52VWXOjMBCE/f9/XjYV57AdG9scQgghxOE9qrdHrIn3LdLDFFUUaub4prXphxnH0iA3PXo/wfkRw/QTfrxhGJdnTGwcRbp+xL5q8cmorcdreeEPGvTDLYjHRBA03YADxV6vDV4uGhfdQbU9WjdinOKy3HQUtMzw+VwHwXNtsC+vzLTHOP9aSo/JUHrY8HBtByiGYVYulPolFiO6CLaOYp5iE1/ekLca2jmWm5Ch9FB69V6YUPIHn9uiRGksrJ/jMww9FMG8wRtjV2j2UaPmUO5TjhJcMhywK2UYLYqmIzKGfYzPbu2hNh2BntHz8B0TNz4KJmYoYFcs9aU4Y1ddCPyUWvIYwJYeCtjn2kK3nnwmCj6CnakGhzInl24tP0Z05VCAbhiCyjT9xjT/SePwvim5cai5057DyJoKnzoPcA8PuxzF4a4Uc9CBx33FPmpNg+j+M4eooWw5DIm3XLGHBZrO//tIxGJXj4dPdRdCc6cb58OWTHSbJHMQsAWRZdVuaD2NQqLn+o1xG7Ng474cu+Rw3qscHwR7r67oHq6E74iuPRQGhcWnjBOuGlQUloxjWVzBFvs6lJZCFlldkcshHWzpoSaDwqGYrEzVywdS5r3c6ds9nHlJeRQ0BRGVoRx1QXG7bkqSOWwJ9dNJ4Uem6DQaubZkkbfenOg2Yv1isCdl2ENFG3Npl5SU3LLUo7Kcrg33sbIy4UTHdv0QMpxYmpQnL6V3Q8KEJf4CDf5uC6Dp+WgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Analyze Token\"\n        title=\"Analyze Token\"\n        src=\"/static/67c468bf56bda78f76f596ea6a35a7fc/b5245/analyze-token.png\"\n        srcset=\"/static/67c468bf56bda78f76f596ea6a35a7fc/991de/analyze-token.png 173w,\n/static/67c468bf56bda78f76f596ea6a35a7fc/e4d6b/analyze-token.png 345w,\n/static/67c468bf56bda78f76f596ea6a35a7fc/b5245/analyze-token.png 535w\"\n        sizes=\"(max-width: 535px) 100vw, 535px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Edge_Ngram 색인 토큰</span>   </p>\n<br/>\n<p>색인어를 보면 2글자 이상을 기준으로 공백으로 끊어서 색인어가 생성된 것을 확인 하실 수 있습니다<br>\n이것을 토대로 생성된 자동완성을 일반 검색과 같이 <code class=\"language-text\">match</code>를 써서 자동완성을 서비스 합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">GET autocomplete_test_2/_search\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"세트\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 365px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 132.94797687861274%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAADN0lEQVRIx5VV6XraMBDM+79a7zYJCQEMGHxgy5blE2gznZVwMMH0+LGf5Gs0uzs7vjNVC3+n8W2dIMor5LpAUTao2wPq5uBWRtXsbfTX5/uHi/t3uWmQFzVUXqLtjpADyrq7AKmaDuVbuHvluwP6/Z2A2SDwJjX4vooxDRSqeo8gU3jYzPASerj3Z9wvMI18zGLfrl4SIivKcUBNZrMow2cvIlAJVRhsVIzncIlU6zNLsje125tasumzOFwCFgT04hyzMIM2NcEShCqHIvOUzxOGOZXiT3FmWLZYJgUmW8UUM3u9ZrMWUcFDcjxtMyjdoLmo7bmOFylncjoZrgj4Y73Do5+QUYNdluElWmFnNAKdYM0SuNTGO37ZlBPwnOx8NqesOta1wfftCxbJFtN4hWUakuHxpoTeADXrpHRp9dftjzat/oX9/pVy+omu+2XX9+mOpqxNhTjJ0BKs7Q425GFjgwcQyIG6aAfrEGyQckWGFTI2wmcdA1VaOShTIsxTyihhfSM2LYLP7m95LWukc6qjua3DeZTj4zywXZYa+mmMT8tH3l9TUoEF3JwA3ZpyIOpxwKJ0gPfssEyNsIr4QcoON3z5eHjFz+Mra/rrX1J2DKW7Aiopp5wUSX8RF5bxM/X5zJFUA0Y3m9JPyoJCfiDDyZbMqMMw1RR3hpguJBFyJA1L0QwA3svnTdgiGWH2lbM8Iag2LVNWuA9eKGxOSuzhIZxhEnn4QW3eEvhd7zROPsLUDX+fjoi7oAkkpmA9DZVAz6zqK498p0MOv9LW45rucCHsfi9e2Ui0Li5N9spgK+zS3H5QDsxzGL3BXk1Ke6MpmjX0U2cOvQ7FYB+3c2uwD/9rsMVJ2B/mIbaKteKU+CkbFHg02JyT01qTFVPtY8j4SocCuKbulrG2HZcpiDJtx9GZLA3EtLYcYy4zOnreSYeSstR2vSvwtKGgaa7TIMeE+5ygHaflrwYrDJfyO+VPSkDTk8GupE5VSYNNoUqDUCsEufqzsHtPFGD5r0hzpCmivS+bJ3g01km0pNEG1min8dr9j28J2xmssZ0WT2y68wtD/xP9uevjKLsrgxUdjjnyrRgD/Q1oxBCs7i6I/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Match Search\"\n        title=\"Match Search\"\n        src=\"/static/f39853f427fadda6a6092a960855c738/2e8d1/match-search.png\"\n        srcset=\"/static/f39853f427fadda6a6092a960855c738/991de/match-search.png 173w,\n/static/f39853f427fadda6a6092a960855c738/e4d6b/match-search.png 345w,\n/static/f39853f427fadda6a6092a960855c738/2e8d1/match-search.png 365w\"\n        sizes=\"(max-width: 365px) 100vw, 365px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Match 검색 결과</span>   </p>\n<br/> \n<br/>\n<p>오타에 대한 검색을 위해 <code class=\"language-text\">fuzziness</code>를 설정하여 검색도 가능합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">GET autocomplete_test_2/_search\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"트레이복\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"fuzziness\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 389px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.55491329479769%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYklEQVQoz4WS6W6DMBCE8/5PV6USSqOEQAOEw8Y2PklSTdfkKCiR+mO1KwOfZ3ZYDSaglwabkmNXSyht0QsFGy6w/vws40ZYd16cLZ7d55XSHkJZtFyhHxy0CxCauh2nOdZgA5T11F/rAXv0lTIeTGhEMCPwV8nwmbfgykEMGkm5x6bKyEFKc4Z9U2DXHJG2FXLWkAgD5y8T0CyBDowUrvOGrAtIsl6LuIZvdFLCzZQsi878+B7YkcJtxVGygdQOKDkjmEMjDE69hqB3rR9foPOLXoAxnKRgpM7Qbg3yRiHvBmStAif4OP4ghCs8hRbn11DuQEnAGEpy7PCRNShIJZdq2mGtONKuwKY+4MAqJKcUlWBYl1tak/7b4VyhGOykSFA40aK2t4QrydEogVoKgvAJVFJxrXHs2yn9pWUC9DLC9ASMVvzsH4z2ogJP/Wb1+jwL4Y3lqKTlcoK9T/H/mn/3Cy2G/XzkHNupAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Match Fuzziness Search\"\n        title=\"Match Fuzziness Search\"\n        src=\"/static/6481606e666182a57b9e1d30c88d1d90/00a4e/match-fuzziness-search.png\"\n        srcset=\"/static/6481606e666182a57b9e1d30c88d1d90/991de/match-fuzziness-search.png 173w,\n/static/6481606e666182a57b9e1d30c88d1d90/e4d6b/match-fuzziness-search.png 345w,\n/static/6481606e666182a57b9e1d30c88d1d90/00a4e/match-fuzziness-search.png 389w\"\n        sizes=\"(max-width: 389px) 100vw, 389px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Fuzziness 설정 검색 결과</span>   </p>\n<br/>\n<p>이것으로 이전에 <a href=\"https://renuevo.github.io/elastic/autocomplete/elastic-autocomplete-1/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Autocomplete Prefix Queries</a>에서 첫글자를 기준으로 입력해야 했던 <code class=\"language-text\">Prefix</code>와 <code class=\"language-text\">Whitespace</code>의 단점을 보완하였습니다<br>\n이러한 방식으로 <strong>세트</strong>와 같이 중간이나 끝에 나오는 문자도 자동완성으로 제공하는 서비스가 가능합니다   </p>\n<br/>\n<p>하지만 이러한 자동완성도 어디까지나 영어와 같은 a, b, c 같이 문자가 하나하나일 경우만 효과적일 수 있습니다 ❗<br>\n다시 말해 한글과 같이 자음과 모음의 합성으로 만들어지는 문자의 경우는 해당 방법만으로 서비스를 하기엔 부족한 부분이 있습니다<br>\n다음은 한글 자동완성의 다른점과 어떻게 서비스를 만들어야 하는지를 설명합니다  </p>\n<br/>\n<br/>\n<h2 id=\"한글의-자동완성\" style=\"position:relative;\"><a href=\"#%ED%95%9C%EA%B8%80%EC%9D%98-%EC%9E%90%EB%8F%99%EC%99%84%EC%84%B1\" aria-label=\"한글의 자동완성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>한글의 자동완성</h2>\n<p>한글은 <code class=\"language-text\">자음과 모음</code>의 합성으로 글자가 이루어 집니다<br>\n이러한 경우 사람이 이해하기 쉽지만 시스템에서는 이를 서비스하기 위해 약간의 추가적 개발이 필요합니다  </p>\n<br/>\n<p>먼저 한글로 인해 고려해야할 항목들을 생각해 보겠습니다  </p>\n<blockquote>\n<ol>\n<li><code class=\"language-text\">ㄱ</code>과 <code class=\"language-text\">ㅏ</code>가 만나 <code class=\"language-text\">가</code>가 되는 합성문자 이다  </li>\n<li>\n<p><code class=\"language-text\">받침</code>을 가지고 있어 <code class=\"language-text\">자음이 이전문자</code>의 <code class=\"language-text\">받침</code>이 될 수 있다  </p>\n<blockquote>\n<p>🥔<code class=\"language-text\">감자튀김</code>을 입력할 경우 <code class=\"language-text\">감잩</code>같이 중간에 전혀 다른 글자가 된다   </p>\n</blockquote>\n</li>\n<li>서비스적으로 🥔<code class=\"language-text\">감자튀김</code>을 <code class=\"language-text\">ㄱㅈㅌㄱ</code>과 같이 검색 할 수 도 있다  </li>\n</ol>\n</blockquote>\n<br/>\n<p>한글 자동완성을 설계할 때는 다음과 같은 상황을 고려해서 설계할 필요가 있습니다<br>\n이러한 기능들을 구현하기 위해서는 색인어를 다양한 형태로 저장해야만 합니다<br>\n하지만 현재의 Elastic Search가 제공하는 기본 기능만으로는 한계가 있습니다<br>\n그래서 추가적으로 Plugin을 설치하여 Elastic의 기능을 확장할 필요성이 있습니다</p>\n<br/>\n<h2 id=\"한글-자동완성을-위한-플러그인\" style=\"position:relative;\"><a href=\"#%ED%95%9C%EA%B8%80-%EC%9E%90%EB%8F%99%EC%99%84%EC%84%B1%EC%9D%84-%EC%9C%84%ED%95%9C-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8\" aria-label=\"한글 자동완성을 위한 플러그인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>한글 자동완성을 위한 플러그인</h2>\n<p>자동완성의 경우에는 일반적인 검색에 대한 인덱싱과는 색인어의 차이를 가지고 있습니다<br>\n일반적인 검색에서는 <code class=\"language-text\">nori형태소</code>와 같이 검색을 위해 단어에 대해서 색인을 하게 됩니다  </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 483px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.47976878612717%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA9klEQVQY04XQa2uDMBQG4Pz//zUoAxkrUmxtU1uN98SYeFd4lzhpwX3Yh4f3HHIPGYYRslbQTQ/dDlAb3Y0vzT/sOptCNiDzPKNWGjnNwFIBL4pxZhkyocFlh7JqUVTNm3jLDWHm3JICTsDgRwIkKyToM8HtmeFIE3xdY7g0hW/6bxrgdGcIGMedlQZf6z07Rk3SqACpVYM0F2C5xMEL4fgxLmazz6uHw+WEj7O71g7113QfD8S5QphWL5GVSYQJB1mWZX1yWWmIuoNUv3jdmr5dszR/Y8ds8q3eq1SPnCuQcZxgbzlMC9p++qPb7Ou9fphRmcN/AAXTxOnS+/ILAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nori-analyzer\"\n        title=\"nori-analyzer\"\n        src=\"/static/57063d6d3b1e70b49029fada69aee808/77a9e/nori-analyzer.png\"\n        srcset=\"/static/57063d6d3b1e70b49029fada69aee808/991de/nori-analyzer.png 173w,\n/static/57063d6d3b1e70b49029fada69aee808/e4d6b/nori-analyzer.png 345w,\n/static/57063d6d3b1e70b49029fada69aee808/77a9e/nori-analyzer.png 483w\"\n        sizes=\"(max-width: 483px) 100vw, 483px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Fuzziness 설정 검색 결과</span>   </p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 609px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.7514450867052%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABhUlEQVQ4y52U227CMBBE+f+/q6oKhFogXBPbcXx3gFTTtUOK6EsxDysnUrSZPTPe2TB8w7kAaWIu63u4cEbfDwjxAl9Ys2EY4HwAkwYV12i1p/cIYQwMnemj9INna3a9DqQqwLqIddPhYyewPLZYHE+opc4fTU2fVuhDD20jNkxhcWixqgUqxqFseFBYMHKEMp4UWRxam8eW9B7itUhdbhhjUuegtIOgRsolU3o0usv1l+O/DX0gZ8llQww/a4n3LaexRWZYcQbtysbOCtPIxo6mJIbrRmDLOZl1ztEpHtneGLLO4UQlTSBl8a4qFLicG9JYHTHkipqR0sSNG303pMTlFGptPTXtfxnO95yeBVr6QXEOw2QKKVsRw/leYEMM101DOYyvxWZiKJQHp+h0NvG7FDe7NRwVZlNUymLIC2InyyPzODK5+kUM3yqWGS5PDY7tC3fZh8TPjwzrO8OKsQeGT2+bKTbahpw/kTM47sSX9mG6erLTkGRGXq50O9JpUrnbWVA/DldtjGB3tzAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nori-analyzer-result\"\n        title=\"nori-analyzer-result\"\n        src=\"/static/adda5c4a474191219f9315a4eb63ff32/d0d8c/nori-analyzer-result.png\"\n        srcset=\"/static/adda5c4a474191219f9315a4eb63ff32/991de/nori-analyzer-result.png 173w,\n/static/adda5c4a474191219f9315a4eb63ff32/e4d6b/nori-analyzer-result.png 345w,\n/static/adda5c4a474191219f9315a4eb63ff32/d0d8c/nori-analyzer-result.png 609w\"\n        sizes=\"(max-width: 609px) 100vw, 609px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Fuzziness 설정 검색 결과</span>   </p>\n<br/>\n<p>이 처럼 일반적인 형태소를 통해서 색인을 하게 되면 검색에 알맞은 색인어가 추출됩니다<br>\n<span class='red_font'>하지만 이러한 색인어들로는 자동완성을 하기 부적절 합니다</span>  </p>\n<br/>\n<p>그래서 한글과 자동완성에 맞는 기능을 위해 Plugin을 설치해야 합니다<br>\n일반적으로 해당기능을 위해 많이 알려진 Plugin은 <a href=\"https://github.com/punxism/elasticsearch-hangul-jamo-plugin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">한글 jamo 플러그인</a>입니다<br>\n하지만 개인적으로 아쉽게도 해당 플러그인은 현재 4년전 5.2.2까지만 테스트가 진행 되었고 Maven으로 빌드되어 있습니다<br>\n(현재 공식 <a href=\"https://github.com/elastic/elasticsearch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elastic github</a>에서는 Gradle을 기본으로 사용합니다)</p>\n<br/>\n<p>그래서 이전에 사용하던 6.5.4와 7.3.2버젼의 호환성과 Gradle기반의 Elastic Plugin을 직접 제작하였습니다 👉 <a href=\"https://github.com/renuevo/elastic-plugin-test\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">한글 jamo 7.3.2 Custom 버젼</a><br>\n해당 github project는 Plugin 개발을 위한 Test용도이며 개발에는 Lucene과 Elastic의 Plugin 개발 지식이 필요합니다<br>\nPlugin 개발에 대해서는 이후 따로 포스팅할 예정이며 Elastic에서 제공하는 <a href=\"https://github.com/elastic/elasticsearch/tree/master/plugins\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elastic Plugin</a>의 example을 보고 개발 가능합니다  </p>\n<br/>\n<p>이제 자소분해 검색을 진행해보겠습니다<br>\n먼저 Plugin을 사용해서 신규 형태소 분석을 갖는 인덱스를 생성해 줍니다    </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">PUT autocomplete_test_jamo\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"analysis\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"jamo_analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ngram_token\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"lowercase\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"jamo-filter\"</span>\n          <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token property\">\"jamo-filter\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jamo_filter\"</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jamo_filter\"</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span></span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"tokenizer\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"ngram_token\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"edge_ngram\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"min_gram\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"max_gram\"</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"token_chars\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"letter\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"digit\"</span>\n          <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jamo_analyzer\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"search_analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jamo_analyzer\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tokenizer는 이전과 똑같이 Ngram을 사용하였습니다<br>\n이후 필터부분에 플러그인으로 제작한 <code class=\"language-text\">jamo_filter</code>를 등록해 줍니다  </p>\n<br/>\n<p>여기서 Plugin의 코드를 잠시 살펴 보겠습니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JamoTokenFilter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">TokenFilter</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">CharTermAttribute</span> charTermAttribute <span class=\"token operator\">=</span> <span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CharTermAttribute</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Parser</span> parser<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">JamoTokenFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TokenStream</span> input<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Parser</span> parser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parser <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">incrementToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span><span class=\"token function\">incrementToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">.</span><span class=\"token function\">parser</span><span class=\"token punctuation\">(</span>charTermAttribute<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">            charTermAttribute<span class=\"token punctuation\">.</span><span class=\"token function\">setEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span></span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>코드를 보시면 Ngram으로 파싱해서 가져온 글자를 <code class=\"language-text\">charTermAttribute.toString()</code>으로 받아옵니다<br>\n이후 parser로 자음과 모음을 분해해서 <code class=\"language-text\">charTermAttribute.setEmpty()</code>로 기존 색인어를 초기화하고 분해한 색인어 값을 추가해 줍니다  </p>\n<br/>\n<p>이렇게 등록하면 다음과 같이 자음과모음이 분해된 색인어를 갖게 됩니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">GET autocomplete_test_jamo/_analyze\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"analyzer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jamo_analyzer\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"text\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"여성 트레이닝복 세트\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.71676300578035%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoElEQVQ4y6VV2XKDMAzk/3+vmXaanjmagI3x7STtw1ZSKG3SFyAPGsPA7OxqV3KlXULrM1I+ohw+kftK5TQ8T6nKEOCm9RDgkOBSITD+eJoFWvlY8LzvcLdWeG1aKBsGID6nglYuZKy1w84ENNYhiPSv+ZIt9a/uIvWxoCO2NmaRPZshS16S5MVG46XRIplZ5nKj5C0Zo5zvJfcul5mSW5/gCSjkA2I5iss/7KYzJMkvtcXDtsWbMhSfeOHyZIYuFIqLxRvVR2vg0+FX8jyXKdAUap+O0j+fi8i+iSFLftwZrLRBbe3Z5Vtiw4BPe0MjaODiYQj2LIbscmMjhfnsMkvm83r8xpZIfldO5nndWpLsZFrmOi2ADLbkHioNS+9/JU9muK07rAhwpwNqWhCK5rox51JcXX+OLGHI+5Brbz0a52BipEWREHu3eTdOkvxEDO+3mgKuYciki5/K51RTsuxCvgYss5JQn/7N8lhzKkuAvGk+CLR21EPvRa5NSU6O0JSQS7B5ShYbugJqNSyH6xrLcpCsaJ678MeIq104VvI3LMfvw89xRGgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Custom Tokenizer Result\"\n        title=\"Custom Tokenizer Result\"\n        src=\"/static/752adcff1c9cddabfd99114f2dba2020/1e043/custom-tokenizer-result.png\"\n        srcset=\"/static/752adcff1c9cddabfd99114f2dba2020/991de/custom-tokenizer-result.png 173w,\n/static/752adcff1c9cddabfd99114f2dba2020/e4d6b/custom-tokenizer-result.png 345w,\n/static/752adcff1c9cddabfd99114f2dba2020/1e043/custom-tokenizer-result.png 690w,\n/static/752adcff1c9cddabfd99114f2dba2020/41d3b/custom-tokenizer-result.png 774w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Jamo 형태소 분석 결과</span>   </p>\n<br/>\n<br/>\n<p>이후 다음과 같은 쿼리로 자모분해 검색이 가능합니다  </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">GET autocomplete_test_jamo/_search\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"word\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"트레인\"</span>\n    <span class=\"token punctuation\">}</span> \n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 468px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.040462427745666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQoz42Ry26DMBBF8/8/11V2iRLABOIHGDx+0DS6HZtUbRIhdXFkjK3juTO7yUW0akLD+LBgdh4UPxHiDSE9iH947Cku8Hzvld04eQyWkMWVtKhYTH5Bra84yZa5MB2EkWgHXfbCKH48CxZQeBbvhiL0MHPAx6kvQmUtDn2NblCYiM8dYWQs5XsOllNkIW0LCZqFx36EHAmShcoGCO0KIX4hLXfExGu6r5HDRuQinAgDC/eNxF5o5H+1VGiM5XgjPzYXjHOFH1le3yrMPTSlh4EHY3HmPs6UUJkezXDFWV9wkIJp+LvDUYkn4ftQuDJjHUauMvIEY1oP4st0c9yV26ZsFbIsV0jhN8J/2JJ+A7LlZkp6zcdsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Jamo Search Result\"\n        title=\"Jamo Search Result\"\n        src=\"/static/d231e224995a27d7c9855ace53eb6ea9/90372/jamo_search_result.png\"\n        srcset=\"/static/d231e224995a27d7c9855ace53eb6ea9/991de/jamo_search_result.png 173w,\n/static/d231e224995a27d7c9855ace53eb6ea9/e4d6b/jamo_search_result.png 345w,\n/static/d231e224995a27d7c9855ace53eb6ea9/90372/jamo_search_result.png 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>Jamo 검색에 대한 결과</span>   </p>\n<br/>\n<br/>\n<p>이전 Index 생성시 등록한 <code class=\"language-text\">\"search_analyzer\": \"jamo_analyzer\"</code>를 통해 검색에 형태소가 적용되어 검색을 하게 됩니다   </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.965317919075144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABcRAAAXEQHKJvM/AAABHElEQVQY0z2PS0oDQRCG+wBeIBuTK3iCCB5BdOFGEVxkkYX4wJMoCagLRQjeQQMqgmsXA2pE4yQzPf1+TUxmpqyguPj5uqnqr7rI7t5+8+DwaBkAaikXDRe+6yGf1v1vFvHeUMYvPDw+kZv+fe34pNPu9a63u51u+/TsvHVxebVz279bw/dN4/IVolM5SIWSQ8bZWGg+lpp/McFHXDIkRWHuw3RDSEukcutMe/hkBiiSGovUIJwFlAF+AIiywbwmEsbCwoDG8E5HEAsGGTaiDMJkBgnlLULIUhS9bCbSwfMwK6I4Kz4oK7h2BYr+Q7QLnJsAxudlokSpnC+xUKJsztl8Kp63cCXCuFpNhIG3RJbIKpWqsn5SYb2yf/kBsgQOLD6DX4wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Jamo Search View\"\n        title=\"Jamo Search View\"\n        src=\"/static/473372a9835f248d43314cbed3061366/1e043/jamo_search_view.png\"\n        srcset=\"/static/473372a9835f248d43314cbed3061366/991de/jamo_search_view.png 173w,\n/static/473372a9835f248d43314cbed3061366/e4d6b/jamo_search_view.png 345w,\n/static/473372a9835f248d43314cbed3061366/1e043/jamo_search_view.png 690w,\n/static/473372a9835f248d43314cbed3061366/e3189/jamo_search_view.png 1035w,\n/static/473372a9835f248d43314cbed3061366/c6ff8/jamo_search_view.png 1088w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span class='img_caption'>실제 내부 검색 형태</span><br>\n덕분에 트레인이라고 검색하지만 <code class=\"language-text\">ㅌㅡㄹㅔㅇㅣㄴ</code>으로 검색하여 이후 자음이 받침으로와도 검색되도록 문제를 해결 할 수 있습니다  </p>\n<hr>\n<br/>\n<p>이전에 말씀드린 고려사항 같은 방법을 응용하여 해결할 수 있습니다  </p>\n<blockquote>\n<ol start=\"3\">\n<li>서비스적으로 🥔<code class=\"language-text\">감자튀김</code>을 <code class=\"language-text\">ㄱㅈㅌㄱ</code>과 같이 검색 할 수 도 있다  </li>\n</ol>\n</blockquote>\n<p>이 경우는 따로 설명 드리지 않겠습니다<br>\n좋은 서비스를 만들기 위해 직접 실험하고 해보시길 권유 드립니다 🙋‍♂  </p>","frontmatter":{"title":"[Elastic] 2. Elastic 자동완성 가이드 (Autocomplete Guide) - Index Search","date":"November 04, 2020"}}},"pageContext":{"slug":"/elastic/autocomplete/elastic-autocomplete-2/","previous":{"fields":{"slug":"/notion/clean-architecture-1/"},"frontmatter":{"title":"[Notion] 1. 클린 아키텍처란? (Clean Architecture)","category":"Notion"}},"next":{"fields":{"slug":"/spring/spring-version-upgrade/"},"frontmatter":{"title":"[Spring] Spring Boot 2.3.x Dependency 업그레이드","category":"Spring"}}}},"staticQueryHashes":["3128451518","96099027"]}