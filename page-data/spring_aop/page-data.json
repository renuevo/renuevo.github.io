{"componentChunkName":"component---src-templates-blog-post-index-js","path":"/spring_aop/","webpackCompilationHash":"9580e596b53f8ef7a4a3","result":{"data":{"site":{"siteMetadata":{"title":"DRcode","author":"Deokhwa Kim"}},"markdownRemark":{"id":"061b2353-6dcd-588b-be92-c64fcbfd3153","html":"<h1>Spring AOP</h1>\n<h2>AOP <span class=\"sub_header\">(Aspect-Oriented Programming)</span></h2>\n<blockquote>\n<p>AOP는 <strong><em>관점 지향 프로그래밍</em></strong>으로 <strong>핵심 비즈니스 기능과 공통기능을 분리</strong>하여 공통기능의 중복을 없애고 객체들간의 관계 복잡도를 줄이는데 사용된다<br>\n<strong>위빙(Weaving)</strong>을 통해 핵심기능에서 벗어난 공통기능을 정의하고 사용할 수 있다록 한다  </p>\n</blockquote>\n<p>이렇게 해서 얻을 수 있는 이점을 크게 두가지이다  </p>\n<div class=\"gatsby-highlight\" data-language=\"textbox\"><pre class=\"language-textbox\"><code class=\"language-textbox\">1. 요청으로 부터 핵심기능으로 접근하는 방법을 제어하기 위해\n2. 핵심기능에 대해서 추가적인 기능을 주여해주기 위해</code></pre></div>\n<hr>\n<h2>Spring AOP</h2>\n<blockquote>\n<p>Spring에서는 <strong>Proxy</strong>를 이용하여 AOP서비스를 제공한다  </p>\n</blockquote>\n<p><strong>1. JDK 동적 프록시</strong></p>\n<blockquote>\n<blockquote>\n<p>java 리플렉션을 이용하여 개체를 만드는 프록시</p>\n</blockquote>\n</blockquote>\n<p><strong>2. CGLIB 프록시</strong></p>\n<blockquote>\n<blockquote>\n<p>바이트 코드를 조작하여 만드는 프록시</p>\n</blockquote>\n</blockquote>\n<p><em>예전에는 AOP를 위해 interface를 구현해야 했지만, Spring3.2부터 CGLIB가 Spring core에 포함되면서 필요없어 졌다</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.460176991150444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABcRAAAXEQHKJvM/AAAA4klEQVQI12NgwAL+//8Ppq89fBr3+P2X/3eev/5z59mrXy+//vp//fHzcoiaw0w3nrw49gQof/vZqz+3nrz8fwOIGaysrPydnJz8Q0JC/W1tbYJs7B2d8hdfFABp2nzkfM6GHbv/r9yw+c/KjVt+bd174P+GvUcaQHIzzv0RWbN979l123YC5bcA5Tf/X7ZuE9jAR87Ozo8iIyMf2NravgAauDd+1nkt58W/pdsXbmtLz8r+n5Ka9jctI/N3bl7+/9ruaX3Oq/5LtBz5Y5Rf2XgrNTX1f2p6xt/M7Oz/MXHx/wGXKICmQoWu4AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spring_aop_proxy\"\n        title=\"spring_aop_proxy\"\n        src=\"/static/bdd6ef8e0389d76e961c019dedca0915/4d297/spring_aop_proxy.png\"\n        srcset=\"/static/bdd6ef8e0389d76e961c019dedca0915/07e12/spring_aop_proxy.png 240w,\n/static/bdd6ef8e0389d76e961c019dedca0915/5ca43/spring_aop_proxy.png 480w,\n/static/bdd6ef8e0389d76e961c019dedca0915/4d297/spring_aop_proxy.png 960w,\n/static/bdd6ef8e0389d76e961c019dedca0915/84277/spring_aop_proxy.png 1130w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        loading=\"lazy\"\n      />\n    </span><br>\nAOP Object는 마치 자신인 핵심 Core Object처럼 꾸며서 흐름을 제어한다 </p>\n<hr>\n<h3>Spring AOP를 사용하기 위한 주요 요건</h3>\n<ul>\n<li>\n<p><strong>Aspect <span class=\"sub_header\">(@Aspect)</span></strong></p>\n<blockquote>\n<blockquote>\n<p>공통 관심사를 모듈화 한 자바 클래스</p>\n</blockquote>\n</blockquote>\n</li>\n<li>\n<p><strong>Advice <span class=\"sub_header\">(@Advice)</span></strong></p>\n<blockquote>\n<blockquote>\n<p>무엇(What)이 실행될 것인지의 공통기능담은 구현체를 의미</p>\n</blockquote>\n</blockquote>\n</li>\n<li>\n<p><strong>Pointcut <span class=\"sub_header\">(@Pointcut)</span></strong></p>\n<blockquote>\n<blockquote>\n<p>어디에서(Where) Advice를 실행할 것인지를 정의</p>\n</blockquote>\n</blockquote>\n</li>\n</ul>\n<br/>\n<h3>Advice</h3>\n<blockquote>\n<blockquote>\n<ol>\n<li><strong>Before</strong> : 메서드 호출 이전  </li>\n<li><strong>After</strong> : 메서드 호출 이후  </li>\n<li><strong>AfterReturning</strong> : 메서드가 예외없이 실행된 이후  </li>\n<li><strong>AfterThrowing</strong> : 메서드에 예외가 발생한 이후  </li>\n<li><strong>Around</strong> : 메서드의 실행 전/후   </li>\n</ol>\n</blockquote>\n</blockquote>\n<br/>\n<h3>Pointcut</h3>\n<div class=\"table-wrapper\" markdown=\"block\">\n<table>\n<thead>\n<tr>\n<th>Pointcut</th>\n<th>Joinpoints</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>execution(public * *(..))</td>\n<td>public 메소드 실행</td>\n</tr>\n<tr>\n<td>execution(* set*(..))</td>\n<td>이름이 set으로 시작하는 모든 메소드명 실행</td>\n</tr>\n<tr>\n<td>execution(* set*(..))</td>\n<td>이름이 set으로 시작하는 모든 메소드명 실행</td>\n</tr>\n<tr>\n<td>execution(* com.xyz.service.AccountService.*(..))</td>\n<td>AccountService 인터페이스의 모든 메소드 실행</td>\n</tr>\n<tr>\n<td>execution(* com.xyz.service.<em>.</em>(..))</td>\n<td>service 패키지의 모든 메소드 실행</td>\n</tr>\n<tr>\n<td>execution(* com.xyz.service..<em>.</em>(..))</td>\n<td>service 패키지와 하위 패키지의 모든 메소드 실행</td>\n</tr>\n<tr>\n<td>within(com.xyz.service.*)</td>\n<td>service 패키지 내의 모든 결합점 (클래스 포함)</td>\n</tr>\n<tr>\n<td>within(com.xyz.service..*)</td>\n<td>service 패키지 및 하위 패키지의 모든 결합점 (클래스 포함)</td>\n</tr>\n<tr>\n<td>this(com.xyz.service.AccountService)</td>\n<td>AccountService 인터페이스를 구현하는 프록시 개체의 모든 결합점</td>\n</tr>\n<tr>\n<td>target(com.xyz.service.AccountService)</td>\n<td>AccountService 인터페이스를 구현하는 대상 객체의 모든 결합점</td>\n</tr>\n<tr>\n<td>args(java.io.Serializable)</td>\n<td>하나의 파라미터를 갖고 전달된 인자가 Serializable인 모든 결합점</td>\n</tr>\n<tr>\n<td>@target(org.springframework.transaction.annotation.Transactional)</td>\n<td>대상 객체가 @Transactional 어노테이션을 갖는 모든 결합점</td>\n</tr>\n<tr>\n<td>@within(org.springframework.transaction.annotation.Transactional)</td>\n<td>대상 객체의 선언 타입이 @Transactional 어노테이션을 갖는 모든 결합점</td>\n</tr>\n<tr>\n<td>@annotation(org.springframework.transaction.annotation.Transactional)</td>\n<td>실행 메소드가 @Transactional 어노테이션을 갖는 모든 결합점</td>\n</tr>\n<tr>\n<td>@args(com.xyz.security.Classified)</td>\n<td>단일 파라미터를 받고, 전달된 인자 타입이 @Classified 어노테이션을 갖는 모든 결합점</td>\n</tr>\n<tr>\n<td>bean(accountRepository)</td>\n<td>“accountRepository” 빈</td>\n</tr>\n<tr>\n<td>!bean(accountRepository)</td>\n<td>“accountRepository” 빈을 제외한 모든 빈</td>\n</tr>\n<tr>\n<td>bean(*)</td>\n<td>모든 빈</td>\n</tr>\n<tr>\n<td>bean(account*)</td>\n<td>이름이 'account'로 시작되는 모든 빈</td>\n</tr>\n<tr>\n<td>bean(*Repository)</td>\n<td>이름이 “Repository”로 끝나는 모든 빈</td>\n</tr>\n<tr>\n<td>bean(accounting/*)</td>\n<td>이름이 “accounting/“로 시작하는 모든 빈</td>\n</tr>\n<tr>\n<td>bean(<em>dataSource)  bean(</em>DataSource)</td>\n<td>이름이 “dataSource” 나 “DataSource” 으로 끝나는 모든 빈</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p><span class=\"sub_header\">출처 : <a href=\"https://devjms.tistory.com/70\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">얼청뚱땅 개발자 블로그</a></span></p>\n<br/>\n<h3>Simple Source</h3>\n<br/>\n<p><strong><em>SpringBootApplication</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@EnableAspectJAutoProxy</span> <span class=\"token comment\">//AOP 활성화</span>\n<span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringBootTestApplication</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">CommandLineRunner</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringBootTestApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        simpleSource<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n <span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p><strong><em>AopClass</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Aspect</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AopTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Before</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"execution(* com.service.SimpleSource.test(..))\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">aopBefore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aop before\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<hr>\n<p><strong><em>Pointcut Recycle</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Aspect</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AopTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token annotation punctuation\">@Pointcut</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"execution(* *.*(..))\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logging</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    \n    <span class=\"token annotation punctuation\">@Around</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"logging()\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">aopBefore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aop around\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<hr>\n<p><strong><em>Pointcut Exclude</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleSource</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token annotation punctuation\">@NoLogging</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logNo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n       <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n<span class=\"token annotation punctuation\">@Aspect</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AopTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    \n    <span class=\"token annotation punctuation\">@Pointcut</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"execution(* *.*(..)) &amp;&amp; !@target(com.annotation.NoLogging)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logging</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>annotation을 구현해서 pointcut에 예외처리 지정하기</em></p>","excerpt":"Spring AOPAOP (Aspect-Oriented Programming)AOP는 관점 지향 프로그래밍으로 핵심 비즈니스 기능과 공통기능을 분리하여 공통기능의 중복을 없애고 객체들간의 관계 복잡도를 줄이는데 사용된다위빙(Weaving…","frontmatter":{"title":"Spring AOP","date":"2019-09-04","tags":["Spring","SpringBoot","AOP","Aspect"],"keywords":["spring","spring boot","aop","aspect","pointcut","advice","proxy"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/spring_aop/","previous":{"fields":{"slug":"/profile/"},"frontmatter":{"title":"Profile","tags":["Profile"],"published":true}},"next":{"fields":{"slug":"/observer_pattern/"},"frontmatter":{"title":"[DesignPattern] Observer Pattern","tags":["DesignPattern"],"published":true}}}}}