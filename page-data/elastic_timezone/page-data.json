{"componentChunkName":"component---src-templates-blog-post-index-js","path":"/elastic_timezone/","webpackCompilationHash":"f3ddec0e6a09ee3ba14a","result":{"data":{"site":{"siteMetadata":{"title":"DRcode","author":"Deokhwa Kim"}},"markdownRemark":{"id":"518c691c-fe12-5039-858e-6f0380419553","html":"<h2>Elastic Timezone Issues</h2>\n<blockquote>\n<p><em>elastic을 쓰면서 경험한 timezone 문제에 관한 글입니다</em>  </p>\n</blockquote>\n<h3>Logstash</h3>\n<ol>\n<li>Logstash의 timezone은 색인할때의 정보가 아닌 filter 자체의 timezone으로 데이터로써 @timestamp의 <strong><em>Asia/Seoul</em></strong>로 설정할시에 기존 시간에서 <strong><em>-9시간</em></strong>을 한 시간을 가져 오게 된다  </li>\n<li>\n<p>Logstash의 시간을 설정할 포맷을 정의 할때 timezone 키워드로 Asia/Seoul과 같이 지정해서 시간을 -9시간 할 수 있다</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">filter<span class=\"token punctuation\">{</span> \n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> \n            date<span class=\"token punctuation\">{</span> \n              match <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"insert_ts\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"YYYYMMddHHmmss\"</span><span class=\"token punctuation\">]</span> \n              timezone <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"Asia/Seoul\"</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> 이부분\n            <span class=\"token punctuation\">}</span> \n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> \n      <span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<br/>\n<ol start=\"3\">\n<li>\n<p>Logstash의 timezone포맷에 +-로 시간을 변경 할 수 있다</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">filter<span class=\"token punctuation\">{</span>      \n  date<span class=\"token punctuation\">{</span> \n      match <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"insert_ts\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"YYYYMMddHHmmss -0900\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> 이부분\n      timezone <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"Asia/Seoul\"</span> \n      <span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<br/>\n<ol start=\"4\">\n<li>\n<p>ruby코드를 활용해서 시간 조정도 가능하다</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">ruby<span class=\"token punctuation\">{</span> \ncode <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"event.set('@timestamp', LogStash::Timestamp.new(event.get('@timestamp')+(9*60*60)))\"</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<p>이 코드의 핵심은 <strong>LogStash::Timestamp</strong>인데..<br>\n<code class=\"language-text\">ruby의 time객체</code>와 <code class=\"language-text\">LogStash의 time객체</code>가 다르다는 것이다<span class=\"sub_header\">(이것 때문에 겁나 해맸다)</span>  </p>\n<hr>\n<h3>Kibana</h3>\n<ol>\n<li>기본적으로 kibana의 Time 기분은 Browser를 따라 간다 &#x3C;- 이거때문에 KST 기준일때 그래프가 정상적으로 보여서 혼동이 있었다</li>\n<li>kibana의 time 기준은 Management > Advanced Settings > dateFormat:tz로 변경할 수 있다</li>\n</ol>\n<hr>\n<h3>ElasticSearch</h3>\n<ol>\n<li>\n<p>ElasticSearch의 기존 timezone은 UTC 기준이다 색인도 UTC 기준으로 하길 권고 하고 바꾸지 않기를 권고하고 있다  </p>\n<blockquote>\n<p>-> 바꾸면 무한 timezone 관리로 계속해서 더 힘들어 질것</p>\n</blockquote>\n</li>\n</ol>","excerpt":"Elastic Timezone Issueselastic을 쓰면서 경험한 timezone 문제에 관한 글입니다  LogstashLogstash의 timezone은 색인할때의 정보가 아닌 filter 자체의 timezone…","frontmatter":{"title":"[Elastic] ElasticSearch Timezone 문제","date":"2017-12-28","tags":["Elastic","Logstash","Kibana","Timezone","Issues"],"keywords":["elastic","logstash","kibana","timezone","KST","UTC","시간","엘라스틱"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/elastic_timezone/","previous":null,"next":{"fields":{"slug":"/elastic_spring_resttemplate/"},"frontmatter":{"title":"RestTemplate Elastic 통신","tags":["Spring","SpringBoot"],"published":true}}}}}